<!-- templates/index.html -->

{% extends "dashboard/base.html" %}
{% load static extra_tags %}

{% block content %}

<div role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium transition-opacity duration-300 bg-gray-900 rounded-full shadow-sm opacity-0 tooltip dark:bg-gray-700">\
    Tooltip content\
    <div class="tooltip-arrow" data-popper-arrow></div>\
</div>

<section class="flex h-screen bg-white antialiased">
    <div class="w-full mx-auto">
        <!-- Start coding here -->
        <div class="relative overflow-hidden">
            <div class="px-4">
                <div class="flex flex-col py-3 space-y-3 md:flex-row md:items-center md:justify-between md:space-y-0 md:space-x-4">
                    <h4 class="font-mono text-xl font-bold">Bestellungen</h4>
                </div>

                <!-- TABS -->
                <ul class="flex flex-wrap text-sm font-medium text-center text-gray-500">
                    <li class="me-2">
                        <a href="{% url 'dashboard_orders' %}"  class="inline-block px-4 py-3 rounded-full bg-emerald-600 text-white">Bestellungen</a>
                    </li>
                    <li class="me-2">
                        <a href="{% url 'dashboard_order_products' %}" class="inline-block px-4 py-3 hover:text-gray-900 hover:bg-gray-100 rounded-full" aria-current="page">Produkte</a>
                    </li>
                    <li class="me-2">
                        <a href="{% url 'dashboard_review_orders' %}" class="inline-block px-4 py-3 hover:text-gray-900 hover:bg-gray-100 rounded-full" aria-current="page">Eingang</a>
                    </li>
                </ul>

                <div class="flex flex-col bg-white relative overflow-hidden" style="height: calc(100vh - 64px - 2.5rem);">
                    <div class="flex flex-col md:items-start md:justify-between space-y-3 py-4">
                        <div class="flex-1 flex items-center space-x-2">
                            <div class="font-medium text-gray-500 dark:text-gray-400">
                                {{ orders.paginator.count }} Ergebnisse
                            </div>
                        </div>
                        {% if request|check_get_parameters_exist:'search;search_invoice;search_total;amount_payable;search_product;status;online_recipe_status;recipe_status;payment_status;delivery_type;payment_type;customer_type' %}
                        <div class="flex-1 flex items-center border-gray-600 w-full filter-parameters">
                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400 me-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M5.05 3C3.291 3 2.352 5.024 3.51 6.317l5.422 6.059v4.874c0 .472.227.917.613 1.2l3.069 2.25c1.01.742 2.454.036 2.454-1.2v-7.124l5.422-6.059C21.647 5.024 20.708 3 18.95 3H5.05Z"/>
                            </svg>
                            <div class="flex-1 flex flex-wrap divide-x divide-gray-500 dark:divide-gray-400 w-full">
                                {% if request|get_parameter:'search' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Suche: {{ request|get_parameter:'search' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'search_invoice' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Rechnung: {{ request|get_parameter:'search_invoice' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'search_total' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Bestellwert: {{ request|get_parameter:'search_total' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'amount_payable' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Rechnungsbetrag: {{ request|get_parameter:'amount_payable' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'search_product' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Produkt: {{ request|get_parameter:'search_product' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'status' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Lieferstatus: {{ request|get_parameter:'status' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'online_recipe_status' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">(Online) Rezeptstatus: {{ request|get_parameter:'online_recipe_status' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'payment_status' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Bezahlstatus: {{ request|get_parameter:'payment_status' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'delivery_type' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Versandart: {{ request|get_parameter:'delivery_type' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'payment_type' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Zahlungsmethode: {{ request|get_parameter:'payment_type' }}</p>
                                {% endif %}
                                {% if request|get_parameter:'customer_type' %}
                                <p class="text-gray-500 dark:text-gray-400 px-3 text-xs whitespace-nowrap">Rezeptart: {{ request|get_parameter:'customer_type' }}</p>
                                {% endif %}
                            </div>
                            <button type="button" onclick="resetFilter()" class="flex items-center justify-center focus:outline-none bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-full text-sm px-4 py-2 me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900">
                                <svg class="w-4 h-4 text-gray-800  mr-1.5 -ml-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M8.586 2.586A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4a2 2 0 0 1 .586-1.414ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z" clip-rule="evenodd"/>
                                </svg>
                                Filter l√∂schen
                            </button>
                        </div>
                        {% endif %}
                    </div>
                    <div class="flex flex-col md:flex-row py-4 border-t">
                        <div>
                            <div class="flex">
                                <label for="search-dropdown" class="mb-2 text-sm font-medium text-gray-900 sr-only">Your Email</label>
                                <button id="searchDropdownButton" data-dropdown-toggle="searchDropdownCategories" class="flex-shrink-0 z-10 inline-flex text-white items-center py-2.5 px-4 text-sm font-medium text-center bg-gray-800 border border-gray-300 rounded-s-full hover:bg-gray-700 focus:ring-4 focus:outline-none" type="button">
                                    <span>Alle Kategorien</span>
                                    <svg class="w-2.5 h-2.5 ms-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                                    </svg>
                                </button>
                                <div id="searchDropdownCategories" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-sm shadow w-44 dark:bg-gray-700">
                                    <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdown-button">
                                        <li>
                                            <button type="button" onclick="selectSearchCategory(this, 'search')" class="inline-flex w-full px-4 py-2 hover:bg-gray-100 ">Alle Kategorien</button>
                                        </li>
                                        <li>
                                            <button type="button" onclick="selectSearchCategory(this, 'search_total')" class="inline-flex w-full px-4 py-2 hover:bg-gray-100 ">Bestellwert</button>
                                        </li>
                                        <li>
                                            <button type="button" onclick="selectSearchCategory(this, 'search_invoice')" class="inline-flex w-full px-4 py-2 hover:bg-gray-100 ">Rechnungsnummer</button>
                                        </li>
                                        <li>
                                            <button type="button" onclick="selectSearchCategory(this, 'amount_payable')" class="inline-flex w-full px-4 py-2 hover:bg-gray-100 ">Rechnungsbetrag</button>
                                        </li>
                                    </ul>
                                </div>
                                <div class="relative w-full">
                                    <input type="search" id="searchOrderInput" data-search-category="search" class="w-64 block p-2.5 z-20 text-sm bg-gray-50 rounded-e-full border-s-gray-50 border-s-2 border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500 dark:border-s-gray-700 dark:placeholder-gray-400 dark:focus:border-emerald-500" placeholder="Bestellnummer, Name, E-Mail..." required />
                                </div>
                                <button type="button" onclick="searchOrder()" class="flex mr-2 items-center justify-center text-white px-4 py-2 ms-2 text-sm font-medium rounded-full bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800">
                                    <svg class="h-3.5 w-3.5 me-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                                    </svg>
                                    Suchen
                                </button>
                            </div>
                        </div>
                        <div class="ml-auto me-3 flex flex-row">
                            <div class="relative searchProductContainer">
                                <div class="absolute inset-y-0 start-0 flex items-center ps-4 pointer-events-none">
                                    <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12.013 6.175 7.006 9.369l5.007 3.194-5.007 3.193L2 12.545l5.006-3.193L2 6.175l5.006-3.194 5.007 3.194ZM6.981 17.806l5.006-3.193 5.006 3.193L11.987 21l-5.006-3.194Z"/>
                                        <path d="m12.013 12.545 5.006-3.194-5.006-3.176 4.98-3.194L22 6.175l-5.007 3.194L22 12.562l-5.007 3.194-4.98-3.211Z"/>
                                    </svg>
                                </div>
                                <input type="text" dropdown-max-height="600" dropdown-width="400" data-search-type="global-search-product" class="h-full searchProductInput bg-gray-50 border w-full border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block ps-10 p-2 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Produktsuche" required>
                            </div>
                        </div>
                        <div class="w-full md:w-auto flex flex-col md:flex-row space-y-2 md:space-y-0 items-stretch md:items-center justify-end md:space-x-3 flex-shrink-0">
                            <button type="button" id="createProductButton" data-modal-toggle="orderModal" class="dark:hover:bg-gray-600 h-full flex items-center justify-center text-white bg-gray-300 focus:ring-4 focus:ring-gray-300 font-medium rounded-full text-sm px-4 py-2 focus:outline-none" disabled>
                            <!-- <button type="button" id="createProductButton" data-modal-toggle="orderModal" class="flex items-center justify-center bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 font-medium rounded-full text-sm px-4 py-2 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800" disabled> -->
                                <svg class="h-3.5 w-3.5 mr-1.5 -ml-1" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path clip-rule="evenodd" fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                                </svg>
                                Hinzuf√ºgen
                            </button>
                            <button type="button" id="createProductButton" onclick="toggleModal('importOrder')" class="h-full flex items-center justify-center text-white bg-emerald-600 focus:ring-4 focus:ring-gray-300 font-medium rounded-full text-sm px-4 py-2 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800">
                                <!-- <button type="button" id="createProductButton" data-modal-toggle="orderModal" class="flex items-center justify-center bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 font-medium rounded-full text-sm px-4 py-2 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800" disabled> -->
                                    <svg class="h-3.5 w-3.5 mr-1.5 -ml-1" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path clip-rule="evenodd" fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                                    </svg>
                                    Importieren
                            </button>
                            <button id="filterDropdownButton" data-dropdown-toggle="filterDropdown" class="text-gray-500 h-full w-full md:w-auto flex items-center justify-center py-2 px-4 text-sm font-medium focus:outline-none bg-white rounded-full border border-gray-200 hover:bg-gray-100 hover:text-emerald-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="h-4 w-4 mr-1.5 -ml-1 text-gray-500" viewbox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd" />
                                </svg>
                                Filtern
                                <svg class="-mr-1 ml-1.5 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path clip-rule="evenodd" fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                </svg>
                            </button>
                            <div id="filterDropdown" class="z-10 hidden px-3 pt-1 bg-white shadow w-80 right-0">
                                <div id="accordion-flush" data-accordion="collapse" data-active-classes="text-black" data-inactive-classes="text-gray-500 dark:text-gray-400">
                                    <!-- Lieferstatus -->
                                    <h2 id="status-heading">
                                        <button type="button" class="flex items-center justify-between w-full py-2 px-1.5 text-sm font-medium text-left text-gray-500 border-b border-gray-200 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700" data-accordion-target="#status-body" aria-expanded="true" aria-controls="status-body">
                                            <div>
                                                <span class="mr-2">Lieferstatus</span>
                                                {% if request|get_parameter:'status' %}
                                                <span class="inline-flex items-center justify-center w-5 h-5 text-xs bg-emerald-700 dark:bg-emerald-600 rounded-full">{{ request|get_parameter:'status'|tsplit:','|length }}</span>
                                                {% endif %}
                                            </div>
                                            <svg aria-hidden="true" data-accordion-icon="" class="w-5 h-5 rotate-180 shrink-0" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                            </svg>
                                        </button>
                                    </h2>
                                    <div id="status-body" class="hidden" aria-labelledby="status-heading">
                                        <div class="py-2 font-light border-b border-gray-200 dark:border-gray-600">
                                            <ul class="space-y-2">
                                                {% get_choices "OrderStatusChoices" as OrderStatusChoices %}
                                                {% for item in OrderStatusChoices %}
                                                <li class="flex items-center">
                                                    <input id="status-{{ item.0 }}" {% check_get_parameter request 'status' item.1 %} onchange="updateUrlParameters('status', '{{ item.1 }}')" type="checkbox" value="{{ item.0 }}" class="cursor-pointer w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-700 focus:ring-2 dark:border-gray-500">
                                                    <label for="status-{{ item.0 }}" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100 w-full cursor-pointer">{{ item.1 }}</label>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            <a href="javascript:void(0)" onclick="removeUrlParameters('status')" class="mt-2 flex items-center text-sm font-medium text-emerald-600 dark:text-emerald-500 hover:underline">Filterung aufheben</a>
                                        </div>
                                    </div>
                                    <!-- (Online) Rezeptstatus -->
                                    <h2 id="online-recipe-status-heading">
                                        <button type="button" class="flex items-center justify-between w-full py-2 px-1.5 text-sm font-medium text-left text-gray-500 border-b border-gray-200 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700" data-accordion-target="#online-recipe-status-body" aria-expanded="true" aria-controls="online-recipe-status-body">
                                            <div>
                                                <span class="mr-2">(Online) Rezeptstatus</span>
                                                {% if request|get_parameter:'online_recipe_status' %}
                                                <span class="inline-flex items-center justify-center w-5 h-5 text-xs bg-emerald-700 dark:bg-emerald-600 rounded-full">{{ request|get_parameter:'online_recipe_status'|tsplit:','|length }}</span>
                                                {% endif %}
                                            </div>
                                            <svg aria-hidden="true" data-accordion-icon="" class="w-5 h-5 rotate-180 shrink-0" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                            </svg>
                                        </button>
                                    </h2>
                                    <div id="online-recipe-status-body" class="hidden" aria-labelledby="online-recipe-status-heading">
                                        <div class="py-2 font-light border-b border-gray-200 dark:border-gray-600">
                                            <ul class="space-y-2">
                                                {% get_choices "OnlineRecipeStatusChoices" as OnlineRecipeStatusChoices %}
                                                {% for item in OnlineRecipeStatusChoices %}
                                                <li class="flex items-center">
                                                    <input id="online-recipe-status-{{ item.0 }}" {% check_get_parameter request 'online_recipe_status' item.1 %} onchange="updateUrlParameters('online_recipe_status', '{{ item.1 }}')" type="checkbox" value="{{ item.0 }}" class="cursor-pointer w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-700 focus:ring-2 dark:border-gray-500">
                                                    <label for="online-recipe-status-{{ item.0 }}" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100 w-full cursor-pointer">{{ item.1 }}</label>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            <a href="javascript:void(0)" onclick="removeUrlParameters('online_recipe_status')" class="mt-2 flex items-center text-sm font-medium text-emerald-600 dark:text-emerald-500 hover:underline">Filterung aufheben</a>
                                        </div>
                                    </div>
                                    <div id="recipe-status-body" class="hidden" aria-labelledby="recipe-status-heading">
                                        <div class="py-2 font-light border-b border-gray-200 dark:border-gray-600">
                                            <ul class="space-y-2">
                                                {% get_choices "RecipeStatusChoices" as RecipeStatusChoices %}
                                                {% for item in RecipeStatusChoices %}
                                                <li class="flex items-center">
                                                    <input id="recipe-status-{{ item.0 }}" {% check_get_parameter request 'recipe_status' item.1 %} onchange="updateUrlParameters('recipe_status', '{{ item.1 }}')" type="checkbox" value="{{ item.0 }}" class="cursor-pointer w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-700 focus:ring-2 dark:border-gray-500">
                                                    <label for="recipe-status-{{ item.0 }}" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100 w-full cursor-pointer">{{ item.1 }}</label>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            <a href="javascript:void(0)" onclick="removeUrlParameters('recipe_status')" class="mt-2 flex items-center text-sm font-medium text-emerald-600 dark:text-emerald-500 hover:underline">Filterung aufheben</a>
                                        </div>
                                    </div>
                                    <!-- Bezahlstatus -->
                                    <h2 id="payment-status-heading">
                                        <button type="button" class="flex items-center justify-between w-full py-2 px-1.5 text-sm font-medium text-left text-gray-500 border-b border-gray-200 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700" data-accordion-target="#payment-status-body" aria-expanded="true" aria-controls="payment-status-body">
                                            <div>
                                                <span class="mr-2">Bezahlstatus</span>
                                                {% if request|get_parameter:'payment_status' %}
                                                <span class="inline-flex items-center justify-center w-5 h-5 text-xs bg-emerald-700 dark:bg-emerald-600 rounded-full">{{ request|get_parameter:'payment_status'|tsplit:','|length }}</span>
                                                {% endif %}
                                            </div>
                                            <svg aria-hidden="true" data-accordion-icon="" class="w-5 h-5 rotate-180 shrink-0" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                            </svg>
                                        </button>
                                    </h2>
                                    <div id="payment-status-body" class="hidden" aria-labelledby="payment-status-heading">
                                        <div class="py-2 font-light border-b border-gray-200 dark:border-gray-600">
                                            <ul class="space-y-2">
                                                {% get_choices "PaymentStatusChoices" as PaymentStatusChoices %}
                                                {% for item in PaymentStatusChoices %}
                                                <li class="flex items-center">
                                                    <input id="payment-status-{{ item.0 }}" {% check_get_parameter request 'payment_status' item.1 %} onchange="updateUrlParameters('payment_status', '{{ item.1 }}')" type="checkbox" value="{{ item.0 }}" class="cursor-pointer w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-700 focus:ring-2 dark:border-gray-500">
                                                    <label for="payment-status-{{ item.0 }}" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100 w-full cursor-pointer">{{ item.1 }}</label>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            <a href="javascript:void(0)" onclick="removeUrlParameters('payment_status')" class="mt-2 flex items-center text-sm font-medium text-emerald-600 dark:text-emerald-500 hover:underline">Filterung aufheben</a>
                                        </div>
                                    </div>
                                    <!-- Versandart -->
                                    <h2 id="delivery-type-heading">
                                        <button type="button" class="flex items-center justify-between w-full py-2 px-1.5 text-sm font-medium text-left text-gray-500 border-b border-gray-200 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700" data-accordion-target="#delivery-type-body" aria-expanded="true" aria-controls="delivery-type-body">
                                            <div>
                                                <span class="mr-2">Versandart</span>
                                                {% if request|get_parameter:'delivery_type' %}
                                                <span class="inline-flex items-center justify-center w-5 h-5 text-xs bg-emerald-700 dark:bg-emerald-600 rounded-full">{{ request|get_parameter:'delivery_type'|tsplit:','|length }}</span>
                                                {% endif %}
                                            </div>
                                            <svg aria-hidden="true" data-accordion-icon="" class="w-5 h-5 rotate-180 shrink-0" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                            </svg>
                                        </button>
                                    </h2>
                                    <div id="delivery-type-body" class="hidden" aria-labelledby="delivery-type-heading">
                                        <div class="py-2 font-light border-b border-gray-200 dark:border-gray-600">
                                            <ul class="space-y-2">
                                                {% get_choices "DeliveryTypeChoices" as DeliveryTypeChoices %}
                                                {% for item in DeliveryTypeChoices %}
                                                <li class="flex items-center">
                                                    <input id="delivery-type-{{ item.0 }}" {% check_get_parameter request 'delivery_type' item.1 %} onchange="updateUrlParameters('delivery_type', '{{ item.1 }}')" type="checkbox" value="{{ item.0 }}" class="cursor-pointer w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-700 focus:ring-2 dark:border-gray-500">
                                                    <label for="delivery-type-{{ item.0 }}" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100 w-full cursor-pointer">{{ item.1 }}</label>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            <a href="javascript:void(0)" onclick="removeUrlParameters('delivery_type')" class="mt-2 flex items-center text-sm font-medium text-emerald-600 dark:text-emerald-500 hover:underline">Filterung aufheben</a>
                                        </div>
                                    </div>
                                    <!-- Zahlungsmethode -->
                                    <h2 id="payment-type-heading">
                                        <button type="button" class="flex items-center justify-between w-full py-2 px-1.5 text-sm font-medium text-left text-gray-500 border-b border-gray-200 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700" data-accordion-target="#payment-type-body" aria-expanded="true" aria-controls="payment-type-body">
                                            <div>
                                                <span class="mr-2">Zahlungsmethode</span>
                                                {% if request|get_parameter:'payment_type' %}
                                                <span class="inline-flex items-center justify-center w-5 h-5 text-xs bg-emerald-700 dark:bg-emerald-600 rounded-full">{{ request|get_parameter:'payment_type'|tsplit:','|length }}</span>
                                                {% endif %}
                                            </div>
                                            <svg aria-hidden="true" data-accordion-icon="" class="w-5 h-5 rotate-180 shrink-0" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                            </svg>
                                        </button>
                                    </h2>
                                    <div id="payment-type-body" class="hidden" aria-labelledby="payment-type-heading">
                                        <div class="py-2 font-light border-b border-gray-200 dark:border-gray-600">
                                            <ul class="space-y-2">
                                                {% get_choices "PaymentTypeChoices" as PaymentTypeChoices %}
                                                {% for item in PaymentTypeChoices %}
                                                <li class="flex items-center">
                                                    <input id="payment-type-{{ item.0 }}" {% check_get_parameter request 'payment_type' item.1 %} onchange="updateUrlParameters('payment_type', '{{ item.1 }}')" type="checkbox" value="{{ item.0 }}" class="cursor-pointer w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-700 focus:ring-2 dark:border-gray-500">
                                                    <label for="payment-type-{{ item.0 }}" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100 w-full cursor-pointer">{{ item.1 }}</label>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        <a href="javascript:void(0)" onclick="removeUrlParameters('payment_type')" class="mt-2 flex items-center text-sm font-medium text-emerald-600 dark:text-emerald-500 hover:underline">Filterung aufheben</a>
                                    </div>
                                    <!-- Rezeptart -->
                                    <h2 id="customer-type-heading">
                                        <button type="button" class="flex items-center justify-between w-full py-2 px-1.5 text-sm font-medium text-left text-gray-500 border-b border-gray-200 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700" data-accordion-target="#customer-type-body" aria-expanded="true" aria-controls="customer-type-body">
                                            <div>
                                                <span class="mr-2">Rezeptart</span>
                                                {% if request|get_parameter:'customer_type' %}
                                                <span class="inline-flex items-center justify-center w-5 h-5 text-xs bg-emerald-700 dark:bg-emerald-600 rounded-full">{{ request|get_parameter:'customer_type'|tsplit:','|length }}</span>
                                                {% endif %}
                                            </div>
                                            <svg aria-hidden="true" data-accordion-icon="" class="w-5 h-5 rotate-180 shrink-0" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                            </svg>
                                        </button>
                                    </h2>
                                    <div id="customer-type-body" class="hidden" aria-labelledby="customer-type-heading">
                                        <div class="py-2 font-light border-b border-gray-200 dark:border-gray-600">
                                            <ul class="space-y-2">
                                                {% get_choices "CustomerTypeChoices" as CustomerTypeChoices %}
                                                {% for item in CustomerTypeChoices %}
                                                <li class="flex items-center">
                                                    <input id="customer-type-{{ item.0 }}" {% check_get_parameter request 'customer_type' item.1 %} onchange="updateUrlParameters('customer_type', '{{ item.1 }}')" type="checkbox" value="{{ item.0 }}" class="cursor-pointer w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500 focus:ring-2">
                                                    <label for="customer-type-{{ item.0 }}" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100 w-full cursor-pointer">{{ item.1 }}</label>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            <a href="javascript:void(0)" onclick="removeUrlParameters('customer_type')" class="mt-2 flex items-center text-sm font-medium text-emerald-600 dark:text-emerald-500 hover:underline">Filterung aufheben</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Aktionen -->
                            <div class="flex items-center space-x-3 w-full md:w-auto h-full">
                                <button id="actionsDropdownButton" data-dropdown-toggle="actionsDropdown" class="w-full h-full md:w-auto flex items-center justify-center py-2 px-4 text-sm font-medium text-gray-500 focus:outline-none bg-white rounded-full border border-gray-200 hover:bg-gray-100 hover:text-emerald-700 focus:z-10 focus:ring-4 focus:ring-gray-200" type="button">
                                    Aktionen
                                    <svg class="-mr-1 ml-1.5 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path clip-rule="evenodd" fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                                    </svg>
                                </button>
                                <div id="actionsDropdown" class="hidden z-10 w-52 bg-white rounded divide-y divide-gray-100 shadow">
                                    <ul class="py-1 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="actionsDropdownButton">
                                        {% if request.user.is_superuser %}
                                        <li>
                                            <a href="javascript:void(0)" onclick="updateDeliveryStatus()" class="block py-2 px-4 hover:bg-gray-100 ">Lieferstatus updaten</a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0)" onclick="updateAllDeliveryStatus()" class="block py-2 px-4 hover:bg-gray-100 ">Alle Lieferstatus updaten</a>
                                        </li>
                                        {% endif %}
                                        <li>
                                            <a href="javascript:void(0)" onclick="sendOrderCreatedToCustomer()" class="block py-2 px-4 hover:bg-gray-100 ">Link zur Bestellbest√§tigung senden</a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0)" onclick="confirmCreatedOrder()" class="block py-2 px-4 hover:bg-gray-100 ">Bestellung best√§tigen</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="table-container" style="flex: 1" class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50" style="position: -webkit-sticky;position: sticky;top: 0;z-index: 1;">
                                <tr>
                                    <th scope="col" class="p-4">
                                        <div class="flex items-center">
                                            <input id="checkbox-all" type="checkbox" class="w-4 h-4 text-emerald-600 bg-gray-700 rounded border-gray-300 focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2  dark:border-gray-600">
                                            <label for="checkbox-all" class="sr-only">checkbox</label>
                                        </div>
                                    </th>
                                    <th scope="col" class="p-4">ID</th>
                                    <th scope="col" class="p-4">Kunde</th>
                                    <th scope="col" class="p-4">Datum</th>
                                    <th scope="col" class="p-4">Bestellwert</th>
                                    <th scope="col" class="p-4">
                                        <div class="flex space-x-1 5 items-center">
                                            <p>Versandstatus</p>
                                            {% if request|get_parameter:'status' %}
                                            <div>
                                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M5.05 3C3.291 3 2.352 5.024 3.51 6.317l5.422 6.059v4.874c0 .472.227.917.613 1.2l3.069 2.25c1.01.742 2.454.036 2.454-1.2v-7.124l5.422-6.059C21.647 5.024 20.708 3 18.95 3H5.05Z"></path>
                                                </svg>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </th>
                                    <th scope="col" class="p-4">Versanddatum</th>
                                    <th scope="col" class="p-4">
                                        <div class="flex space-x-1 5 items-center">
                                            <p>Versandart</p>
                                            {% if request|get_parameter:'delivery_type' %}
                                            <div>
                                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M5.05 3C3.291 3 2.352 5.024 3.51 6.317l5.422 6.059v4.874c0 .472.227.917.613 1.2l3.069 2.25c1.01.742 2.454.036 2.454-1.2v-7.124l5.422-6.059C21.647 5.024 20.708 3 18.95 3H5.05Z"></path>
                                                </svg>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </th>
                                    <th scope="col" class="p-4">
                                        <div class="flex space-x-1 5 items-center">
                                            <p>Rezeptstatus</p>
                                            {% if request|get_parameter:'online_recipe_status' %}
                                            <div>
                                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M5.05 3C3.291 3 2.352 5.024 3.51 6.317l5.422 6.059v4.874c0 .472.227.917.613 1.2l3.069 2.25c1.01.742 2.454.036 2.454-1.2v-7.124l5.422-6.059C21.647 5.024 20.708 3 18.95 3H5.05Z"></path>
                                                </svg>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </th>
                                    <th scope="col" class="p-4">
                                        <div class="flex space-x-1 5 items-center">
                                            <p>Rezeptart</p>
                                            {% if request|get_parameter:'customer_type' %}
                                            <div>
                                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M5.05 3C3.291 3 2.352 5.024 3.51 6.317l5.422 6.059v4.874c0 .472.227.917.613 1.2l3.069 2.25c1.01.742 2.454.036 2.454-1.2v-7.124l5.422-6.059C21.647 5.024 20.708 3 18.95 3H5.05Z"></path>
                                                </svg>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </th>
                                    <th scope="col" class="p-4">Rezeptnummer</th>
                                    <th scope="col" class="p-4">
                                        <div class="flex space-x-1 5 items-center">
                                            <p>Zahlungsstatus</p>
                                            {% if request|get_parameter:'payment_status' %}
                                            <div>
                                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M5.05 3C3.291 3 2.352 5.024 3.51 6.317l5.422 6.059v4.874c0 .472.227.917.613 1.2l3.069 2.25c1.01.742 2.454.036 2.454-1.2v-7.124l5.422-6.059C21.647 5.024 20.708 3 18.95 3H5.05Z"></path>
                                                </svg>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </th>
                                    <th scope="col" class="p-4">
                                        <div class="flex space-x-1 5 items-center">
                                            <p>Zahlungsmethode</p>
                                            {% if request|get_parameter:'payment_type' %}
                                            <div>
                                                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M5.05 3C3.291 3 2.352 5.024 3.51 6.317l5.422 6.059v4.874c0 .472.227.917.613 1.2l3.069 2.25c1.01.742 2.454.036 2.454-1.2v-7.124l5.422-6.059C21.647 5.024 20.708 3 18.95 3H5.05Z"></path>
                                                </svg>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </th>
                                    <th scope="col" class="p-4">Artikelanzahl</th>
                                    <th scope="col" class="p-4">Angelegt von</th>
                                    <th scope="col" class="p-0 sticky right-0">
                                        <div class="p-4 bg-gray-50 flex h-full w-full" style="height: 64.5px;">
                                            <span class="my-auto">Update</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in orders %}
                                <tr id="order-{{ order.id }}" data-order-id="{{ order.id }}" class="orders border-t *:hover:bg-gray-100 *:dark:hover:bg-gray-600 order {% if order.payment_status == 'overdue' %}overdue{% endif %} {% if order.status == 'started' %}order-started{% endif %}">
                                    <!-- Checkbox -->
                                    <td class="pl-4 pr-2 py-3 w-4 relative">
                                        {% if order.created_by.is_staff %}
                                        <div class="absolute top-0 left-0 staff-flag"></div>
                                        {% endif %}
                                        <div class="flex items-center">
                                            <input id="order-checkbox-{{ order.id }}" value="{{ order.id }}" type="checkbox" onclick="event.stopPropagation()" class="order-checkbox w-4 h-4 text-emerald-600 bg-gray-700 rounded border-gray-300 focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2  dark:border-gray-600">
                                            <label for="order-checkbox-{{ order.id }}" class="sr-only">checkbox</label>
                                        </div>
                                    </td>
                                    <!-- Bestellnummer -->
                                    <td class="relative px-4 py-3 font-medium text-gray-900 whitespace-nowrap " name="orderNumber">
                                        <div class="flex">
                                            <a href="javascript:void(0)" class="text-emerald-600 dark:text-emerald-500" onclick="showProducts('{{ order.id }}', this)">{{ order.number }}</a>
                                            <div name="intern_comment_icon" class="ml-2 {% if not order.intern_comment %}hidden{% endif %}">
                                                <svg data-tooltip-target="internComment" class="w-5 h-5 text-emerald-600 dark:text-emerald-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                                    <path fill-rule="evenodd" d="M3.559 4.544c.355-.35.834-.544 1.33-.544H19.11c.496 0 .975.194 1.33.544.356.35.559.829.559 1.331v9.25c0 .502-.203.981-.559 1.331-.355.35-.834.544-1.33.544H15.5l-2.7 3.6a1 1 0 0 1-1.6 0L8.5 17H4.889c-.496 0-.975-.194-1.33-.544A1.868 1.868 0 0 1 3 15.125v-9.25c0-.502.203-.981.559-1.331ZM7.556 7.5a1 1 0 1 0 0 2h8a1 1 0 0 0 0-2h-8Zm0 3.5a1 1 0 1 0 0 2H12a1 1 0 1 0 0-2H7.556Z" clip-rule="evenodd"/>
                                                </svg>
                                                <div id="internComment" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium transition-opacity duration-300 bg-gray-900 rounded-full shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                                    Interner Kommentar vorhanden
                                                    <div class="tooltip-arrow" data-popper-arrow></div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <!-- Kundeninformationen -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap ">
                                        <div hidden>
                                            <div data-name="popover-content-{{ order.id }}">
                                                <p class="text-gray-500 dark:text-gray-400" name="customerId">Kunden-Nr.: {{ order.customer.id }}</p>
                                                <p class="text-gray-500 dark:text-gray-400">
                                                    <span name="street">{{ order.street }}</span> <span name="streetNumber">{{ order.street_number }}</span><br>
                                                    <span name="postalcode">{{ order.postalcode }}</span> <span name="city">{{ order.city }}</span>
                                                </p>
                                            </div>
                                        </div>
                                        <a id="customer{{ order.id }}" tabindex="0" class="btn btn-lg btn-danger flex" data-bs-trigger="focus" data-bs-placement="top" data-bs-custom-class="custom-popover" role="button" data-bs-toggle="popover" title="{{ order.first_name }} {{ order.last_name }}" >
                                            <span name="customerName">{{ order.first_name }} {{ order.last_name }}</span>
                                            <svg style="margin-top: 2px;" class="ml-3 mt-0 w-4 h-4 text-gray-400 hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9h2v5m-2 0h4M9.408 5.5h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                                            </svg>
                                        </a>
                                    </td>
                                    <!-- Bestellzeit -->
                                    <td class="px-4 py-3 fontmedium text-gray-900 whitespace-nowrap " name="orderDate">{{ order.order_time|date:'d.m.Y' }}{% if request.user.is_superuser %} - {{ order.order_time|date:'H:i' }}{% endif %}</td>
                                    <!-- Betrag -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap " name="total">{{ order.total|to_euro_decimal }} ‚Ç¨</td>
                                    <!-- Lieferstatus -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap ">
                                        <button id="status{{ order.id }}" data-dropdown-toggle="dropdownSendungsstatus{{ order.id }}" class="status flex justify-between items-center py-2 pr-4 pl-3 w-full font-medium text-gray-700 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-emerald-700 md:p-0 md:w-auto">
                                            <div class="h-3 w-3 rounded-full mr-2 status-circle border-2" value="{{ order.status }}"></div>
                                            <span>{{ order.get_status_display }}</span>
                                            <svg class="ml-1 w-4 h-4" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                        </button>
                                        <div id="dropdownSendungsstatus{{ order.id }}" class="status z-20 w-56 font-normal bg-white rounded divide-y divide-gray-100 shadow hidden"  bis_skin_checked="1" data-popper-placement="top">
                                            <ul class="py-1 text-sm text-gray-700 dark:text-gray-400" aria-labelledby="dropdownLargeButton">
                                                {% get_choices "OrderStatusChoices" as OrderStatusChoices %}
                                                {% for item in OrderStatusChoices %}
                                                {% if request.user.is_superuser or item.2 %}
                                                <li>
                                                    <a href="javascript:void(0)" name="status" value="{{ item.0 }}" onclick="changeStatus(this, '{{ order.id }}')" class="flex py-2 px-3 hover:bg-gray-100 ">
                                                        <div class="h-3 w-3 mt-1 rounded-full mr-2 status-circle border-2" value="{{ item.0 }}"></div>{{ item.1 }} 
                                                    </a>
                                                </li>
                                                {% endif %}
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </td>
                                    <!-- Lieferdatum -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap " name="orderDate">
                                        {% if order.delivered_on %}
                                        {{ order.delivered_on|date:'d.m.Y' }}
                                        {% else %}
                                        --
                                        {% endif %}
                                    </td>
                                    <!-- Versandart -->
                                    <td class="px-4 py-3">
                                        <button id="deliveryType-{{ order.id }}" data-dropdown-toggle="dropdownDelvieryType{{ order.id }}" class="payment_status flex justify-between items-center py-2 pr-4 pl-3 w-full font-medium text-gray-700 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-emerald-700 md:p-0 md:w-auto dark:text-gray-400 dark:hover:dark:focus:dark:border-gray-700 dark:hover:bg-gray-700 md:dark:hover:bg-transparent">
                                            <span style="white-space: nowrap;"
                                                class="text-xs font-medium px-2 py-0.5 rounded-full
                                                {% if order.delivery_type == 'pickup' %}
                                                bg-emerald-600 text-white
                                                {% elif order.delivery_type == 'dhl_standard' %}
                                                bg-yellow-100 text-yellow-800
                                                {% elif order.delivery_type == 'go_express' %}
                                                bg-red-100 text-red-800
                                                {% endif %}
                                                "
                                                value="{{ order.delivery_type }}">
                                                    {{ order.get_delivery_type_display }}
                                            </span>
                                            <svg class="ml-1 w-4 h-4" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                        </button>
                                        <div id="dropdownDelvieryType{{ order.id }}" class="delivery_type z-20 w-44 font-normal bg-white rounded divide-y divide-gray-100 shadow dark:divide-gray-600 hidden"  bis_skin_checked="1" data-popper-placement="top">
                                            <ul class="py-1 text-sm text-gray-700 dark:text-gray-400" aria-labelledby="dropdownLargeButton">
                                                {% get_choices "DeliveryTypeChoices" as DeliveryTypeChoices %}
                                                {% for item in DeliveryTypeChoices %}
                                                {% if item.0|delivery_type_check_activated:order.pharmacy %}
                                                <li>
                                                    <a href="javascript:void(0)" value="{{ item.0 }}" onclick="changeDeliveryType('{{ order.id }}', '{{ item.0 }}', this)" class="flex py-2 px-3 hover:bg-gray-100 ">
                                                        <span style="white-space: nowrap;"
                                                        class="text-xs font-medium px-2 py-0.5 rounded-full
                                                        {% if item.0 == 'pickup' %}
                                                        bg-emerald-600 text-white
                                                        {% elif item.0 == 'dhl_standard' %}
                                                        bg-yellow-100 text-yellow-800
                                                        {% elif item.0 == 'go_express' %}
                                                        bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300
                                                        {% endif %}
                                                        ">
                                                            {{ item.1 }}
                                                        </span>
                                                    </a>
                                                </li>
                                                {% endif %}
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </td>
                                    <!-- ONLINE Rezeptstatus -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap ">
                                        <button id="online_recipe_status{{ order.id }}" data-dropdown-toggle="dropdownOnlineRezeptsstatus{{ order.id }}" class="online_recipe_status flex justify-between items-center py-2 pr-4 pl-3 w-full font-medium text-gray-700 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-emerald-700 md:p-0 md:w-auto dark:text-gray-400 dark:hover:dark:focus:dark:border-gray-700 dark:hover:bg-gray-700 md:dark:hover:bg-transparent">
                                            <div class="h-3 w-3 rounded-full mr-2 status-circle" value="{{ order.online_recipe_status }}"></div><span>{{ order.get_online_recipe_status_display }}</span>
                                            <svg class="ml-1 w-4 h-4" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                        </button>
                                        <div id="dropdownOnlineRezeptsstatus{{ order.id }}" class="online_recipe_status z-20 w-44 font-normal bg-white rounded divide-y divide-gray-100 shadow dark:divide-gray-600 hidden"  bis_skin_checked="1" data-popper-placement="top">
                                            <ul class="py-1 text-sm text-gray-700 dark:text-gray-400" aria-labelledby="dropdownLargeButton">
                                                {% get_choices "OnlineRecipeStatusChoices" as OnlineRecipeStatusChoices %}
                                                {% for item in OnlineRecipeStatusChoices %}
                                                <li>
                                                    <a href="javascript:void(0)" name="online_recipe_status" value="{{ item.0 }}" onclick="changeStatus(this, '{{ order.id }}')" class="flex py-2 px-3 hover:bg-gray-100 ">
                                                        <div class="h-3 w-3 mt-1 rounded-full mr-2 status-circle" value="{{ item.0 }}"></div>{{ item.1 }} 
                                                    </a>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </td>
                                    <!-- Rezeptart -->
                                    <td class="px-4 py-3">
                                        <button id="customerType-{{ order.id }}" data-dropdown-toggle="dropdownCustomerType{{ order.id }}" class="payment_status flex justify-between items-center py-2 pr-4 pl-3 w-full font-medium text-gray-700 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-emerald-700 md:p-0 md:w-auto dark:text-gray-400 dark:hover:dark:focus:dark:border-gray-700 dark:hover:bg-gray-700 md:dark:hover:bg-transparent">
                                            <span style="white-space: nowrap;"
                                                class="text-xs font-medium px-2 py-0.5 rounded-full
                                                {% if order.customer_type == 'self_payer' %}
                                                bg-emerald-600 text-white
                                                {% elif order.customer_type == 'insurance_patient' %}
                                                bg-purple-100 text-purple-800
                                                {% elif order.customer_type == 'insurance_patient_with_supplement' %}
                                                bg-emerald-600 text-white
                                                {% endif %}
                                                "
                                                value="{{ order.customer_type }}">
                                                    {{ order.get_customer_type_display }}
                                            </span>
                                            <svg class="ml-1 w-4 h-4" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                        </button>
                                        <div id="dropdownCustomerType{{ order.id }}" class="customer_type z-20 w-56 font-normal bg-white rounded divide-y divide-gray-100 shadow dark:divide-gray-600 hidden"  bis_skin_checked="1" data-popper-placement="top">
                                            <ul class="py-1 text-sm text-gray-700 dark:text-gray-400" aria-labelledby="dropdownLargeButton">
                                                {% get_choices "CustomerTypeChoices" as CustomerTypeChoices %}
                                                {% for item in CustomerTypeChoices %}
                                                <li>
                                                    <a href="javascript:void(0)" value="{{ item.0 }}" onclick="changeCustomerType('{{ order.id }}', '{{ item.0 }}', this)" class="flex py-2 px-3 hover:bg-gray-100 ">
                                                        <span style="white-space: nowrap;"
                                                        class="text-xs font-medium px-2 py-0.5 rounded-full
                                                        {% if item.0 == 'self_payer' %}
                                                        bg-emerald-600 text-white
                                                        {% elif item.0 == 'insurance_patient' %}
                                                        bg-purple-100 text-purple-800
                                                        {% elif item.0 == 'insurance_patient_with_supplement' %}
                                                        bg-emerald-600 text-white
                                                        {% endif %}
                                                        ">
                                                            {{ item.1 }}
                                                        </span>
                                                    </a>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </td>
                                    <!-- Rezeptnummer -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap ">
                                        {% for recipe in order|get_recipes %}
                                        <a href="{{ recipe.file.url }}" target="_blank">{{ recipe.number }}</a>
                                        {% endfor %}
                                    </td>
                                    <!-- Zahlungsstatus -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap ">
                                        <div class="d-flex">
                                            <button id="payment_status{{ order.id }}" data-dropdown-toggle="dropdownZahlungsstatus{{ order.id }}" class="payment_status flex justify-between items-center py-2 pr-4 pl-3 w-full font-medium text-gray-700 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-emerald-700 md:p-0 md:w-auto dark:text-gray-400 dark:hover:dark:focus:dark:border-gray-700 dark:hover:bg-gray-700 md:dark:hover:bg-transparent">
                                                {% if order.payment_status in 'overdue' %}
                                                <svg class="w-4 h-4 mr-2 text-red-700 dark:text-red-600" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V8m0 8h0m9-4a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                                                </svg>                                    
                                                {% else %}
                                                <div class="h-3 w-3 rounded-full mr-2 status-circle" value="{{ order.payment_status }}"></div>
                                                {% endif %}
                                                <span>{{ order.get_payment_status_display }}</span>
                                                <svg class="ml-1 w-4 h-4" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                            </button>
                                            {% if order.payed_on %}({{order.payed_on}}){% endif %}
                                        </div>
                                        <div id="dropdownZahlungsstatus{{ order.id }}" class="payment_status z-20 w-56 font-normal bg-white rounded divide-y divide-gray-100 shadow hidden"  bis_skin_checked="1" data-popper-placement="top">
                                            <ul class="py-1 text-sm text-gray-700 dark:text-gray-400" aria-labelledby="dropdownLargeButton">
                                                {% get_choices "PaymentStatusChoices" as PaymentStatusChoices %}
                                                {% for item in PaymentStatusChoices %}
                                                {% if request.user.is_superuser or item.2 %}
                                                <li>
                                                    <a href="javascript:void(0)" name="payment_status" value="{{ item.0 }}" onclick="changeStatus(this, '{{ order.id }}')" class="flex py-2 px-3 hover:bg-gray-100 ">
                                                        <div class="h-3 w-3 mt-1 rounded-full mr-2 status-circle" value="{{ item.0 }}"></div>{{ item.1 }} 
                                                    </a>
                                                </li>
                                                {% endif %}
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </td>
                                    <!-- Bezahlmethode -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap ">{{ order.get_payment_type_display }}</td>
                                    <!-- Anzahl produkte -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap " name="orderAmount">{{ order|get_order_products|length }}</td>
                                    <!-- Angelegt von -->
                                    <td class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap ">
                                        {% if order.created_by %}
                                        {% if order.created_by.is_staff %}
                                        {{ order.created_by.get_full_name }}
                                        {% else %}
                                        Kunde
                                        {% endif %}
                                        {% else %}
                                        --
                                        {% endif %}
                                    </td>
                                    <!-- Edit Button -->
                                    <td class="p-0 font-medium text-gray-900 whitespace-nowrap  sticky right-0 bg-white dark:bg-gray-800">
                                        <div class="px-4 py-3">
                                            <div class="flex items-center space-x-4">
                                                {% if order.payment_type == 'payment_by_invoice' and not order.ident_check %}
                                                <button type="button" onclick="getOrderDetailsForIdentCheck('{{ order.id }}')" id="identCheckButton" class="flex items-center justify-center bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-full text-sm px-4 py-2 dark:bg-red-600 dark:hover:bg-red-700 focus:outline-none dark:focus:ring-red-800">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 -ml-0.5" fill="currentColor" height="16" width="16" viewBox="0 0 512 512">
                                                        <path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c-13.3 0-24 10.7-24 24V264c0 13.3 10.7 24 24 24s24-10.7 24-24V152c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/>
                                                    </svg>
                                                    ID √úberpr√ºfen
                                                </button>
                                                {% elif order.payment_type == 'payment_by_invoice' and order.ident_check %}
                                                <button type="button" disabled class="flex items-center justify-center bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 font-medium rounded-full text-sm px-4 py-2 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 -ml-0.5" fill="currentColor" height="16" width="16" viewBox="0 0 512 512">
                                                        <path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z"/>
                                                    </svg>
                                                    ID √úberpr√ºft 
                                                </button>
                                                {% endif %}
                                                <button type="button" onclick="getOrderDetails('{{ order.id }}')" id="createProductButton" class="flex items-center justify-center bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 font-medium rounded-full text-sm px-4 py-2 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 -ml-0.5" viewbox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                        <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                                                        <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                                                    </svg>
                                                    Edit
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="hidden order-products" id="products-order-{{ order.id }}">
                                    <td colspan="1" class="px-4 py-3"></td>
                                    <td colspan="16" class="px-4 py-3">
                                        <div>
                                            <table class="products">
                                                <tr>
                                                    <th class="pr-4 py-1 text-left">Produkt</th>
                                                    <th class="px-4 py-1 text-right">Menge</th>
                                                    <th class="px-4 py-1 text-left">Lieferant</th>
                                                    <th class="px-4 py-1 text-left">Form</th>
                                                    <th class="px-4 py-1 text-left">Abgabeform</th>
                                                    <th class="px-4 py-1 text-right">Preis</th>
                                                    <th class="px-4 py-1 text-right">Rezeptnummer</th>
                                                </tr>
                                                {% for ordered_product in order|get_order_products %}
                                                <tr>
                                                    <td class="pr-4 py-1 text-left">{{ ordered_product.product.name }}</td>
                                                    <td class="px-4 py-1 text-right">{{ ordered_product.amount }} {% if ordered_product.product.form == 'flower' %}g{% else %}Einh.{% endif %}</td>
                                                    <td class="px-4 py-1 text-left">{{ ordered_product.product.supplier.name }}</td>
                                                    <td class="px-4 py-1 text-left">{{ ordered_product.product.get_form_display }}</td>
                                                    <td class="px-4 py-1 text-left">{% if ordered_product.prepared %}Zerkleinert{% else %}unver√§ndert{% endif %}</td>
                                                    <td class="px-4 py-1 text-right">{{ ordered_product.total|to_euro_decimal }} ‚Ç¨</td>
                                                    <td class="px-4 py-1 text-right">{{ ordered_product.recipe_file.number }}</td>
                                                </tr>
                                                {% endfor %}
                                            </table>
                                        </div>
                                        <!-- Fragen zur Bestellung -->
                                        <div name="queries" class="pt-3 mt-3 border-t border-gray-600 {% if not order.queries_comment %}hidden{% endif %}">
                                            <p><b>R√ºckfragen:</b> <span>{{ order.queries_comment }}</span></p>
                                        </div>
                                        <!-- Kommentar zur Kl√§rung -->
                                        <div name="clarified" class="pt-3 {% if not order.clarified_comment %}hidden{% endif %}">
                                            <p><b>Kl√§rung:</b> <span>{{ order.clarified_comment }}</span></p>
                                        </div>
                                        <!-- Interner Kommentar -->
                                        <div class="mt-3 border-t border-gray-600">
                                            <div name="intern_comment" class="mt-3 {% if not order.intern_comment %}hidden{% endif %}">
                                                <p><b>Kommentar:</b> <span>{{ order.intern_comment }}</span></p>
                                            </div>
                                            <div class="flex flex-col mt-3 items-start">
                                                <button name="intern_comment_button" type="button" onclick="editInternComment('{{ order.id }}')" class="text-xs text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full px-4 py-2 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">
                                                    Kommentar bearbeiten
                                                </button>
                                                <div class="hidden" name="intern_comment_field">
                                                    <textarea name="intern_comment" class="border w-96 border-gray-300 rounded-md shadow-sm dark:border-gray-700 dark:text-gray-400 focus:border-emerald-300 focus:ring focus:ring-emerald-200 focus:ring-opacity-50" placeholder="Interner Kommentar">{{ order.intern_comment }}</textarea>
                                                    <div class="flex flex-row gap-4 mt-3">
                                                        <button type="button" onclick="cancelInternComment('{{ order.id }}')" class="text-xs text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full px-4 py-2 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">
                                                            Abbrechen
                                                        </button>
                                                        <button type="button" onclick="saveInternComment('{{ order.id }}')" class="text-xs bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 font-medium rounded-full text-sm px-4 py-2 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800">
                                                            Speichern
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Rechnungen -->
                                        <div class="mt-3 border-t border-gray-600">
                                            <table class="invoices mt-3">
                                                <tr>
                                                    <th class="pr-4 py-1 text-left">Rechnungsnummer</th>
                                                    <th class="px-4 py-1 text-left">Datum</th>
                                                    <th class="px-4 py-1 text-right">Betrag</th>
                                                    <th class="pl-4 py-1 text-left">Status</th>
                                                </tr>
                                                {% for invoice in order|get_invoices_by_order %}
                                                <tr class="{% if invoice.status == 'canceled' %}opacity-60{% endif %}">
                                                    <td class="pr-4 py-1 text-left">{{ invoice.invoice_number }}</td>
                                                    <td class="px-4 py-1 text-left">{{ invoice.date_time|date:"d.m.Y" }}</td>
                                                    <td class="px-4 py-1 text-right">{{ invoice.total|to_euro_decimal }} ‚Ç¨</td>
                                                    <td class="pl-4 py-1 text-left">{{ invoice.get_status_display }}</td>
                                                </tr>
                                                {% endfor %}
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <nav class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-3 md:space-y-0 p-4 border-gray-600 border-t" aria-label="Table navigation">
                        <ul class="inline-flex items-stretch -space-x-px">
                            {% with orders.paginator.page_range|first as first_page %}
                            {% with 'page:'|concat_string:first_page as page_string %}
                            {% with updated_params=request.GET|add_get_parameter:page_string %}
                            <li>
                                <a href="?{{ updated_params }}" class="flex items-center justify-center h-full py-1.5 px-3 ml-0 text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                                    <span class="sr-only">Erste Seite</span>
                                    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" viewBox="0 0 12 10">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 1 1 5l4 4m6-8L7 5l4 4"/>
                                    </svg>
                                </a>
                            </li>
                            {% endwith %}
                            {% endwith %}
                            {% endwith %}
                            {% for page_num in orders.paginator.page_range|get_page_range:orders.number %}
                            {% if orders.number == page_num %}
                            <li>
                                <a href="?{{ updated_params }}" aria-current="page" class="flex items-center justify-center text-sm z-10 py-2 px-3 leading-tight text-emerald-600 bg-emerald-50 border border-emerald-300 hover:bg-emerald-100 hover:text-emerald-700 dark:border-gray-700 ">{{ page_num }}</a>
                            </li>
                            {% else %}
                            {% with 'page:'|concat_string:page_num as page_string %}
                            {% with updated_params=request.GET|add_get_parameter:page_string %}
                            <li>
                                <a href="?{{ updated_params }}" class="flex items-center justify-center text-sm py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">{{ page_num }}</a>
                            </li>
                            {% endwith %}
                            {% endwith %}
                            {% endif %}
                            {% endfor %}
                            {% with orders.paginator.page_range|last as last_page %}
                            {% with 'page:'|concat_string:last_page as page_string %}
                            {% with updated_params=request.GET|add_get_parameter:page_string %}
                            <li>
                                <a href="?{{ updated_params }}" class="flex items-center justify-center h-full py-1.5 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                                    <span class="sr-only">Letzte Seite</span>
                                    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" viewBox="0 0 12 10">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="m7 9 4-4-4-4M1 9l4-4-4-4"/>
                                    </svg>
                                </a>
                            </li>
                            {% endwith %}
                            {% endwith %}
                            {% endwith %}
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End block -->

<div id="identCheck" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] md:h-full">
    <div class="relative w-full h-full md:h-auto" style="max-width: 75vw;max-height: 80vh;overflow-y: auto;">
        <!-- Modal content -->
        <div class="relative p-4 bg-white shadow sm:p-5">
            <!-- Modal header -->
            <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 dark:border-gray-400">
                <h3 class="text-lg font-semibold text-gray-900 ">Ident Check f√ºr Kauf auf Rechnung</h3>
                <button type="button" onclick="hideModal('identCheck')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5 ml-auto inline-flex items-center ">
                    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <div class="mb-5">
                <h3 class="text-lg font-semibold text-gray-900 ">Bitte √ºberpr√ºfe die Daten der Bestellung mit den Daten auf dem Ausweisdokument sorgf√§ltig!</h3>
                <div class="flex pt-4 gap-4">
                    <div class="left-container ident-check-images">
                    </div>
                    <div class="right-container flex-1">
                        <form class="pt-5" id="identCheckDetailsForm">
                            <input type="text" name="orderId" hidden>
                            <div class="flex mb-2">
                                <div class="grid gap-4 mb-4 sm:grid-cols-3 flex-1">
                                    <div>
                                        <label for="orderNumber" class="block mb-2 text-sm font-medium text-gray-900 ">Bestellnummer</label>
                                        <input type="text" aria-label="disabled input" name="orderNumber" class="mb-6 bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 cursor-not-allowed dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" disabled>
                                    </div>
                                    <div>
                                        <label for="identNumber" class="block mb-2 text-sm font-medium text-gray-900 ">Ausweisnummer</label>
                                        <input type="text" aria-label="disabled input" name="identNumber" class="mb-6 bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 cursor-not-allowed dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" disabled>
                                    </div>
                                </div>
                                <div class="ms-4">
                                    <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900 ">Check</label>
                                    <input id="identCheck1" type="checkbox" value="" name="identCheckCheckbox" style="padding: 1.24rem;" class="mb-6 w-4 h-4 text-emerald-600 bg-gray-100 border-gray-300 rounded-full focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2 dark:border-gray-600">
                                </div>
                            </div>
                            <div class="flex mb-2">
                                <div class="grid gap-4 mb-4 sm:grid-cols-3 flex-1">
                                    <div>
                                        <label for="salutation" class="block mb-2 text-sm font-medium text-gray-900 ">Anrede</label>
                                        <select disabled id="salutation" name="salutation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                            {% get_choices "SalutationChoices" as SalutationChoices %}
                                            {% for item in SalutationChoices %}
                                            <option value="{{ item.0 }}">{{ item.1 }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div>
                                        <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900 ">Vorname</label>
                                        <input type="text" aria-label="disabled input" name="firstName" class="mb-6 bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 cursor-not-allowed dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" disabled>
                                        <!-- <input aria-label="disabled" disabled readonly type="text" name="firstName" id="first_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Vorname" required=""> -->
                                    </div>
                                    <div>
                                        <label for="last_name" class="block mb-2 text-sm font-medium text-gray-900 ">Nachname</label>          
                                        <input type="text" aria-label="disabled input" name="lastName" class="mb-6 bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 cursor-not-allowed dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" disabled>
                                        <!-- <input disabled readonly type="text" name="lastName" id="last_name" class="disabled bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Nachname" required=""> -->
                                    </div>
                                </div>
                                <div class="ms-4">
                                    <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900 ">Check</label>
                                    <input id="identCheck2" type="checkbox" value="" name="identCheckCheckbox" style="padding: 1.24rem;" class="mb-6 w-4 h-4 text-emerald-600 bg-gray-100 border-gray-300 rounded-full focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2 dark:border-gray-600">
                                </div>
                            </div>
                            <div class="flex mb-2">
                                <div class="grid gap-4 mb-4 sm:grid-cols-4 flex-1">
                                    <div>
                                        <label for="street" class="block mb-2 text-sm font-medium text-gray-900 ">Stra√üe</label>
                                        <input type="text" aria-label="disabled input" name="street" class="mb-6 bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 cursor-not-allowed dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" disabled>
                                        <!-- <input aria-label="disabled" disabled readonly type="text" name="firstName" id="first_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Vorname" required=""> -->
                                    </div>
                                    <div>
                                        <label for="streetNumber" class="block mb-2 text-sm font-medium text-gray-900 ">Stra√üennummer</label>          
                                        <input type="text" aria-label="disabled input" name="streetNumber" class="mb-6 bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 cursor-not-allowed dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" disabled>
                                        <!-- <input disabled readonly type="text" name="lastName" id="last_name" class="disabled bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Nachname" required=""> -->
                                    </div>
                                    <div>
                                        <label for="postalcode" class="block mb-2 text-sm font-medium text-gray-900 ">Postleitzahl</label>          
                                        <input type="text" aria-label="disabled input" name="postalcode" class="mb-6 bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 cursor-not-allowed dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" disabled>
                                        <!-- <input disabled readonly type="text" name="lastName" id="last_name" class="disabled bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Nachname" required=""> -->
                                    </div>
                                    <div>
                                        <label for="city" class="block mb-2 text-sm font-medium text-gray-900 ">Postleitzahl</label>          
                                        <input type="text" aria-label="disabled input" name="city" class="mb-6 bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 cursor-not-allowed dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" disabled>
                                        <!-- <input disabled readonly type="text" name="lastName" id="last_name" class="disabled bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Nachname" required=""> -->
                                    </div>
                                </div>
                                <div class="ms-4">
                                    <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900 ">Check</label>
                                    <input id="identCheck3" type="checkbox" value="" name="identCheckCheckbox" style="padding: 1.24rem;" class="mb-6 w-4 h-4 text-emerald-600 bg-gray-100 border-gray-300 rounded-full focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2 dark:border-gray-600">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-between pt-4 sm:flex sm:space-y-0 sm:space-x-4">
                <div class="mb-4 sm:mb-0 items-center d-flex space-y-4 sm:flex sm:space-y-0 sm:space-x-4">
                    <button disabled id="completeIdentCheck" type="button" onclick="completeIdentCheck('{{ order.id }}')" data-toast-name="orderUpdatedToast" type="submit" class="w-full sm:w-auto justify-center inline-flex bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800">
                        Speichern
                    </button>
                    <button onclick="hideModal('identCheck')" type="button" class="w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300">
                        <svg class="mr-1 -ml-1 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Abbrechen
                    </button>
                    
                </div>
                <hr class="block sm:none border border-gray-300 dark:border-gray-600">
                <button onclick="toggleStornoModal()" type="button" class="mt-4 mt-sm-0 w-full sm:w-auto justify-center inline-flex items-center bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800">
                    <svg class="mr-1 -ml-1 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Stornieren
                </button>
            </div>
            
        </div>
    </div>
</div>

<div id="importOrder" tabindex="-1" aria-hidden="true" class="modal-parent-div hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] md:h-full">
    <div class="relative w-full h-full md:h-auto" style="max-width: 75vw;max-height: 80vh;overflow-y: auto;">
        <!-- Modal content -->
        <div class="relative p-4 bg-white shadow sm:p-5">
            <!-- Modal header -->
            <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 dark:border-gray-400">
                <h3 class="text-lg font-semibold text-gray-900 ">Bestellung importieren</h3>
                <button type="button" onclick="hideModal('importOrder')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5 ml-auto inline-flex items-center ">
                    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <div class="mb-5">
                <form id="importOrderForm">
                    <div class="flex pt-4 gap-4">
                        <div class="ident-check-images flex flex-row gap-4">
                            <div class="mb-2 flex flex-col">
                                <textarea class="mb-2" id="htmlInputForImport" rows="10" cols="50" placeholder="F√ºge hier den HTML-Code der E-Mail ein"></textarea>
                                <button id="" type="button" onclick="extractData()"  type="submit" class="text-white w-full sm:w-auto justify-center inline-flex bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800">
                                   Daten √ºbertragen
                                </button>
                            </div>
                        </div>
                        <div class="right-container flex-1" style="border-left: 1px solid #4b5563; padding-left: 1rem;">
                            <!-- Hochladen -->
                            <div class="mt-4 flex flex-col gap-4 mb-5">
                                <div class="mr-auto w-96">
                                    <label class="block mb-2 text-sm font-medium text-gray-900 " for="recipeFile">Rezept hochladen</label>
                                    <input class="block w-full text-sm text-gray-900 border border-gray-300 rounded-full cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:placeholder-gray-400" aria-describedby="file_input_help" id="recipeFile" name="recipeFile" type="file">
                                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-300">PDF, PNG oder JPG.</p>
                                </div>
                                <div class="me-auto w-96">
                                    <label for="onlineRecipeStatus" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900 ">
                                        Online Rezeptstatus
                                    </label>
                                    <select id="onlineRecipeStatus" name="onlineRecipeStatus" class="bg-gray-50 border border-gray-300 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                        {% get_choices "OnlineRecipeStatusChoices" as OnlineRecipeStatusChoices %}
                                        {% for item in OnlineRecipeStatusChoices %}
                                        <option value="{{ item.0 }}">{{ item.1 }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <table hidden>
                                <tbody>
                                    <tr>
                                        <td class="text-md font-semibold text-gray-900 dark:text-gray-400">Name:</td>
                                        <td><span id="extractedName" class="text-md font-semibold text-gray-900  ms-2 ps-2"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="text-md font-semibold text-gray-900 dark:text-gray-400">Stra√üe / Hausnummer:</td>
                                        <td><span id="extractedAddress" class="text-md font-semibold text-gray-900  ms-2 ps-2"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="text-md font-semibold text-gray-900 dark:text-gray-400">PLZ/Ort:</td>
                                        <td><span id="extractedCity" class="text-md font-semibold text-gray-900  ms-2 ps-2"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="text-md font-semibold text-gray-900 dark:text-gray-400">E-Mail Adresse:</td>
                                        <td><span id="extractedEmail" class="text-md font-semibold text-gray-900  ms-2 ps-2"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="text-md font-semibold text-gray-900 dark:text-gray-400">Telefon:</td>
                                        <td><span id="extractedPhone" class="text-md font-semibold text-gray-900  ms-2 ps-2"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="text-md font-semibold text-gray-900 dark:text-gray-400">Geburtstag:</td>
                                        <td><span id="extractedBirthDate" class="text-md font-semibold text-gray-900  ms-2 ps-2"></span></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div hidden class="mt-4 mb-1">
                                <span class="mt-4 mb-3 text-md font-semibold text-gray-900 dark:text-gray-400">Bestellte Produkte:</span>
                            </div>
                            <div hidden>
                                <table id="extractedOrderTable" style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th><span class="pt-4 pb-3 text-md font-semibold text-gray-900 dark:text-gray-400 text-left">Sorte</span></th>
                                            <th><span class="pt-4 pb-3 text-md font-semibold text-gray-900 dark:text-gray-400">Kultivar</span></th>
                                            <th><span class="pt-4 pb-3 text-md font-semibold text-gray-900 dark:text-gray-400">Zerkleinert</span></th>
                                            <th><span class="pt-4 pb-3 text-md font-semibold text-gray-900 dark:text-gray-400">Menge</span></th>
                                        </tr>
                                    </thead>
                                    <tbody id="extractedOrderedProducts">
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div id="update-product-accordion-collapse-body-1-customer" aria-labelledby="update-product-accordion-collapse-heading-2">
                <div class="py-4 border-gray-200 sm:py-5 dark:border-gray-700">
                    <!-- Inputs -->
                        <!-- Column -->
                        <div class="">
                            <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                <!-- Salutation -->
                                <div>
                                    <label for="salutation" class="block mb-2 text-sm font-medium text-gray-900 ">Anrede</label>
                                    <select id="extracted_salutation" name="salutation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                        {% get_choices "SalutationChoices" as SalutationChoices %}
                                        {% for item in SalutationChoices %}
                                        <option value="{{ item.0 }}">{{ item.1 }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div></div>
                                <div>
                                    <label for="external_id" class="block mb-2 text-sm font-medium text-gray-900 ">Externe Bestell-ID</label>
                                    <input type="text" name="external_id" id="extracted_external_order_id" class="bg-gray-50 border border-gray-300 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Externe Bestell-ID" required="" readonly>
                                </div>
                            </div>
                            <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                <!-- Vorname -->
                                <div>
                                    <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900 ">Vorname</label>
                                    <input type="text" name="firstName" id="extracted_first_name" class="bg-gray-50 border border-gray-300 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Vorname" required="">
                                </div>
                                <!-- Nachname -->
                                <div>
                                    <label for="last_name" class="block mb-2 text-sm font-medium text-gray-900 ">Nachname</label>
                                    <input type="text" name="lastName" id="extracted_last_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Nachname" required="">
                                </div>
                                <!-- Geburtsdatum -->
                                <div class="relative max-w-sm">
                                    <label for="birth_date" class="block mb-2 text-sm font-medium text-gray-900 ">Geburtsdatum</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none">
                                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                            </svg>
                                        </div>
                                        <input datepicker datepicker-format="dd.mm.yyyy" type="text" id="extracted_birth_date" name="birthDate" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full ps-10 p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Geburtsdatum">
                                    </div>
                                </div>
                            </div>
                            <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                <!-- Stra√üe -->
                                <div>
                                    <label for="street" class="block mb-2 text-sm font-medium text-gray-900 ">Stra√üe</label>
                                    <input type="text" name="street" id="extracted_street" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Stra√üe" required="">
                                </div>
                                <!-- Hausnummer -->
                                <div>
                                    <label for="street_number" class="block mb-2 text-sm font-medium text-gray-900 ">Hausnummer</label>
                                    <input type="text" name="streetNumber" id="extracted_street_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Hausnummer" required="">
                                </div>
                                <!-- PLZ -->
                                <div>
                                    <label for="postalcode" class="block mb-2 text-sm font-medium text-gray-900 ">Postleitzahl</label>
                                    <input type="text" name="postalcode" id="extracted_postalcode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Postleitzahl" required="">
                                </div>
                            </div>
                            <div class="grid gap-4 mb-4 sm:grid-cols-2">
                                <!-- Stadt -->
                                <div>
                                    <label for="city" class="block mb-2 text-sm font-medium text-gray-900 ">Stadt</label>
                                    <input type="text" name="city" id="extracted_city" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Stadt" required="">
                                </div>
                                <!-- Land -->
                                <div>
                                    <label for="country" class="block mb-2 text-sm font-medium text-gray-900 ">Land</label>
                                    <select id="country" name="country" class="bg-gray-50 border border-gray-300 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                        {% get_choices "CountryChoices" as countries %}
                                        {% for item in countries %}
                                        <option value="{{item.0}}" {% if order.country == item.0 %}selected{% endif %}>{{ item.1 }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <!-- Telefonnummer -->
                                <div>
                                    <label for="phone_number" class="block mb-2 text-sm font-medium text-gray-900 ">Telefonnummer</label>
                                    <input type="text" name="phonenumber" id="extracted_phone_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Telefonnummer" required="">
                                </div>
                                <!-- E-Mail -->
                                <div>
                                    <label for="email_address" class="block mb-2 text-sm font-medium text-gray-900 ">E-Mail Adresse</label>
                                    <input type="email" name="email" id="extracted_email_address" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="E-Mail Adresse" required="">
                                </div>
                                <!-- Kommentar -->
                                <div class="sm:col-span-2">
                                    <label for="comment" class="block mb-2 text-sm font-medium text-gray-900 ">Kommentar</label>
                                    <textarea id="comment" name="comment" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-sm border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Kommentar"></textarea>
                                </div>
                            </div>
                        </div>
                </div>
            </div>

            <span class="mt-4 mb-3 text-md font-semibold text-gray-900 ">Bestellte Produkte:</span>

            <h3 id="no-products-found-text" class="hidden mt-4 text-md font-semibold text-red-600 dark:red-600">Ein oder mehrere Produkte konnten nicht gefunden werden. Bitte √ºberpr√ºfen und erneut versuchen.</h3>

            <!-- Suche -->
            <div class="grid gap-4 sm:grid-cols-2">
                <div class="relative searchProductContainer mt-5">
                    <div class="absolute inset-y-0 start-0 flex items-center ps-4 pointer-events-none">
                        <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12.013 6.175 7.006 9.369l5.007 3.194-5.007 3.193L2 12.545l5.006-3.193L2 6.175l5.006-3.194 5.007 3.194ZM6.981 17.806l5.006-3.193 5.006 3.193L11.987 21l-5.006-3.194Z"/>
                            <path d="m12.013 12.545 5.006-3.194-5.006-3.176 4.98-3.194L22 6.175l-5.007 3.194L22 12.562l-5.007 3.194-4.98-3.211Z"/>
                        </svg>
                    </div>
                    <input type="text" id="searchProduct" dropdown-max-height="250" data-search-type="import-order-search-product" class="searchProductInput bg-gray-50 border w-full border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block ps-10 p-2 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Produktsuche" required>
                </div>
            </div>

            <!-- Produktliste -->
            <div id="update-product-accordion-collapse-body-4-2" aria-labelledby="update-product-accordion-collapse-heading-3" class="mb-4">
                <div class="border-gray-200 dark:border-gray-700">
                    <div id="extractedOrderedProductList" class="flex flex-col gap-4">
                        <!-- Bestelltes Produkt: ID xxx -->
                        <div></div>
                    </div>
                </div>
            </div>

            <h2 id="order-already-exists" class="hidden mt-4 text-md font-semibold text-red-600 dark:red-600">Bestellung existiert bereits. Bitte √ºberpr√ºfen.</h2>
            <h2 id="order-receipt-missing" class="hidden mt-4 text-md font-semibold text-red-600 dark:red-600">Bitte Rezept anh√§ngen.</h2>

            <h3 class="pt-5 text-md font-semibold text-gray-900 ">Bitte √ºberpr√ºfe die Daten vor dem Speichern sorgf√§ltig! Achte ebenfalls auf die Anrede.</h3>

            <div class="d-flex justify-between pt-4 sm:flex sm:space-y-0 sm:space-x-4">
                <div class="mb-4 sm:mb-0 items-center d-flex space-y-4 sm:flex sm:space-y-0 sm:space-x-4">
                    <button id="checkAvailabilityBtn" type="button" class="w-full sm:w-auto justify-center text-white inline-flex bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800">
                        Verf√ºgbarkeit pr√ºfen
                    </button>
                    
                    <button disabled id="sendExtractedData" type="button" onclick="sendExtractedData()" data-toast-name="orderUpdatedToast" type="submit" class="w-full sm:w-auto justify-center inline-flex text-white bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800">
                        Speichern
                    </button>
                    <button onclick="hideModal('importOrder')" type="button" class="w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                        <svg class="mr-1 -ml-1 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Abbrechen
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="orderModal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden rounded-xl fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] md:h-full">
    <div class="relative w-full h-full md:h-auto" style="max-width: 75vw;max-height: 80vh;overflow-y: auto;">
        <!-- Modal content -->
        <div class="relative p-4 bg-white shadow sm:p-5 rounded-xl ">
            <!-- Modal header -->
            <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 dark:border-gray-400">
                <h3 class="text-lg font-semibold text-gray-900 ">Bestellung (Detailansicht)</h3>
                <button type="button" onclick="hideModal('orderModal')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5 ml-auto inline-flex items-center ">
                    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <div>
                <!-- <h5 class="mb-4 text-lg font-semibold tracking-tight text-gray-900 ">
                    Bestelldaten
                </h5> -->
                <div class="grid gap-4 mb-5 sm:grid-cols-5">
                    <!-- Bestellnummer -->
                    <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-xl focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                        <p class="mb-2 text-sm font-medium text-gray-900 ">
                            Bestellnummer
                        </p>
                        <span id="order_number" name="orderNumber" class="mb-4 text-sm font-medium text-gray-900 dark:text-gray-300">
                            
                        </span>
                    </div>
                    <!-- Rezeptnummer -->
                    <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-xl focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                        <div>
                            <div class="flex flex-row space justify-between mb-3">
                                <p class="mb-2 text-sm font-medium text-gray-900 ">
                                    Rezepte
                                </p>
                                <button type="button" onclick="uploadNewRecipeFile()" class="text-xs text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full px-4 py-2 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">
                                    Hochladen
                                </button>
                            </div>
                            <div class="recipe-files">
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between">
                                <span id="insuranceConfirmation" name="insuranceConfirmation" class="mb-4 text-sm font-medium text-gray-900 dark:text-gray-300">
                                    Kosten√ºbernahme
                                </span>

                                <a href="#" target="_blank" name="insuranceConfirmationURL">
                                    <svg class="w-4 h-4 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M14.707 7.793a1 1 0 0 0-1.414 0L11 10.086V1.5a1 1 0 0 0-2 0v8.586L6.707 7.793a1 1 0 1 0-1.414 1.414l4 4a1 1 0 0 0 1.416 0l4-4a1 1 0 0 0-.002-1.414Z"/>
                                    <path d="M18 12h-2.55l-2.975 2.975a3.5 3.5 0 0 1-4.95 0L4.55 12H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2Zm-3 5a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/>
                                </svg>
                                </a>

                            </div>
                        </div>
                    </div>
                    <!-- Bestelldatum -->
                    <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-xl focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                        <p class="mb-2 text-sm font-medium text-gray-900 ">
                            Bestelldatum
                        </p>
                        <span id="order_time" name="orderDate" class="mb-4 text-sm font-medium text-gray-900 dark:text-gray-300">
                        </span>
                    </div>
                    <!-- Bestellsumme -->
                    <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-xl focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                        <p class="mb-2 text-sm font-medium text-gray-900 ">
                            Bestellsumme
                        </p>
                        <span id="total" name="orderAmount" class="mb-4 text-sm font-medium text-gray-900 dark:text-gray-300"></span>
                    </div>
                    <!-- Versicherungsinfo -->
                    <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-xl focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                        <p class="mb-2 text-sm font-medium text-gray-900 ">
                            Versicherung
                        </p>
                        <div class="flex flex-col">
                            <span id="healthInsuranceCompany" name="healthInsuranceCompany" class="mb-1 text-sm font-medium text-gray-900 dark:text-gray-300">
                            </span>
                            <span id="healthInsuranceContactPerson" name="healthInsuranceContactPerson" class="text-sm font-medium text-gray-900 dark:text-gray-300">
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <hr class="border border-gray-300 dark:border-gray-600"> -->
            <hr class="border border-gray-300 dark:border-gray-600">
            <form class="pt-5" id="orderDetailsForm">
                <input type="text" name="orderId" hidden>
                <div id="accordion-collapse" data-accordion="">
                    <h2 id="update-product-accordion-collapse-heading-1" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 sm:px-5 bg-gray-50 dark:border-gray-700  hover:bg-gray-100 dark:hover:bg-gray-600" data-accordion-target="#update-product-accordion-collapse-body-1" aria-expanded="true" aria-controls="update-product-accordion-collapse-body-1">
                            <span>Bestellstatus</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 rotate-180 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-1" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-1">
                        <div class="py-4 border-gray-200 sm:py-5 dark:border-gray-700 grid gap-4 mb-5 sm:grid-cols-3">
                            <div>
                                <label for="zahlungsstatus" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900 ">
                                    Zahlungsstatus
                                </label>
                                <select id="zahlungsstatus" name="paymentStatus" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                    {% get_choices "PaymentStatusChoices" as PaymentStatusChoices %}
                                    {% for item in PaymentStatusChoices %}
                                    <option  {% if not item.2 %}hidden{% endif %} value="{{ item.0 }}">{{ item.1 }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label for="rezeptstatus" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900 ">
                                    Rezeptstatus
                                </label>
                                <select id="rezeptstatus" name="recipeStatus" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                    {% get_choices "RecipeStatusChoices" as RecipeStatusChoices %}
                                    {% for item in RecipeStatusChoices %}
                                    <option value="{{ item.0 }}">{{ item.1 }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label for="orderStatus" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900 ">
                                    Lieferstatus
                                </label>
                                <select id="orderStatus" name="orderStatus" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                    {% get_choices "OrderStatusChoices" as OrderStatusChoices %}
                                    {% for item in OrderStatusChoices %}
                                    <option value="{{ item.0 }}" {% if not item.2 %}hidden{% endif %}>{{ item.1 }}</option>
                                    {% endfor %}
                                </select>
                                <div name="statusAlert" class="px-3 py-2 mt-3 text-sm text-yellow-800 rounded-full bg-yellow-50 dark:text-yellow-300" role="alert">
                                    <span class="font-medium">Bitte erstellen Sie zuerst ein <strong>Versandlabel</strong> bevor Sie den Status auf "Versendet" setzen.
                                </div>
                            </div>
                        </div>
                        <div class="pb-4 border-gray-200 sm:pb-5 dark:border-gray-700 flex">
                            <p class="text-gray-900  hidden mr-auto my-auto" name="shipment_shipment_no">
                                Sendungsnummer (<span class="font-bold" name="labelType"></span>):
                                <span name="labelNumber"></span>
                            </p>
                            <div class="ml-auto flex flex-row gap-4">
                                <div>
                                    <button data-tooltip-target="cancelDeliveryLabeTooltip" onclick="cancelDeliveryLabel()" name="cancelDeliveryLabelButton" type="button" class="flex m-auto font-medium rounded-full text-sm px-5 py-2.5 border border-red-700 hover:hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:border-red-500 dark:text-red-500 dark:hover:dark:hover:bg-red-600 dark:focus:ring-red-900">
                                        Label stornieren
                                        <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/>
                                        </svg>
                                    </button>
                                    <div id="cancelDeliveryLabeTooltip" role="tooltip" name="cancelDeliveryLabeTooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium transition-opacity duration-300 bg-gray-900 rounded-full shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                        Hiermit wird das generierte Versandlabel storniert.
                                        <div class="tooltip-arrow" data-popper-arrow></div>
                                    </div>
                                </div>
                                <div class="flex">
                                    <button style="border-radius: .5rem 0 0 .5rem;" onclick="openPackOrderModal()" name="packup" type="button" class="flex m-auto focus:outline-none bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 dark:focus:ring-emerald-900">
                                        Bestellung verpacken
                                    </button>
                                    <button id="printProtocolBtn" style="border-radius: 0 .5rem .5rem 0; background-color: rgb(50 112 235)" onclick="downloadProtocol()" type="button" class="bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm p-2.5 text-center inline-flex items-center me-2 dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                                        </svg>
                                        <span class="sr-only">Icon description</span>
                                    </button>
                                </div>
                                <div>
                                    <button data-tooltip-target="disabledShippingLabel" onclick="generateDeliveryLabel()" name="dhlButton" disabled type="button" class="flex m-auto focus:outline-none bg-yellow-400 hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-full text-sm px-5 py-2.5 dark:focus:ring-yellow-900">DHL Label generrieren</button>
                                    <button data-tooltip-target="disabledShippingLabel" onclick="generateDeliveryLabel()" name="goExpressButton" disabled type="button" class=" flex m-auto focus:outline-none bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-600 font-medium rounded-full text-sm px-5 py-2.5 dark:focus:ring-red-900">GO! Express generrieren</button>
                                    <div id="disabledShippingLabel" role="tooltip" name="shippingButtonTooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium transition-opacity duration-300 bg-gray-900 rounded-full shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                        Original Rezeptstatus auf <strong>"√úberpr√ºft"</strong> setzen und Abf√ºhrprotokoll erstellen.
                                        <div class="tooltip-arrow" data-popper-arrow></div>
                                    </div>
                                </div>
                                {% if user.is_superuser %}
                                <div>
                                    <button onclick="updateDeliveryLabel()" name="goExpressUpdateButton" type="button" class=" flex m-auto focus:outline-none bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-600 font-medium rounded-full text-sm px-5 py-2.5 dark:focus:ring-red-900">GO! Express updaten</button>
                                </div>
                                <div>
                                    <button onclick="updateGOExpressStatus()" name="goExpressUpdateStatusButton" type="button" class=" flex m-auto focus:outline-none bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-600 font-medium rounded-full text-sm px-5 py-2.5 dark:focus:ring-red-900">GO! Express Status updaten</button>
                                </div>
                                {% endif %}
                                <div>
                                    <button data-tooltip-target="disabledPickUp" onclick="orderPickUp()" name="pickUpButton" disabled type="button" class="flex m-auto focus:outline-none bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-full text-sm px-5 py-2.5 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">
                                        Abholung beauftragen
                                        <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12.013 6.175 7.006 9.369l5.007 3.194-5.007 3.193L2 12.545l5.006-3.193L2 6.175l5.006-3.194 5.007 3.194ZM6.981 17.806l5.006-3.193 5.006 3.193L11.987 21l-5.006-3.194Z"/>
                                            <path d="m12.013 12.545 5.006-3.194-5.006-3.176 4.98-3.194L22 6.175l-5.007 3.194L22 12.562l-5.007 3.194-4.98-3.211Z"/>
                                        </svg>                                          
                                    </button>
                                    <div id="disabledPickUp" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium transition-opacity duration-300 bg-gray-900 rounded-full shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                        Zuerst DHL Label generieren.
                                        <div class="tooltip-arrow" data-popper-arrow></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Bestelldaten -->
                    <h2 id="update-product-accordion-collapse-heading-2" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 border-t border-gray-200 sm:px-5 bg-gray-50  hover:bg-gray-100 dark:hover:bg-gray-600" data-accordion-target="#update-product-accordion-collapse-body-2" aria-expanded="true" aria-controls="update-product-accordion-collapse-body-2">
                            <span>Bestelldaten</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 rotate-180 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-2" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-2">
                        <div class="py-4 border-gray-200 sm:py-5 dark:border-gray-700">
                            <!-- Inputs -->
                                <!-- Column -->
                                <div class="">
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <div>
                                            <label for="salutation" class="block mb-2 text-sm font-medium text-gray-900 ">Anrede</label>
                                            <select id="salutation" name="salutation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                {% get_choices "SalutationChoices" as SalutationChoices %}
                                                {% for item in SalutationChoices %}
                                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <div>
                                            <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900 ">Vorname</label>
                                            <input type="text" name="firstName" id="first_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Vorname" required="">
                                        </div>
                                        <div>
                                            <label for="last_name" class="block mb-2 text-sm font-medium text-gray-900 ">Nachname</label>
                                            <input type="text" name="lastName" id="last_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Nachname" required="">
                                        </div>
                                        <!-- Geburtsdatum -->
                                        <div>
                                            <label for="birth_date" class="block mb-2 text-sm font-medium text-gray-900 ">Geburtsdatum</label>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none">
                                                    <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                                    </svg>
                                                </div>
                                                <input datepicker datepicker-format="dd.mm.yyyy" type="text" id="birth_date" name="birthDate" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full ps-10 p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Geburtsdatum">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <div>
                                            <label for="street" class="block mb-2 text-sm font-medium text-gray-900 ">Stra√üe</label>
                                            <input type="text" name="street" id="street" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Stra√üe" required="">
                                        </div>
                                        <div>
                                            <label for="street_number" class="block mb-2 text-sm font-medium text-gray-900 ">Hausnummer</label>
                                            <input type="text" name="streetNumber" id="street_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Hausnummer" required="">
                                        </div>
                                        <div>
                                            <label for="postalcode" class="block mb-2 text-sm font-medium text-gray-900 ">Postleitzahl</label>
                                            <input type="text" name="postalcode" id="postalcode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Postleitzahl" required="">
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-2">
                                        <div>
                                            <label for="city" class="block mb-2 text-sm font-medium text-gray-900 ">Stadt</label>
                                            <input type="text" name="city" id="city" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Stadt" required="">
                                        </div>
                                        <div>
                                            <label for="country" class="block mb-2 text-sm font-medium text-gray-900 ">Land</label>
                                            <select id="country" name="country" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                {% get_choices "CountryChoices" as countries %}
                                                {% for item in countries %}
                                                <option value="{{item.0}}" {% if order.country == item.0 %}selected{% endif %}>{{ item.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div>
                                            <label for="phone_number" class="block mb-2 text-sm font-medium text-gray-900 ">Telefonnummer</label>
                                            <input type="text" name="phonenumber" id="phone_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Telefonnummer" required="">
                                        </div>
                                        <div>
                                            <label for="email_address" class="block mb-2 text-sm font-medium text-gray-900 ">E-Mail Adresse</label>
                                            <input type="email" name="email" id="email_address" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="E-Mail Adresse" required="">
                                        </div>
                                        <div class="sm:col-span-2">
                                            <label for="comment" class="block mb-2 text-sm font-medium text-gray-900 ">Kommentar</label>
                                            <textarea id="comment" name="comment" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-xl border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Kommentar"></textarea>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                    <!-- Lieferdaten -->
                    <h2 id="update-product-accordion-collapse-heading-3" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 border-t border-gray-200 sm:px-5 bg-gray-50  hover:bg-gray-100 dark:hover:bg-gray-600" data-accordion-target="#update-product-accordion-collapse-body-3" aria-expanded="true" aria-controls="update-product-accordion-collapse-body-3">
                            <span>Lieferdaten</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 rotate-180 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-3" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-2">
                        <div class="py-4 border-gray-200 sm:py-5 dark:border-gray-700">
                            <!-- Inputs -->
                                <!-- Column -->
                                <div class="">
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <div class="flex flex-col">
                                            <label class="block mb-2 text-sm font-medium text-gray-900 ">Packstation</label>
                                            <div class="flex items-center my-auto">
                                                <input id="postoffice-delivery" name="postofficeDelivery" type="checkbox" value="" class="cursor-pointer w-4 h-4 text-emerald-600 bg-gray-100 border-gray-300 rounded focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2 dark:border-gray-600">
                                                <label for="postoffice-delivery" class="cursor-pointer ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">Lieferung an Packstation <span class="text-red-600 dark:text-red-500">(nur DHL)</span></label>
                                            </div>
                                        </div>
                                        <div class="hidden">
                                            <label for="del_lockerid" class="block mb-2 text-sm font-medium text-gray-900 ">Poststation</label>
                                            <input type="text" name="delLockerId" id="del_lockerid" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Poststation">
                                        </div>
                                        <div class="hidden">
                                            <label for="del_postnumber" class="block mb-2 text-sm font-medium text-gray-900 ">Postnummer</label>
                                            <input type="text" name="delPostnumber" id="del_postnumber" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Postnummer">
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <div>
                                            <label for="del_first_name" class="block mb-2 text-sm font-medium text-gray-900 ">Vorname</label>
                                            <input type="text" name="delFirstName" id="del_first_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Vorname" required="">
                                        </div>
                                        <div>
                                            <label for="del_last_name" class="block mb-2 text-sm font-medium text-gray-900 ">Nachname</label>
                                            <input type="text" name="delLastName" id="del_last_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Nachname" required="">
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <div>
                                            <label for="del_street" class="block mb-2 text-sm font-medium text-gray-900 ">Stra√üe</label>
                                            <input type="text" name="delStreet" id="del_street" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Stra√üe" required="">
                                        </div>
                                        <div>
                                            <label for="del_street_number" class="block mb-2 text-sm font-medium text-gray-900 ">Hausnummer</label>
                                            <input type="text" name="delStreetNumber" id="del_street_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Hausnummer" required="">
                                        </div>
                                        <div>
                                            <label for="del_postalcode" class="block mb-2 text-sm font-medium text-gray-900 ">Postleitzahl</label>
                                            <input type="text" name="delPostalcode" id="del_postalcode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Postleitzahl" required="">
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-2">
                                        <div>
                                            <label for="del_city" class="block mb-2 text-sm font-medium text-gray-900 ">Stadt</label>
                                            <input type="text" name="delCity" id="del_city" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Stadt" required="">
                                        </div>
                                        <div>
                                            <label for="del_country" class="block mb-2 text-sm font-medium text-gray-900 ">Land</label>
                                            <select id="del_country" name="delCountry" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                {% get_choices "CountryChoices" as countries %}
                                                {% for item in countries %}
                                                <option value="{{item.0}}" {% if order.country == item.0 %}selected{% endif %}>{{ item.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="sm:col-span-2">
                                            <label for="del_comment" class="block mb-2 text-sm font-medium text-gray-900 ">Kommentar</label>
                                            <textarea id="del_comment" name="delComment" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-xl border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Kommentar"></textarea>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                    <!-- Bestellte Produkte -->
                    <h2 id="update-product-accordion-collapse-heading-4" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 border-t border-gray-200 sm:px-5 bg-gray-50  hover:bg-gray-100 dark:hover:bg-gray-600" data-accordion-target="#update-product-accordion-collapse-body-4" aria-expanded="false" aria-controls="update-product-accordion-collapse-body-4">
                            <span>Bestellte Produkte</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-4" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-3">
                        <div class="border-gray-200 dark:border-gray-700">
                            <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                <div class="relative mt-5 searchProductContainer">
                                    <!-- <div class="relative"> -->
                                    <div class="absolute inset-y-0 start-0 flex items-center ps-4 pointer-events-none">
                                        <svg class="h-3.5 w-3.5 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                                        </svg>
                                    </div>
                                    <input type="text" id="searchProduct" dropdown-max-height="300" data-search-type="add-product-search" class="searchProductInput bg-gray-50 border w-full border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block ps-10 p-2 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Produktsuche" required>
                                </div>
                            </div>
                            <div id="orderedProductList" class="pt-5 flex flex-col gap-4">
                                <!-- Bestelltes Produkt: ID xxx -->
                                <div id="orderProduct-" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                    <div class="grid gap-4 sm:col-span-2 md:gap-6 sm:grid-cols-2 mb-3">
                                        <div>
                                            <label for="product" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900 ">
                                                Produkt
                                            </label>
                                            <select id="product" name="product" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                            </select>
                                        </div>
                                        <div class="ml-auto flex flex-row gap-4">
                                            <p class="pr-1.5 ml-auto text-lg font-medium text-gray-900 ">
                                                Preis: <span class="text-gray-900 dark:text-gray-300" name="productPrice"></span>
                                            </p>
                                            <button type="button" onclick="deleteProduct()" data-modal-target="product-delete-modal" data-modal-toggle="product-delete-modal" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5 ml-auto mb-auto inline-flex " data-modal-toggle="orderModal">
                                                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                                </svg>
                                                <span class="sr-only">Produkt l√∂schen</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="grid gap-4 sm:col-span-2 md:gap-6 sm:grid-cols-4">
                                        <div>
                                            <label for="prepared" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900 ">
                                                Abgabeform
                                            </label>
                                            <select id="prepared" name="prepared" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                            </select>
                                        </div>
                                        <div>
                                            <label for="productAmount" class="block mb-2 text-sm font-medium text-gray-900 " name="productAmountLabel">Menge</label>
                                            <input type="number" name="productAmount" id="productAmount" value="" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Beispiel: 12">
                                        </div>
                                        <div>
                                            <label for="form" class="block mb-2 text-sm font-medium text-gray-900 ">Form</label>
                                            <input type="text" name="form" id="form" value="" disabled class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="">
                                        </div>
                                        <div>
                                            <label for="manufacturer" class="block mb-2 text-sm font-medium text-gray-900 ">H√§ndler</label>
                                            <input type="text" name="manufacturer" id="manufacturer" value="" disabled class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-between pt-4 sm:flex sm:space-y-0 sm:space-x-4">
                    <div class="mb-4 sm:mb-0 items-center d-flex space-y-4 sm:flex sm:space-y-0 sm:space-x-4">
                        <button id="updateOrderBtn" type="button" onclick="updateOrder(this)" data-toast-name="orderUpdatedToast" type="submit" class="w-full sm:w-auto justify-center inline-flex bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800">
                            Speichern
                        </button>
                        <button onclick="hideModal('orderModal')" type="button" class="w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                            <svg class="mr-1 -ml-1 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            Abbrechen
                        </button>
                        <button onclick="createNewInvoice()" type="button" class="w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                            <svg class="mr-2 w-5 h-5 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M9 7V2.221a2 2 0 0 0-.5.365L4.586 6.5a2 2 0 0 0-.365.5H9Zm2 0V2h7a2 2 0 0 1 2 2v6.41A7.5 7.5 0 1 0 10.5 22H6a2 2 0 0 1-2-2V9h5a2 2 0 0 0 2-2Z" clip-rule="evenodd"/>
                                <path fill-rule="evenodd" d="M9 16a6 6 0 1 1 12 0 6 6 0 0 1-12 0Zm6-3a1 1 0 0 1 1 1v1h1a1 1 0 1 1 0 2h-1v1a1 1 0 1 1-2 0v-1h-1a1 1 0 1 1 0-2h1v-1a1 1 0 0 1 1-1Z" clip-rule="evenodd"/>
                            </svg>
                            Neue Rechnung generieren
                        </button>
                        <button onclick="downloadCustomerInvoice()" type="button" class="w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                            <svg class="mr-2 w-5 h-5 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 20">
                                <path d="M7 11H5v1h2v-1Zm4 3H9v1h2v-1Zm-4 0H5v1h2v-1ZM5 5V.13a2.98 2.98 0 0 0-1.293.749L.88 3.707A2.98 2.98 0 0 0 .13 5H5Z"/>
                                <path d="M14.066 0H7v5a2 2 0 0 1-2 2H0v11a1.97 1.97 0 0 0 1.934 2h12.132A1.97 1.97 0 0 0 16 18V2a1.97 1.97 0 0 0-1.934-2ZM13 16a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v6Zm-1-8H9a1 1 0 0 1 0-2h3a1 1 0 1 1 0 2Zm0-3H9a1 1 0 0 1 0-2h3a1 1 0 1 1 0 2Z"/>
                                <path d="M11 11H9v1h2v-1Z"/>
                            </svg>  
                            Kundenrechnung
                        </button>
                        <button onclick="donwloadInsuranceInvoice()" type="button" class="w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                            <svg class="mr-2 w-5 h-5 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 20">
                                <path d="M7 11H5v1h2v-1Zm4 3H9v1h2v-1Zm-4 0H5v1h2v-1ZM5 5V.13a2.98 2.98 0 0 0-1.293.749L.88 3.707A2.98 2.98 0 0 0 .13 5H5Z"/>
                                <path d="M14.066 0H7v5a2 2 0 0 1-2 2H0v11a1.97 1.97 0 0 0 1.934 2h12.132A1.97 1.97 0 0 0 16 18V2a1.97 1.97 0 0 0-1.934-2ZM13 16a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v6Zm-1-8H9a1 1 0 0 1 0-2h3a1 1 0 1 1 0 2Zm0-3H9a1 1 0 0 1 0-2h3a1 1 0 1 1 0 2Z"/>
                                <path d="M11 11H9v1h2v-1Z"/>
                            </svg>                            
                            Versicherungsrechnung
                        </button>
                        <div class="inline-flex rounded-md shadow-sm">
                            <a href="#" target="_blank" id="identCheckImgBtn" type="button" class="hidden w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-s-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                                <svg class="mr-2 w-5 h-5 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 20">
                                    <path d="M7 11H5v1h2v-1Zm4 3H9v1h2v-1Zm-4 0H5v1h2v-1ZM5 5V.13a2.98 2.98 0 0 0-1.293.749L.88 3.707A2.98 2.98 0 0 0 .13 5H5Z"/>
                                    <path d="M14.066 0H7v5a2 2 0 0 1-2 2H0v11a1.97 1.97 0 0 0 1.934 2h12.132A1.97 1.97 0 0 0 16 18V2a1.97 1.97 0 0 0-1.934-2ZM13 16a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v6Zm-1-8H9a1 1 0 0 1 0-2h3a1 1 0 1 1 0 2Zm0-3H9a1 1 0 0 1 0-2h3a1 1 0 1 1 0 2Z"/>
                                    <path d="M11 11H9v1h2v-1Z"/>
                                </svg>                            
                                Ausweis 1
                            </a>
                            <a href="#" target="_blank" id="identCheckImgBtn2" type="button" class="hidden w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-e-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                                <svg class="mr-2 w-5 h-5 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 20">
                                    <path d="M7 11H5v1h2v-1Zm4 3H9v1h2v-1Zm-4 0H5v1h2v-1ZM5 5V.13a2.98 2.98 0 0 0-1.293.749L.88 3.707A2.98 2.98 0 0 0 .13 5H5Z"/>
                                    <path d="M14.066 0H7v5a2 2 0 0 1-2 2H0v11a1.97 1.97 0 0 0 1.934 2h12.132A1.97 1.97 0 0 0 16 18V2a1.97 1.97 0 0 0-1.934-2ZM13 16a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v6Zm-1-8H9a1 1 0 0 1 0-2h3a1 1 0 1 1 0 2Zm0-3H9a1 1 0 0 1 0-2h3a1 1 0 1 1 0 2Z"/>
                                    <path d="M11 11H9v1h2v-1Z"/>
                                </svg>                            
                                Ausweis 2
                            </a>
                        </div>
                    </div>
                    <hr class="block sm:none border border-gray-300 dark:border-gray-600">
                    <button onclick="toggleStornoModal()" type="button" class="mt-4 mt-sm-0 w-full sm:w-auto justify-center inline-flex items-center bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800">
                        <svg class="mr-1 -ml-1 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Stornieren
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Bestellung verpacken Modal -->
<div id="packOrder" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] md:h-full">
    <div class="relative w-full h-full md:h-auto" style="max-width: 75vw;max-height: 80vh;overflow-y: auto;">
        <!-- Modal content -->
        <div class="relative p-4 bg-white shadow sm:p-5">
            <!-- Modal header -->
            <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 dark:border-gray-400">
                <h3 class="text-lg font-semibold text-gray-900 ">Bestellung verpacken</h3>
                <button type="button" onclick="hideModal('packOrder')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5 ml-auto inline-flex items-center ">
                    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <div>
                <div class="grid gap-4 mb-4 sm:grid-cols-3">
                    <div>
                        <label for="employee1" class="block mb-2 text-sm font-medium text-gray-900 ">Abgef√ºllt von</label>
                        <select id="employee1" name="employee1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                            {% for item in pharmacy_employees %}
                                <option {% if item.is_default %}selected{% endif %} value="{{ item.id }}">{{ item.short_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="employee2" class="block mb-2 text-sm font-medium text-gray-900 ">Baufsichtigt von</label>
                        <select id="employee2" name="employee2" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                            {% for item in pharmacy_employees %}
                                <option {% if item.is_default %}selected{% endif %} value="{{ item.id }}">{{ item.short_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <div class="mt-3">
                <ul id="packOrderTabs" class="flex flex-wrap text-sm font-medium text-center text-gray-500 dark:text-gray-400">
                    <li class="me-2">
                        <a href="#" onclick="openPackOrderTab(event, 'tab1')" class="pack-product-tab tab1 inline-block px-4 py-3 rounded-full bg-emerald-600 hover:bg-emerald-700 active" aria-current="page">Produkt 1</a>
                    </li>
                    <li class="me-2">
                        <a href="#" onclick="openPackOrderTab(event, 'tab2')" class="pack-product-tab tab2 inline-block px-4 py-3 rounded-full hover:text-gray-900 dark:hover:hover:bg-gray-700">Produkt 2</a>
                    </li>
                </ul>
                <div id="packOrderTabsContent">
                    <div id="tab1" class="tabcontent py-5">
                        {% comment %} <h2 class="text-lg font-bold pb-4">Verpackungsplanung</h2> {% endcomment %}
                        <div class="relative overflow-x-auto sm:rounded-full">
                            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:text-gray-400">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">
                                            
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Volumen (g | ml)
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Menge (g | ml)
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Verpackung
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Produkt
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="bg-white border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                        <th class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            Verpackung #1
                                        </th>
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            25
                                        </td>
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            25
                                        </td>
                                        <td class="px-6 py-4">
                                            <select id="" name="stockStatusChoices" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                            </select>
                                        </td>
                                        <td class="px-6 py-4">
                                            <select id="" name="stockStatusChoices" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr class="bg-white border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                        <th class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            Verpackung #2
                                        </th>
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            25
                                        </td>
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            25
                                        </td>
                                        <td class="px-6 py-4">
                                            <select id="" name="stockStatusChoices" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                            </select>
                                        </td>
                                        <td class="px-6 py-4">
                                            <select id="" name="stockStatusChoices" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr class="bg-white hover:bg-gray-50 dark:hover:bg-gray-600">
                                        <th class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            Verpackung #3
                                        </th>
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            1
                                        </td>
                                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                            5
                                        </td>
                                        <td class="px-6 py-4">
                                            <select id="" name="stockStatusChoices" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                            </select>
                                        </td>
                                        <td class="px-6 py-4">
                                            <select id="" name="stockStatusChoices" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                            </select>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="tab2" class="tabcontent py-5 hidden">
                        <h2 class="text-lg font-bold text-gray-800">Tab 2 Content</h2>
                        <p class="mt-2 text-gray-700">Duis lobortis velit tellus, eget luctus tellus facilisis eget. Maecenas non massa
                            varius, molestie lorem eget, molestie nisi. Suspendisse potenti.</p>
                    </div>
                </div>
                <div class="mt-5 w-full md:w-auto flex flex-col md:flex-row space-y-2 md:space-y-0 items-stretch md:items-center justify-end md:space-x-3 flex-shrink-0">
                    <button id="sendOrderDataBtn" onclick="sendOrderPackageData()" type="button" class="h-full flex items-center justify-center bg-gray-900 focus:ring-4 focus:ring-gray-300 font-medium rounded-full text-sm px-5 py-3 bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800">
                        Alles speichern
                    </button>
                    <button id="printProtocolInModalBtn" onclick="downloadProtocol()" type="button" class="h-full flex items-center justify-center bg-emerald-900 focus:ring-4 focus:ring-gray-300 font-medium rounded-full text-sm px-5 py-3 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 dark:bg-emerald-600 dark:hover:bg-emerald-700 focus:outline-none dark:focus:ring-emerald-800">
                        Abf√ºhrprotokoll drucken
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Pack Order Modal -->
<script>
    const getPackOrderData = () => {
        const orderId = $('input[name=orderId]', '#orderDetailsForm').val();

        const saveButton = document.getElementById('sendOrderDataBtn');

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'getPackOrderData': 'getPackOrderData',
                'orderId': orderId,
            },
            success: (data) => {
                console.log(data.packedProducts);

                $('#packOrderTabs').empty();
                $('#packOrderTabsContent').empty();

                let dataHasError = false

                $.each(data.packedProducts, (index, product) => {
                    
                    if (product.error) {
                       dataHasError = true
                    }

                    $('#packOrderTabs').append(`
                        <li class="me-2">
                            <a href="#" onclick="openPackOrderTab(event, 'tab${index + 1}')" class="pack-product-tab tab${index + 1} inline-block px-4 py-3 hover:bg-emerald-700 rounded-full ${index === 0 ? 'bg-emerald-600 hover:bg-emerald-700 active' : 'hover:text-gray-900 dark:hover:hover:bg-gray-700'} ${product.error ? 'border-2 border-red-500' : ''}" aria-current="page">${product.product.name}</a>
                        </li>
                    `);

                    $('#packOrderTabsContent').append(`
                        <div id="tab${index + 1}" data-orderedProductId="${product.product.orderedProductId}" class="tabcontent py-5 ${index === 0 ? '' : 'hidden'}">
                            <div class="relative overflow-x-auto sm:rounded-full">
                                ${product.error
                                    ?   `<h1 class="text-xl font-bold ">Fehler: ${product.error}.<br>Bitte vor dem Verpacken √ºberpr√ºfen</h1>
                                            </div>
                                        </div>`
                                    :   `<table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:text-gray-400">
                                                <tr>
                                                    <th scope="col" class="px-6 py-3"></th>
                                                    <th scope="col" class="px-6 py-3">Volumen (g | ml)</th>
                                                    <th scope="col" class="px-6 py-3">Menge (g | ml)</th>
                                                    <th scope="col" class="px-6 py-3">Verpackungs-Ch.-B.</th>
                                                    <th scope="col" class="px-6 py-3">Produkt-Ch.-B.</th>
                                                </tr>
                                            </thead>
                                            <tbody id="packageRows${index + 1}"></tbody>
                                        </table>
                                    </div>
                                </div>`
                                }
                    `);

                    $.each(product.packages, (packageIndex, package) => {
                        $(`#packageRows${index + 1}`).append(`
                            <tr class="bg-white border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                <th class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                    Verpackung #${packageIndex + 1}
                                </th>
                                <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                    ${package.size}
                                </td>
                                <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                                    <span name="fillAmount">${package.fill_amount} ${package.unit}</span>
                                </td>
                                <td class="px-6 py-4">
                                    <!-- Dynamically generated select for packaging -->
                                    <select id="packageBatches-${index + 1}-${packageIndex + 1}" name="packageBatches" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                        <option value="${package.id}">${package.batch_number}</option>
                                    </select>
                                </td>
                                <td class="px-6 py-4">
                                    <!-- Dynamically generated select for product -->
                                    <select id="productBatches-${index + 1}-${packageIndex + 1}" name="productBatches" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                                    </select>
                                </td>
                            </tr>
                        `);

                        $.each(product.product.availableBatches, (batchIndex, batch) => {
                            $(`#productBatches-${index + 1}-${packageIndex + 1}`).append(`
                                <option ${batch.id === product.product.latestBatch.id ? 'selected' : ''} value="${batch.id}">${batch.verification_number}</option>
                            `);
                        });
                    });
                });

                if (dataHasError) {
                    saveButton.disabled = true;
                } else {
                    saveButton.disabled = false;
                }

                $('.loading-screen').addClass('hidden')
                hideModal('orderModal')
                toggleModal('packOrder')

            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                hideModal('orderModal')
                toggleModal('alert-modal')
            }
        })
    }

    function openPackOrderTab(evt, tabName) {
        var i, tabcontent, tablinks

        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.add("hidden");
        }

        tablinks = document.getElementsByClassName("pack-product-tab");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("text-white", "bg-emerald-600", "hover:bg-emerald-700", "active");
            tablinks[i].classList.add("text-gray-500", "hover:text-gray-900", "dark:text-gray-400", "hover:bg-gray-700", "dark:hover:text-white");
        }

       document.getElementById(tabName).classList.remove("hidden");
        evt.currentTarget.classList.add("text-white", "bg-emerald-600", "hover:bg-emerald-700", "active");
        evt.currentTarget.classList.remove("text-gray-500", "hover:text-gray-900", "dark:text-gray-400", "hover:bg-gray-700", "dark:hover:text-white");
    }

    const openPackOrderModal = () => {
        $('.loading-screen').removeClass('hidden')

        getPackOrderData()
    } 

    
    const sendOrderPackageData = () => {

        $('.loading-screen').removeClass('hidden');

        var dataForm = new FormData();

        // Get the packer's name
        const packerName = document.getElementById('employee1').value;
        const packerName2 = document.getElementById('employee2').value;
        
        // Initialize an array to hold the products data
        let productsData = [];
        
        // Iterate through each tabcontent div
        $('#packOrderTabsContent .tabcontent').each(function() {
            const tabContent = $(this);
            const orderedProductId = tabContent.data('orderedproductid');
            const productName = tabContent.find('a.pack-product-tab').text();
            
            // Initialize an array to hold the packages data
            let packages = [];
            
            // Iterate through each package row within the tabcontent
            tabContent.find('tbody tr').each(function() {
                const row = $(this);
                const packageId = row.find('select[name="packageBatches"]').val();
                const productBatchId = row.find('select[name="productBatches"]').val();
                const fillAmount = row.find('span[name="fillAmount"]').text();
                
                packages.push({
                    package_id: packageId,
                    product_batch_id: productBatchId,
                    fill_amount: fillAmount
                });
            });
            
            productsData.push({
                ordered_product_id: orderedProductId,
                product_name: productName,
                packages: packages
            });
        });
        
        // Create the final data object to be sent
        const data = {
            packer_id: packerName,
            packer_id_2: packerName2,
            products: productsData,
        };

        // Append the JSON stringified data to the FormData
       dataForm.append('sendOrderPackageData', 'sendOrderPackageData');
       dataForm.append('data', JSON.stringify(data));

        // Send the data to the Django backend using AJAX
        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            processData: false,  // Important: Tell jQuery not to process the data
            contentType: false,  // Important: Tell jQuery not to set contentType
           data: dataForm,
            success: (data) => {

                setTimeout(function() {
                    $('.loading-screen').addClass('hidden')

                    if (data.status === 'success' && data.message === 'Data received') {
                    
                        const printBtn1 = document.getElementById('printProtocolInModalBtn');
                        const printBtn2 = document.getElementById('printProtocolBtn');
        
                        printBtn1.disabled = false;
                        printBtn2.disabled = false;

                        showToast('successToast', 'Die Bestellung wurde erfolgreich verpackt und die Daten wurden gespeichert.')

                    }
                }, 500);

            },
            error: (xhr, status, error, message) => {
                console.error('Error sending data:', error);
                console.error('Error message:', message);

                $('.loading-screen').addClass('hidden');
                hideModal('orderModal');
                toggleModal('alert-modal');
            }
        });
    }

    const downloadLabels = () => {

        console.log('retrieving labels...')
        
        const orderId = $('input[name=orderId]', '#orderDetailsForm').val();

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'downloadLabel': 'downloadLabel',
                'orderId': orderId,
            },
            xhrFields: {
                responseType: 'blob'
            },
            success: (data) => {
                console.log(data, 'labels')
                var blob = new Blob([data], { type: 'application/pdf' });
                var url = window.URL.createObjectURL(blob);
                window.open(url, '_blank');
            },
            error: () => {
                $('.loading-screen').addClass('hidden')
                hideModal('orderModal')
                toggleModal('alert-modal')
            }
        });
    }


    const downloadProtocol = () => {
        
        const orderId = $('input[name=orderId]', '#orderDetailsForm').val();

        $.ajax({
                type: 'POST',
                url: '{% url "request_order_functions" %}',
                traditional: true,
               data: {
                    'downloadProtocol': 'downloadProtocol',
                    'orderId': orderId,
                },
                xhrFields: {
                    responseType: 'blob'
                },
                success: (data) => {

                    var blob = new Blob([data], { type: 'application/pdf' });
                    var url = window.URL.createObjectURL(blob);
                    window.open(url, '_blank');

                   downloadLabels()
                },
                error: () => {
            
                    $('.loading-screen').addClass('hidden')
                    hideModal('orderModal')
                    toggleModal('alert-modal')
                }
            })
    }
</script>

<!-- Pop Up Modal for stornieren an order -->
<div id="storno-popup-modal" data-modal-target="storno-popup-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-full shadow dark:bg-gray-700">
            <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm w-8 h-8 ml-auto inline-flex justify-center items-center " data-modal-hide="storno-popup-modal">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="pt-6 px-6 text-center">
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">M√∂chten Sie die Bestellung wirklich stornieren? Dieser Vorgang kann nicht r√ºckg√§ngig gemacht werden.</h3>
            </div>
            <form id="cancellationForm">
                <!-- Oder Id -->
                <input type="text" name="orderId" hidden>
                <div class="px-6 mb-6 text-start w-100">
                    <div>
                        <label for="cancellationReason" class="block mb-2 font-medium text-base text-gray-900 ">Stornierungsgrund</label>
                        <select id="cancellationReason" name="cancellationReason" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500">
                            <option selected value="" disabled>Bitte den Grund w√§hlen</option>
                            {% for item in cancellation_reasons %}
                            <option value="{{ item.id }}">{{ item.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="p-4 mb-4 mt-4 text-sm text-red-800 rounded-full bg-red-50 dark:text-red-400 hidden" name="cancellationAlert" role="alert">
                        Bitte den Stornierungsgrund w√§hlen.
                    </div>
                </div>

                <div class="pb-6 px-6 flex justify-between">
                    <button onclick="stornoOrder()" type="button" class="bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-full text-sm inline-flex items-center px-5 py-2.5 text-center mr-2">
                        Ja, ich bin mir sicher
                    </button>
                    <button onclick="hideModal('storno-popup-modal')" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Pop Up Modal for create new invoice -->
<div id="create-new-invoice-modal" data-modal-target="create-new-invoice-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-full shadow dark:bg-gray-700">
            <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm w-8 h-8 ml-auto inline-flex justify-center items-center " data-modal-hide="storno-popup-modal">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="pt-6 px-6 text-center">
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                <h3 class="mb-2 text-lg font-normal text-gray-500 dark:text-gray-400">M√∂chten Sie eine neue Rechnung erstellen?.</h3>
                <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">Hiermit wird die alte Rechnung <strong>storniert</strong>.</h3>
            </div>
            <form id="cancellationForm">
                <!-- Oder Id -->
                <input type="text" name="orderId" hidden>

                <div class="pb-6 px-6 flex justify-between">
                    <button onclick="saveCreateNewInvoice()" type="button" class="bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800 mr-2">
                        Rechnung erstellen
                    </button>
                    <button onclick="hideModal('create-new-invoice-modal')" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Pop Up Modal for comment order status = queries -->
<div id="queries-popup-modal" data-modal-target="queries-popup-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-full shadow dark:bg-gray-700">
            <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm w-8 h-8 ml-auto inline-flex justify-center items-center " data-modal-hide="queries-popup-modal">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="pt-6 px-6 text-center">
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm9.008-3.018a1.502 1.502 0 0 1 2.522 1.159v.024a1.44 1.44 0 0 1-1.493 1.418 1 1 0 0 0-1.037.999V14a1 1 0 1 0 2 0v-.539a3.44 3.44 0 0 0 2.529-3.256 3.502 3.502 0 0 0-7-.255 1 1 0 0 0 2 .076c.014-.398.187-.774.48-1.044Zm.982 7.026a1 1 0 1 0 0 2H12a1 1 0 1 0 0-2h-.01Z" clip-rule="evenodd"/>
                </svg>                  
                <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">Welche R√ºckfragen gibt es zur Bestellung?</h3>
            </div>
            <form id="cancellationForm">
                <!-- Oder Id -->
                <input type="text" name="orderId" hidden>
                <div class="px-6 mb-6 text-start w-100">
                    <div>                      
                        <label for="queriesComment" class="block mb-2 text-sm font-medium text-gray-900 ">R√ºckfragen</label>
                        <textarea id="queriesComment" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-full border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="R√ºckfragen zur Bestellung hier reinschreiben..."></textarea>
                    </div>
                    <div class="p-4 mb-4 mt-4 text-sm text-red-800 rounded-full bg-red-50 dark:text-red-400 hidden" name="queriesAlert" role="alert">
                        Bitte einen Kommentar f√ºr die R√ºckfragen angeben.
                    </div>
                </div>

                <div class="pb-6 px-6 flex justify-between">
                    <button onclick="saveQuariesStatus()" type="button" class="bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 dark:focus:ring-emerald-800 font-medium rounded-full text-sm inline-flex items-center px-5 py-2.5 text-center mr-2">
                        Status speichern
                    </button>
                    <button onclick="hideModal('queries-popup-modal')" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Pop Up Modal for comment order status = clarified -->
<div id="clarified-popup-modal" data-modal-target="clarified-popup-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-full shadow dark:bg-gray-700">
            <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm w-8 h-8 ml-auto inline-flex justify-center items-center " data-modal-hide="queries-popup-modal">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="pt-6 px-6 text-center">
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm9.008-3.018a1.502 1.502 0 0 1 2.522 1.159v.024a1.44 1.44 0 0 1-1.493 1.418 1 1 0 0 0-1.037.999V14a1 1 0 1 0 2 0v-.539a3.44 3.44 0 0 0 2.529-3.256 3.502 3.502 0 0 0-7-.255 1 1 0 0 0 2 .076c.014-.398.187-.774.48-1.044Zm.982 7.026a1 1 0 1 0 0 2H12a1 1 0 1 0 0-2h-.01Z" clip-rule="evenodd"/>
                </svg>                  
                <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">Sind die R√ºckfragen gekl√§rt?</h3>
            </div>
            <form id="cancellationForm">
                <!-- Oder Id -->
                <input type="text" name="orderId" hidden>
                <div class="px-6 mb-6 text-start w-100">
                    <div>                      
                        <label for="clarifiedComment" class="block mb-2 text-sm font-medium text-gray-900 ">Kl√§rung</label>
                        <textarea id="clarifiedComment" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-full border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Kl√§rung der R√ºckfragen hier reinschreiben..."></textarea>
                    </div>
                    <div class="p-4 mb-4 mt-4 text-sm text-red-800 rounded-full bg-red-50 dark:text-red-400 hidden" name="clarifiedAlert" role="alert">
                        Bitte einen Kommentar f√ºr die Kl√§rung angeben.
                    </div>
                </div>

                <div class="pb-6 px-6 flex justify-between">
                    <button onclick="saveClarifiedStatus()" type="button" class="bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 dark:focus:ring-emerald-800 font-medium rounded-full text-sm inline-flex items-center px-5 py-2.5 text-center mr-2">
                        Status speichern
                    </button>
                    <button onclick="hideModal('clarified-popup-modal')" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Pop Up Modal for upload new recipe -->
<div id="upload-recipe-popup-modal" data-modal-target="upload-recipe-popup-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-full shadow dark:bg-gray-700">
            <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm w-8 h-8 ml-auto inline-flex justify-center items-center " data-modal-hide="queries-popup-modal">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="pt-6 px-6 text-center">
                <svg class="mx-auto mb-4 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M12 3a1 1 0 0 1 .78.375l4 5a1 1 0 1 1-1.56 1.25L13 6.85V14a1 1 0 1 1-2 0V6.85L8.78 9.626a1 1 0 1 1-1.56-1.25l4-5A1 1 0 0 1 12 3ZM9 14v-1H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-4v1a3 3 0 1 1-6 0Zm8 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z" clip-rule="evenodd"/>
                </svg>
                <h3 class="mb-3 text-lg font-normal text-gray-500 dark:text-gray-400">Neues Rezept hochladen</h3>
                <h4 class="mb-5 text-md font-normal text-gray-500 dark:text-gray-400">Bestellnummer: <span name="order_number"></span></h4>
            </div>
            <form id="uploadRecipeForm">
                <!-- Oder Id -->
                <input type="text" name="orderId" hidden>
                <div class="px-6 mb-6 text-start w-100">
                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900 " for="newRecipeFile">Rezept</label>
                        <input id="newRecipeFile" name="newRecipeFile" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-full cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:placeholder-gray-400" type="file">
                    </div>
                    <div class="mt-3 flex flex-col">
                        <input type="text" name="recipeNumber" class="hidden w-full mb-auto bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" placeholder="Rezeptnummer*">
                        <div class="flex items-center mt-3">
                            <input checked id="eRecipe" name="eRecipe" onchange="changeRecipeType(this)" type="checkbox" class="cursor-pointer w-4 h-4 text-emerald-600 bg-gray-100 border-gray-300 rounded focus:ring-emerald-500 dark:focus:ring-emerald-600 dark:ring-offset-gray-800 focus:ring-2 dark:border-gray-600">
                            <label for="eRecipe" class="cursor-pointer ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">E-Rezept</label>
                        </div>
                    </div>
                    <div class="p-4 mb-4 mt-4 text-sm text-red-800 rounded-full bg-red-50 dark:text-red-400 hidden" name="recipeFileAlert" role="alert">
                        Bitte ein Rezept hochladen.
                    </div>
                    <div class="p-4 mb-4 mt-4 text-sm text-red-800 rounded-full bg-red-50 dark:text-red-400 hidden" name="recipeNumberAlert" role="alert">
                        Bitte die Rezeptnummer angeben.
                    </div>
                </div>

                <div class="pb-6 px-6 flex justify-between">
                    <button onclick="saveUploadNewRecipe()" type="button" class="bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 dark:focus:ring-emerald-800 font-medium rounded-full text-sm inline-flex items-center px-5 py-2.5 text-center mr-2">
                        Rezept hochladen
                    </button>
                    <button onclick="hideModal('upload-recipe-popup-modal')" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Pop Up Modal for create new invoice -->
<div id="create-new-invoice-modal" data-modal-target="create-new-invoice-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-full shadow dark:bg-gray-700">
            <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm w-8 h-8 ml-auto inline-flex justify-center items-center " data-modal-hide="storno-popup-modal">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="pt-6 px-6 text-center">
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                <h3 class="mb-2 text-lg font-normal text-gray-500 dark:text-gray-400">M√∂chten Sie eine neue Rechnung erstellen?</h3>
                <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">Hiermit wird die alte Rechnung <strong>storniert</strong>.</h3>
            </div>
            <form id="cancellationForm">
                <!-- Order Id -->
                <input type="text" name="orderId" hidden>

                <div class="pb-6 px-6 flex justify-between">
                    <button onclick="saveCreateNewInvoice()" type="button" class="bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800 mr-2">
                        Rechnung erstellen
                    </button>
                    <button onclick="hideModal('create-new-invoice-modal')" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Pop Up Modal for payment_status = paid -->
<div id="payment-status-received-modal" data-modal-target="create-new-invoice-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-full shadow dark:bg-gray-700">
            <div class="pt-6 px-6 text-center">
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 10h9.231M6 14h9.231M18 5.086A5.95 5.95 0 0 0 14.615 4c-3.738 0-6.769 3.582-6.769 8s3.031 8 6.769 8A5.94 5.94 0 0 0 18 18.916"/>
                </svg>                  
                <h3 class="mb-2 text-lg font-normal text-gray-500 dark:text-gray-400">Wurde die Bestellung vollst√§ndig bezahlt?.</h3>
                <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">Hiermit wird die Bestellung auf <strong>Bezahlt</strong> gesetzt und der Kunde erh√§lt eine Best√§tigung per E-Mail.</h3>
            </div>
            <form id="confirmPaymentPaid">
                <!-- Order Id -->
                <input type="text" name="orderId" hidden>

                <div class="pb-6 px-6 flex justify-between">
                    <button onclick="savePaymentStatus()" type="button" class="bg-emerald-700 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center dark:bg-emerald-600 dark:hover:bg-emerald-700 dark:focus:ring-emerald-800 mr-2">
                        Bestellung bezahlt
                    </button>
                    <button onclick="hideModal('payment-status-received-modal')" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Pop Up Modal for deleting a product from order -->
<div id="product-delete-modal" data-modal-target="product-delete-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-full shadow dark:bg-gray-700">
            <div class="p-6 text-center">
                <input type="text" name="productId" hidden>
                <input type="text" name="orderId" hidden>
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">
                    M√∂chten Sie das Produkt <span class="font-bold" name="productName"></span> aus der Bestellung <span class="font-bold" name="orderNumber"></span> l√∂schen?
                </h3>
                <button onclick="saveDeleteOrderProduct()" type="button" class="bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-full text-sm inline-flex items-center px-5 py-2.5 text-center mr-2">
                    Ja, ich bin mir sicher
                </button>
                <button onclick="cancelDeleteOrderProduct()" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:text-gray-300 dark:border-gray-500 dark:hover:dark:hover:bg-gray-600 dark:focus:ring-gray-600">
                    Abbrechen
                </button>
            </div>
        </div>
    </div>
</div>


{% endblock content %}

{% block scripts %}

<script src="{% static '/js/cartProduct.js' %}?version=1.0.1"></script>
<!-- Search product -->
<script src="{% static '/js/productSearch.js' %}?version=1.1" data-product-url="{% url 'request_product_datas' %}" data-pharmacy-id="{{ selected_pharmacy_id }}"></script>

<!-- Popup for Customer Name/Number/Address Popup -->
<script data-orderids="{{ orders_dic }}">

    const orderData = document.currentScript.dataset
    
    let orderIds = JSON.parse(orderData.orderids)

    $(document).ready(function() {

        orderIds.forEach(oderId => {

            let popover = new bootstrap.Popover(document.getElementById('customer'+ oderId),
                {
                    html: true,
                    content: $('[data-name="popover-content-' + oderId + '"]')
                }
            )
        });

    })
</script>

<!-- Change status -->
<script>

    const cancellationReason = $('select[name=cancellationReason]', '#cancellationForm')
    const cancellationOrderId = $('input[name=orderId]', '#cancellationForm')
    const cancellationAlert = $('[name=cancellationAlert]', '#cancellationForm')

    const changeStatus = (obj, orderId) => {

        const statusName = $(obj).attr('name')
        const newStatus = $(obj).attr('value')

        console.log(statusName, newStatus)

        if (statusName === 'status' && newStatus === 'cancelled') {

            $('#storno-popup-modal input[name="orderId"]').val(orderId)
            toggleModal('storno-popup-modal')

        } else {

            if (statusName === 'status' && newStatus === 'queries') {
                $('#queries-popup-modal input[name="orderId"]').val(orderId)
                toggleModal('queries-popup-modal')
            } else if (statusName === 'status' && newStatus === 'clarified') {
                $('#clarified-popup-modal input[name="orderId"]').val(orderId)
                toggleModal('clarified-popup-modal')
            } else if (statusName === 'payment_status' && newStatus === 'received') {
                $('#payment-status-received-modal input[name="orderId"]').val(orderId)
                toggleModal('payment-status-received-modal')
            } else {
                changeStatusToBackend(statusName, newStatus, orderId, '')
            }

        }
    }

    const saveQuariesStatus = () => {

        const queriesComment = $('#queriesComment').val()
        const orderId = $('#queries-popup-modal input[name="orderId"]').val()

        $('#queries-popup-modal [name="queriesAlert"]').addClass('hidden')

        if (!queriesComment || queriesComment === '') {
            $('#queries-popup-modal [name="queriesAlert"]').removeClass('hidden')
            return false
        }

        hideModal('queries-popup-modal')
        changeStatusToBackend('status', 'queries', orderId, queriesComment)
        
        $('#products-order-'+ orderId + ' [name="queries"]').removeClass('hidden')
        $('#products-order-'+ orderId + ' [name="queries"] span').html(queriesComment)

    }

    const saveClarifiedStatus = () => {

        const clarifiedComment = $('#clarifiedComment').val()
        const orderId = $('#clarified-popup-modal input[name="orderId"]').val()

        $('#clarified-popup-modal [name="clarifiedAlert"]').addClass('hidden')

        if (!clarifiedComment || clarifiedComment === '') {
            $('#clarified-popup-modal [name="clarifiedAlert"]').removeClass('hidden')
            return false
        }

        hideModal('clarified-popup-modal')
        changeStatusToBackend('status', 'clarified', orderId, clarifiedComment)
        
        $('#products-order-'+ orderId + ' [name="clarified"]').removeClass('hidden')
        $('#products-order-'+ orderId + ' [name="clarified"] span').html(clarifiedComment)

    }

    const stornoOrder = () => {

        const cancellationReasonValue = cancellationReason.val()

        if (!cancellationReasonValue || cancellationReasonValue === '') {
            cancellationAlert.removeClass('hidden')
            return false
        }

        hideModal('storno-popup-modal')
        changeStatusToBackend('status', 'cancelled', cancellationOrderId.val(), cancellationReasonValue)

    }

    const changeStatusToBackend = (statusName, newStatus, orderId, comment) => {

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'changeStatus': 'changeStatus',
                'orderId': orderId,
                'statusName': statusName,
                'newStatus': newStatus,
                'comment': comment
            },
            success: (data) => {

                $('.loading-screen').addClass('hidden')

                if (!data.stateError) {


                    $('#' + statusName + orderId + ' > span').html(data.newStatusDisplay)
                    $('#' + statusName + orderId + ' .status-circle').attr('value', data.newStatus)

                    $('#status' + orderId + ' > span').html(data.orderStatusDisplay)
                    $('#status' + orderId + ' .status-circle').attr('value', data.orderStatus)

                } else {

                    toggleWarningModal(data.message)

                }
        
            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

    const savePaymentStatus = () => {

        const orderId = $('#payment-status-received-modal input[name="orderId"]').val()

        changeStatusToBackend('payment_status', 'received', orderId, '')

    }

</script>

<!-- Ident Check (Kauf auf Rechnung) -->
<script>
    const ic_identNumber = $('input[name=identNumber], #identCheckDetailsForm')
    const ic_orderId = $('input[name=orderId], #identCheckDetailsForm')
    const ic_orderNumber = $('input[name=orderNumber], #identCheckDetailsForm')
    const ic_salutation = $('select[name=salutation]', '#identCheckDetailsForm')
    const ic_firstName = $('input[name=firstName]', '#identCheckDetailsForm')
    const ic_lastName = $('input[name=lastName]', '#identCheckDetailsForm')
    const ic_street = $('input[name=street]', '#identCheckDetailsForm')
    const ic_streetNumber = $('input[name=streetNumber]', '#identCheckDetailsForm')
    const ic_postalcode = $('input[name=postalcode]', '#identCheckDetailsForm')
    const ic_city = $('input[name=city]', '#identCheckDetailsForm')
    const ic_country = $('select[name=country]', '#identCheckDetailsForm')
    // const ic_imgContainer = $('#identCheckImg')
    // const ic_imgContainer2 = $('#identCheckImg2')

    const getOrderDetailsForIdentCheck = (orderId) => {
        
        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
           data: {
                'getOrderDetails': 'getOrderDetails',
                'orderId': orderId,
            },
            success: (data) => {

                const orderDetails = data.orderDetails
                
                ic_identNumber.val(orderDetails.identNumber)
                ic_orderId.val(orderDetails.id)
                ic_orderNumber.val(orderDetails.orderNumber)
                ic_salutation.val(orderDetails.salutation)
                ic_firstName.val(orderDetails.firstName)
                ic_lastName.val(orderDetails.lastName)
                ic_street.val(orderDetails.street)
                ic_streetNumber.val(orderDetails.streetNumber)
                ic_postalcode.val(orderDetails.postalcode)
                ic_city.val(orderDetails.city)
                ic_country.val(orderDetails.country)

                $('.ident-check-images').empty()

                for (i=0;i<orderDetails.ident_check_images.length;i++) {

                    let ic_image = orderDetails.ident_check_images[i]

                    $('.ident-check-images').append('<a class="my-5" href="' + ic_image['file'] + '" style="background-image: url(' + ic_image['file'] + ')" target="_blank">\
                                                    </a>')

                }

                
                $('.loading-screen').addClass('hidden')
                toggleModal('identCheck')
                
            },
            error: () => {
            
                    $('.loading-screen').addClass('hidden')
                    hideModal('identCheck')
                    toggleModal('alert-modal')
            
            }
        })
    }

    // Ident Check enablen wenn alle Checkboxes aktiviert sind
   document.addEventListener('DOMContentLoaded', function () {
        
        var checkboxes = document.querySelectorAll('input[name="identCheckCheckbox"]');
        var button = document.getElementById('completeIdentCheck');

        function checkCheckboxes() {
            for (var checkbox of checkboxes) {
                if (!checkbox.checked) {
                    button.disabled = true;
                    return;
                }
            }
            button.disabled = false;
        }

        checkboxes.forEach(function(checkbox) {
            checkbox.addEventListener('change', checkCheckboxes);
        });
    });

    const completeIdentCheck = () => {

        const orderId = $('#identCheckDetailsForm input[name="orderId"]').val()

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
           data: {
                'completeIdentCheck': 'completeIdentCheck',
                'orderId': orderId,
            },
            success: (data) => {

                $('.loading-screen').addClass('hidden')
                location.reload();
                showToast('orderUpdatedToast')
            
            },
            error: () => {
            
                $('.loading-screen').addClass('hidden')
                hideModal('identCheck')
                toggleModal('alert-modal')
            
            }
        })
    }
    
</script>

<script>

    const extractedDataFields = new FormData()
    let customerData = {}
    let productsData = [];
    const productListContainer = document.getElementById('extractedOrderedProductList');


    function extractTextByXpath(doc, xpath) {
        const result = doc.evaluate(xpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null)
        return result.singleNodeValue ? result.singleNodeValue.textContent.trim() : ''
    }

    function decodeQuotedPrintable(input) {

        const encoded = input.replace(/=([\dA-F]{2})/g, (match, p1) => String.fromCharCode(parseInt(p1, 16)))

        try {
            const decoder = new TextDecoder("utf-8")
            const bytes = new Uint8Array(encoded.split('').map(c => c.charCodeAt(0)))
            return decoder.decode(bytes)
        } catch (e) {
            console.error("Decoding error:", e)
            return encoded
        }
    }

    function extractHtmlContent(fullText) {
        const regex = /<!DOCTYPE html[^>]*>[\s\S]*<\/html>/i

        const match = fullText.match(regex)

        if (match) {
            
            const decodedHTML = decodeQuotedPrintable(match[0])
            return decodedHTML
        } else {

            $('#htmlInputForImport').val('Kein HTML-Code gefunden')
            return 0
        }
    }

    const extractData = () => {

        // Initialisierung
        const htmlInput = document.getElementById('htmlInputForImport').value
        const filteredHtml = extractHtmlContent(htmlInput)

        if (filteredHtml === 0) {
            return
        }

        const parser = new DOMParser()
        const doc = parser.parseFromString(filteredHtml, 'text/html')

        // Kundendaten
        customerData = {
            exernalOrderId: extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[3]/span/strong[1]"),
            name: extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[7]/span"),
            address: extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[8]/span"),
            city: extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[9]/span"),
            email: extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[14]/span/strong[1]")
                || extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[9]/div[3]/div[2]/span/strong[1]")
                || extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[12]/div[2]/span/strong[1]"),
            phone: extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[14]/span/strong[2]")
                || extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[9]/div[3]/div[2]/span/strong[2]")
                || extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[12]/div[2]/span/strong[2]")
                || extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[12]/div[2]/span/*[2]"),
            birthDate: extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[12]/span/strong")
                || extractTextByXpath(doc, "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[9]/div[3]/span/strong"),
        };

        // Name formatieren
        let nameParts = customerData.name.split(" ")
        let firstNames = nameParts.slice(0, -1).join(" ")
        let lastName = nameParts[nameParts.length - 1]

        // Geburtsdatum formatieren
        let formattedDate = customerData.birthDate.replace(/\//g, '.')

        // Stra√üe formatieren
        let fullStreet = customerData.address.split(" ")
        let street = fullStreet.slice(0, -1).join(" ")
        let streetNumber = fullStreet[fullStreet.length - 1]

        // PLZ / Ort formatieren
        let cityPostalcode = customerData.city.split(" ")
        let postalcode = cityPostalcode[0]
        let city = cityPostalcode.slice(1).join(" ")


        $('#extractedName').text(customerData.name)
        $('#extractedAddress').text(customerData.address)
        $('#extractedCity').text(customerData.city)
        $('#extractedEmail').text(customerData.email)
        $('#extractedPhone').text(customerData.phone)
        $('#extractedBirthDate').text(customerData.birthDate.replace(/\//g, '.'))

        $('#extracted_external_order_id').val(customerData.exernalOrderId)
        $('#extracted_first_name').val(firstNames)
        $('#extracted_last_name').val(lastName)
        $('#extracted_birth_date').val(formattedDate)
        $('#extracted_street').val(street)
        $('#extracted_street_number').val(streetNumber)
        $('#extracted_postalcode').val(postalcode)
        $('#extracted_city').val(city)
        $('#extracted_phone_number').val(customerData.phone)
        $('#extracted_email_address').val(customerData.email)

        extractedDataFields.append('customerData', JSON.stringify(customerData))

        // Bestelldaten
        // Mac und Windows haben verschiedene Quellcodes, deswegen wird √ºberpr√ºft, in welchem Container sich die Daten befinden

        const xpaths = [
            "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/table/tbody/tr",
            "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[9]/div[3]/table/tbody/tr",
            "/html/body/center/div/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table/tbody/tr/td/table[5]/tbody/tr/td/div[12]/table/tbody/tr"
        ]

        let maxRowsCount = 0
        let baseXpath = ''
        let rowsCount = 0

        // Pr√ºfe jeden XPath in der Liste und finde den mit der h√∂chsten Zeilenanzahl
        xpaths.forEach(xpath => {
            rowsCount = doc.evaluate('count(' + xpath + ')', doc, null, XPathResult.NUMBER_TYPE, null).numberValue;

            if (rowsCount > maxRowsCount) {
                maxRowsCount = rowsCount;
                baseXpath = xpath;
            }
        });

        const productsTableBody = document.getElementById('extractedOrderedProducts')
        productsTableBody.innerHTML = ''

        for (let i = 1; i <= maxRowsCount; i++) {
            const row = document.createElement('tr')
            let productDetails = {}

            for (let j = 2; j <= 5; j++) {
                const cell = document.createElement('td')
                let cellXpath = `${baseXpath}[${i}]/td[${j}]`

                let cellContent = doc.evaluate(cellXpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.textContent.trim()
                cell.textContent = cellContent
                row.appendChild(cell)

                // F√ºge den Zelleninhalt auch zum JSON-Objekt hinzu
                productDetails[`column${j-1}`] = cellContent
            }
            productsTableBody.appendChild(row)
            productsData.push(productDetails)
        }

        productsData.forEach((product, index) => {
            // Erstelle das Produkt-Div
            const productDiv = document.createElement('div')
            productDiv.className = "imported-product-container bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500"
            productDiv.id = `orderProduct-${index}`

            // Inhalt f√ºr das Produkt-Div
            const contentHtml = `
                <div class="flex gap-4 md:gap-6 mb-3">
                    <div class="mt-2" style="flex: 4">
                        <label for="product-${index}" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900 ">
                            Produkt
                        </label>
                        <input id="product-${index}" name="product" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" value="${product.column1}">
                    </div>
                    <div class="mt-2" style="flex: 2">
                        <label for="productAmount-${index}" class="block mb-2 text-sm font-medium text-gray-900 ">Menge <span class="availableAmount"></span></label>
                        <input type="number" name="productAmount" id="productAmount-${index}" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5 dark:placeholder-gray-400 dark:focus:ring-emerald-500 dark:focus:border-emerald-500" value="${product.column4.replace(/\D/g, '')}">
                    </div>
                    <div class="inline-flex rounded-md shadow-sm" role="group" style="flex: 1; height: 42px; margin-top: auto;">
                        <a href="javascript:void(0)" onclick="reduceAmountImportedProduct(${index})" type="button" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-gray-300 bg-transparent border border-gray-900 rounded-s-lg hover:bg-gray-900 hover:focus:z-10 focus:ring-2 focus:ring-gray-500 focus:bg-gray-900 focus:dark:border-white dark:hover:dark:hover:bg-gray-700 dark:focus:bg-gray-700">
                            <svg class="w-4 h-4 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 8">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 5.326 5.7a.909.909 0 0 0 1.348 0L13 1"/>
                            </svg>
                        </a>
                        <a href="javascript:void(0)" onclick="increaseAmountImportedProduct(${index})" type="button" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-gray-300 bg-transparent border border-gray-900 rounded-e-lg hover:bg-gray-900 hover:focus:z-10 focus:ring-2 focus:ring-gray-500 focus:bg-gray-900 focus:dark:border-white dark:hover:dark:hover:bg-gray-700 dark:focus:bg-gray-700">
                            <svg class="w-4 h-4 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 8">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7 7.674 1.3a.91.91 0 0 0-1.348 0L1 7"/>
                            </svg>
                        </a>
                    </div>
                    <button style="position: absolute; right: 30px;" type="button" onclick="removeImportedProduct(event)" data-modal-target="product-delete-modal" data-modal-toggle="product-delete-modal" class="remove-imported-product-btn text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5 ml-auto mb-auto inline-flex ">
                        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>                                    
                        </svg>
                        <span class="sr-only">Produkt l√∂schen</span>                                
                    </button>
                </div>
            `

            // Setze den HTML-Inhalt des Produkt-Divs
            productDiv.innerHTML = contentHtml

            // F√ºge das Produkt-Div dem Container hinzu
            productListContainer.appendChild(productDiv)
        });

        $('#sendExtractedData').prop("disabled", false)
    }

    const checkAvailability = () => {
        $('.loading-screen').removeClass('hidden')

        var formData = new FormData();
        const products = []
        
        const productContainers = document.querySelectorAll('.imported-product-container');

        if (productContainers.length === 0) {
            $('#no-products-found-text').removeClass('hidden')
            $('.loading-screen').addClass('hidden')
            return
        }

        productContainers.forEach(container => {
            const product = container.querySelector('[id^="product-"]').value;
            const amount = container.querySelector('[id^="productAmount-"]').value;
            if (product && amount) {
                products.push({ product, amount });
            }
        });

        formData.append('productsData', JSON.stringify(products));
        formData.append('checkAvailability', 'checkAvailability')   

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
            processData: false,
            contentType: false,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
           data: formData,
            success: (data) => {

               data.products.forEach((product, index) => {
                    // Find the product container by matching the product name
                    const productContainers = document.querySelectorAll('.imported-product-container');
                    
                    productContainers.forEach(container => {
                        // Get the product input field to check the name
                        const productNameInput = container.querySelector('input[name="product"]');
                        if (productNameInput && productNameInput.value === product.name) {
                            // Get the amount label
                            const amountLabel = container.querySelector(`label[for^="productAmount-"]`);
                            const amountField = container.querySelector(`input[id^="productAmount-"]`);

                            if (amountLabel) {
                                // Update the label text with the available amount
                                amountLabel.innerHTML = `Menge (${product.availableAmount} verf√ºgbar)`;
                            }

                            if (product.availableAmount < parseInt(amountField.value)) {
                                amountField.classList.add('warning-border')
                            } else {
                                amountField.classList.remove('warning-border')
                            }
                        }
                    });
                });
            },
            error: () => {
                toggleModal('alert-modal')
            }
        })
        
        $('.loading-screen').addClass('hidden')
    }

    // onclick listener for check availabilty
   document.getElementById('checkAvailabilityBtn').addEventListener('click', checkAvailability);

    const sendExtractedData = () => {
        $('.loading-screen').removeClass('hidden')
        $('#no-products-found-text').addClass('hidden')
        $('#order-already-exists').addClass('hidden')
        $('#order-receipt-missing').addClass('hidden')

        var formData = new FormData();

        // Recipe File
        const recipeFile = $('#importOrderForm input[name="recipeFile"]')[0]?.files[0];

        if (recipeFile) {
            formData.append('recipeData', recipeFile);
        } else {
            $('#order-receipt-missing').removeClass('hidden')
            $('.loading-screen').addClass('hidden')
            return
        }

        formData.append('onlineRecipeStatus', $('#importOrderForm select[name="onlineRecipeStatus"]').val());

        // Check Products
        const productsNotFound = document.querySelectorAll('.imported-product-container')
        
        if (productsNotFound.length > 0) {
            productsNotFound.forEach(element => {
                element.style.border = "none"
            })
        }

        // Customer Data
        const customer = {
            external_order_id: $('#extracted_external_order_id').val(),
            salutation: $('#extracted_salutation').val(),
            first_name: $('#extracted_first_name').val(),
            last_name: $('#extracted_last_name').val(),
            birth_date: $('#extracted_birth_date').val(),
            street: $('#extracted_street').val(),
            street_number: $('#extracted_street_number').val(),
            postalcode: $('#extracted_postalcode').val(),
            city: $('#extracted_city').val(),
            phone_number: $('#extracted_phone_number').val(),
            email_address: $('#extracted_email_address').val(),
        }
        
        formData.append('customerData', JSON.stringify(customer));

        // Add products to form data
        const products = []
        
        const productContainers = document.querySelectorAll('.imported-product-container');

        productContainers.forEach(container => {
            const product = container.querySelector('[id^="product-"]').value;
            const amount = container.querySelector('[id^="productAmount-"]').value;
            if (product && amount) {
                products.push({ product, amount });
            }
        });

        formData.append('productsData', JSON.stringify(products));

        formData.append('importOrderData', 'importOrderData')   

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
            processData: false,
            contentType: false,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
           data: formData,
            success: (data) => {

                if (data.message === 'Bestellung bereits vorhanden.') {
                    $('#order-already-exists').removeClass('hidden')
                    
                } else if (data.productStatus && data.productStatus.length > 0) {
                    
                   data.productStatus.forEach(product => {                    
                        const productInputs = document.querySelectorAll('input[name="product"]')

                        // Durchsuche die Input-Felder nach dem Wert, der dem nicht gefundenen Produkt entspricht
                        productInputs.forEach(input => {
                            if (input.value === product.productName) {
                                let borderColor = product.status === 'notFound' ? 'red' : 'orange'
                                let parentContainer = input.closest('.imported-product-container')
                                
                                if (parentContainer) {
                                    // Setze den roten Rahmen f√ºr den Container
                                    parentContainer.style.border = `2px solid ${borderColor}`
                                }
                            }
                        })  
                    })
                } else {
                    $('.loading-screen').addClass('hidden')
                    hideModal('importOrder')
                    showToast('orderImportedToast')
                }
        
                $('.loading-screen').addClass('hidden')
            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
            }
        })
    }

    function removeImportedProduct(event) {
        const parentContainer = event.currentTarget.closest('.imported-product-container');
        if (parentContainer) {
            parentContainer.remove(); // Entferne das √ºbergeordnete Element
        }
    }

    const reduceAmountImportedProduct = (index) => {
        const productAmountInput = document.getElementById(`productAmount-${index}`);
        const availableAmount = document.querySelector(`#availableAmount-${index}`)

        if (productAmountInput && productAmountInput.value >= 10) {
            const currentAmount = parseInt(productAmountInput.value);
            productAmountInput.value = currentAmount - 5;
        }

        if (parseInt(availableAmount.textContent) > parseInt(productAmountInput.value)) {
            productAmountInput.classList.remove('warning-border')
        } else {
            productAmountInput.classList.add('warning-border')
        }
    }

    const increaseAmountImportedProduct = (index) => {
        const productAmountInput = document.getElementById(`productAmount-${index}`);
        const availableAmount = document.querySelector(`#availableAmount-${index}`)

        if (productAmountInput) {
            const currentAmount = parseInt(productAmountInput.value);
            productAmountInput.value = currentAmount + 5;
        }
        
        if (parseInt(availableAmount.textContent) > parseInt(productAmountInput.value)) {
            productAmountInput.classList.remove('warning-border')
        } else {
            productAmountInput.classList.add('warning-border')
        }

    }


</script>

<!-- Orderdetails -->
<script>

    // Bestelldetails
    const orderNumber = $('[name=orderNumber]', '#orderModal')
    const insuranceConfirmation = $('[name=insuranceConfirmation]', '#orderModal')
    const insuranceConfirmationURL = $('[name=insuranceConfirmationURL]', '#orderModal')
    const orderDate = $('[name=orderDate]', '#orderModal')
    const orderAmount = $('[name=orderAmount]', '#orderModal')
    const healthInsuranceCompany = $('[name=healthInsuranceCompany]', '#orderModal')
    const healthInsuranceContactPerson = $('[name=healthInsuranceContactPerson]', '#orderModal')

    // Bestellid
    const orderIdInput = $('input[name=orderId]', '#orderDetailsForm')

    // Bestellstatus
    const paymentStatus = $('select[name=paymentStatus]', '#orderDetailsForm')
    const recipeStatus = $('select[name=recipeStatus]', '#orderDetailsForm')
    const orderStatus = $('select[name=orderStatus]', '#orderDetailsForm')
    const cancelDeliveryLabelButton = $('button[name=cancelDeliveryLabelButton]', '#orderDetailsForm')
    const dhlButton = $('button[name=dhlButton]', '#orderDetailsForm')
    const goExpressButton = $('button[name=goExpressButton]', '#orderDetailsForm')
    const shippingButtonTooltip = $('[name=shippingButtonTooltip]', '#orderDetailsForm')
    const pickUpButton = $('button[name=pickUpButton]', '#orderDetailsForm')

    // Bestelldaten
    const salutation = $('select[name=salutation]', '#orderDetailsForm')
    const firstName = $('input[name=firstName]', '#orderDetailsForm')
    const lastName = $('input[name=lastName]', '#orderDetailsForm')
    const birthDate = $('input[name=birthDate]', '#orderDetailsForm')
    const street = $('input[name=street]', '#orderDetailsForm')
    const streetNumber = $('input[name=streetNumber]', '#orderDetailsForm')
    const postalcode = $('input[name=postalcode]', '#orderDetailsForm')
    const city = $('input[name=city]', '#orderDetailsForm')
    const country = $('select[name=country]', '#orderDetailsForm')
    const phonenumber = $('input[name=phonenumber]', '#orderDetailsForm')
    const email = $('input[name=email]', '#orderDetailsForm')
    const comment = $('textarea[name=comment]', '#orderDetailsForm')

    // Lieferdaten
    const delFirstName = $('input[name=delFirstName]', '#orderDetailsForm')
    const delLastName = $('input[name=delLastName]', '#orderDetailsForm')
    const delLockerId = $('input[name=delLockerId]', '#orderDetailsForm')
    const delPostnumber = $('input[name=delPostnumber]', '#orderDetailsForm')
    const postofficeDelivery = $('input[name=postofficeDelivery]', '#orderDetailsForm')
    const delStreet = $('input[name=delStreet]', '#orderDetailsForm')
    const delStreetNumber = $('input[name=delStreetNumber]', '#orderDetailsForm')
    const delPostalcode = $('input[name=delPostalcode]', '#orderDetailsForm')
    const delCity = $('input[name=delCity]', '#orderDetailsForm')
    const delCountry = $('select[name=delCountry]', '#orderDetailsForm')
    const delComment = $('textarea[name=delComment]', '#orderDetailsForm')

    const identCheckImgBtn = $('#identCheckImgBtn')
    const identCheckImgBtn2 = $('#identCheckImgBtn2')
    
    const printProtocolBtn = $('#printProtocolBtn')
    const printProtocolInModalBtn = $('#printProtocolInModalBtn')

    const regexEmail = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/

    var dataFields = new FormData()

    const getOrderDetails = (orderId) => {
        
        $('#orderDetailsForm [name="statusAlert"]').addClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
           data: {
                'getOrderDetails': 'getOrderDetails',
                'orderId': orderId,
            },
            success: (data) => {

                const orderDetails = data.orderDetails

                orderIdInput.val(orderDetails.id)

                // Bestelldetails
                orderNumber.html(orderDetails.orderNumber)

                // Rezepte
                $('#orderModal .recipe-files').empty()
                for (recipeFile of orderDetails.recipeFiles) {
                    let template = '<div class="mb-2 flex justify-between">\
                                        <span class="mb-0 text-sm font-medium text-gray-900 dark:text-gray-300">\
                                            ' + recipeFile.number + '\
                                        </span>\
                                        <a href="' + recipeFile.url + '" target="_blank">\
                                            <svg class="w-4 h-4 text-gray-800 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">\
                                                <path d="M14.707 7.793a1 1 0 0 0-1.414 0L11 10.086V1.5a1 1 0 0 0-2 0v8.586L6.707 7.793a1 1 0 1 0-1.414 1.414l4 4a1 1 0 0 0 1.416 0l4-4a1 1 0 0 0-.002-1.414Z"/>\
                                                <path d="M18 12h-2.55l-2.975 2.975a3.5 3.5 0 0 1-4.95 0L4.55 12H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2Zm-3 5a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/>\
                                            </svg>\
                                        </a>\
                                    </div>'
                            
                    $('#orderModal .recipe-files').append(template)
                }

                // Versicherungsdaten
                if (orderDetails.customerType !== 'self_payer') {
                    healthInsuranceCompany.html(orderDetails.healthInsuranceCompany)
                    healthInsuranceContactPerson.html(orderDetails.healthInsuranceContactPerson)
                } else {
                    healthInsuranceCompany.html('(Selbstzahler)')
                }

                if (orderDetails.insuranceConfirmation) {
                    insuranceConfirmation.removeClass('hidden')
                    insuranceConfirmationURL.removeClass('hidden')
                    insuranceConfirmationURL.attr('href', orderDetails.insuranceConfirmationURL)
                } else {
                    insuranceConfirmation.addClass('hidden')
                    insuranceConfirmationURL.addClass('hidden')
                }
                orderDate.html(orderDetails.orderDate)
                orderAmount.html(orderDetails.orderAmount)
                
                // Bestellstatus
                paymentStatus.val(orderDetails.paymentStatus)
                recipeStatus.val(orderDetails.recipeStatus)
                orderStatus.val(orderDetails.orderStatus)

                // Sendugnsnummer
                if (orderDetails.shipmentShipmentNo) {
                    $('#orderDetailsForm [name="shipment_shipment_no"]').removeClass('hidden')
                    $('#orderDetailsForm [name="shipment_shipment_no"] span').html(orderDetails.shipmentShipmentNo)
                }

                // Delivery Buttons
                cancelDeliveryLabelButton.addClass('hidden')
               dhlButton.addClass('hidden')
                goExpressButton.addClass('hidden')
                pickUpButton.addClass('hidden')


                $('#orderDetailsForm [name="shipment_shipment_no"]').addClass('hidden')
                
                if (orderDetails.shipmentShipmentNo) {

                    if (!['delivered', 'shipped'].includes(orderDetails.orderStatus)) {
                        cancelDeliveryLabelButton.removeClass('hidden')
                    }
                    // Sendugnsnummer anzeigen
                    $('#orderDetailsForm [name="shipment_shipment_no"]').removeClass('hidden')
                    $('#orderDetailsForm [name="shipment_shipment_no"] span[name="labelType"]').html(orderDetails.shipmentLabelType)
                    $('#orderDetailsForm [name="shipment_shipment_no"] span[name="labelNumber"]').html(orderDetails.shipmentShipmentNo)

                   dhlButton.html('\
                       dHL Label herunterladen\
                        <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\
                            <path fill-rule="evenodd" d="M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z" clip-rule="evenodd"/>\
                            <path fill-rule="evenodd" d="M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z" clip-rule="evenodd"/>\
                        </svg>\
                    ')

                    goExpressButton.html('\
                        GO! Express herunterladen\
                        <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\
                            <path fill-rule="evenodd" d="M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z" clip-rule="evenodd"/>\
                            <path fill-rule="evenodd" d="M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z" clip-rule="evenodd"/>\
                        </svg>\
                    ')
                } else {
                   dhlButton.html('\
                       dHL Label generieren\
                        <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">\
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7 7V5"/>\
                        </svg>\
                    ')

                    goExpressButton.html('\
                        Go! Express generieren\
                        <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">\
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7 7V5"/>\
                        </svg>\
                    ')
                }

                // if (!['cancelled', 'delivered'].includes(orderDetails.orderStatus)) {

                // DHL Standard
                if (orderDetails.delivery_type === 'dhl_standard') {
                   dhlButton.removeClass('hidden')
                    pickUpButton.removeClass('hidden')

                    // Disable enable Pickup Button
                    if (orderDetails.pickUpButtonStatus) {
                        pickUpButton.prop('disabled', false)
                        pickUpButton.next().addClass('hidden')
                    } else {
                        pickUpButton.prop('disabled', true)
                        pickUpButton.next().removeClass('hidden')
                    }
                    
                    if (orderDetails.deliveryButtonStatus) {
                       dhlButton.prop('disabled', false)
                        shippingButtonTooltip.addClass('hidden')
                    } else {
                       dhlButton.prop('disabled', true)
                        shippingButtonTooltip.removeClass('hidden')
                    }
                    
                    // Show Pickup status if exists
                    if (orderDetails.pickUpStatus) {
                        pickUpButton.prop('disabled', true)
                        pickUpButton.next().addClass('hidden')
                        pickUpButton.html('Abholung: ' + orderDetails.pickUpDate)
                    } else {
                        pickUpButton.html('\
                            Abholung beauftragen\
                            <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\
                                <path d="M12.013 6.175 7.006 9.369l5.007 3.194-5.007 3.193L2 12.545l5.006-3.193L2 6.175l5.006-3.194 5.007 3.194ZM6.981 17.806l5.006-3.193 5.006 3.193L11.987 21l-5.006-3.194Z"/>\
                                <path d="m12.013 12.545 5.006-3.194-5.006-3.176 4.98-3.194L22 6.175l-5.007 3.194L22 12.562l-5.007 3.194-4.98-3.211Z"/>\
                            </svg>\
                        ')
                    }
                }
                
                // GO Express
                if (orderDetails.delivery_type === 'go_express') {
                    goExpressButton.removeClass('hidden')

                    if (orderDetails.deliveryButtonStatus) {
                        goExpressButton.prop('disabled', false)
                        shippingButtonTooltip.addClass('hidden')
                    } else {
                        goExpressButton.prop('disabled', true)
                        shippingButtonTooltip.removeClass('hidden')
                    }
                }

                // Change delivery button tooltip
                let shipping_button_tooltip_text = ''

                if (orderDetails.paymentType == 'payment_by_invoice') {
                    shipping_button_tooltip_text = '- Original Rezeptstatus auf <strong>"√úberpr√ºft"</strong> setzen.'
                } else {
                    shipping_button_tooltip_text = '- Zahlungsstatus auf <strong>"Bezahlt"</strong> und original Rezeptstatus auf <strong>"√úberpr√ºft"</strong> setzen.'
                }

                if (!orderDetails.isPacked) {
                    shipping_button_tooltip_text += '<br>- Bestellung zun√§chst verpacken.'
                }

                shippingButtonTooltip.html(shipping_button_tooltip_text)

                // }

                // Bestelldaten
                salutation.val(orderDetails.salutation)
                firstName.val(orderDetails.firstName)
                lastName.val(orderDetails.lastName)
                birthDate.val(orderDetails.birthDate)
                street.val(orderDetails.street)
                streetNumber.val(orderDetails.streetNumber)
                postalcode.val(orderDetails.postalcode)
                city.val(orderDetails.city)
                country.val(orderDetails.country)
                phonenumber.val(orderDetails.phonenumber)
                email.val(orderDetails.email)
                comment.val(orderDetails.comment)

                // Lieferdaten
               delFirstName.val(orderDetails.delFirstName)
               delLastName.val(orderDetails.delLastName)
               delLockerId.val(orderDetails.delLockerId)
               delPostnumber.val(orderDetails.delPostnumber)
               delStreet.val(orderDetails.delStreet)
               delStreetNumber.val(orderDetails.delStreetNumber)
               delPostalcode.val(orderDetails.delPostalcode)
               delCity.val(orderDetails.delCity)
               delCountry.val(orderDetails.delCountry)
               delComment.val(orderDetails.delComment)

                // Lieferung an Postfiliale
                postofficeDelivery.prop('checked', orderDetails.postofficeDelivery)
                changeDeliveryToPostoffice()

                // Bestellte Produkte
                $('#orderedProductList').empty()
                for (orderProduct of orderDetails.orderProducts) {

                    $('#orderedProductList').append(dashBoardProducts(orderProduct, orderDetails.orderNumber))

                    const productSelect = $('#orderProduct-' + orderProduct.id + ' select[name=product]')
                    const preparedSelect = $('#orderProduct-' + orderProduct.id + ' select[name=prepared]')

                    // Auswahl des Produktes
                    productSelect.append('<option selected value="' + orderProduct.productId + '">' + orderProduct.name + ' (' + orderProduct.genetic + ') ' + '[THC: ' + orderProduct.thc + ']</option>')
                    for (product of orderProduct.products) {
                        if (orderProduct.productId != product.id) {
                            productSelect.append('<option value="' + product.id + '">' + product.name + ' (' + product.genetic + ') ' + '[THC: ' + product.thc + ']</option>')
                        }
                    }

                    // Auswahl der Form (Bl√ºt oder Extrakt)
                    for (preparedChoice of orderProduct.preparedChoices) {
                        if (orderProduct.prepared == preparedChoice.value) {
                            preparedSelect.append('<option selected value="' + preparedChoice.value + '">' + preparedChoice.name + '</option>')
                        } else {
                            preparedSelect.append('<option value="' + preparedChoice.value + '">' + preparedChoice.name + '</option>')
                        }
                    }
                    // Bei Extrakt disabled, da keine verarbeiteten Extrakte
                    if (preparedChoice.value === 'extract') {
                        preparedSelect.prop('disabled', true)
                    }

                }

                if (orderDetails.identImage) {
                    identCheckImgBtn.removeClass('hidden')
                    identCheckImgBtn.attr('href', orderDetails.identImage)
                }
                if (orderDetails.identImage2) {
                    identCheckImgBtn2.removeClass('hidden')
                    identCheckImgBtn2.attr('href', orderDetails.identImage2)
                }

                if (!orderDetails.isPacked) {
                    printProtocolBtn.prop('disabled', true)
                    printProtocolInModalBtn.prop('disabled', true)
                }
                
                toggleModal('orderModal')
        
            },
            error: () => {
        
                $('.loading-screen').addClass('hidden')
                hideModal('orderModal')
                toggleModal('alert-modal')
        
            }
        })

    }

    const toggleStornoModal = () => {
        
        hideModal('orderModal')
        $('#storno-popup-modal input[name="orderId"]').val(orderIdInput.val())
        toggleModal('storno-popup-modal')

    }

    const validateInoviceDatas = () => {

        // Bestelldaten
        const salutationValue = salutation.val()
        const firstNameValue = firstName.val()
        const lastNameValue = lastName.val()
        const birthDateValue = birthDate.val()
        const streetValue = street.val()
        const streetNumberValue = streetNumber.val()
        const postalcodeValue = postalcode.val()
        const cityValue = city.val()
        const countryValue = country.val()
        const phonenumberValue = phonenumber.val()
        const emailValue = email.val()
        const commentValue = comment.val()

        const validationFields = [
            'salutation',
            'firstName',
            'lastName',
            'birthDate',
            'street',
            'streetNumber',
            'postalcode',
            'city',
            'country',
            'phonenumber',
            'email',
        ]

        const formData = {
            salutation: salutationValue,
            firstName: firstNameValue,
            lastName: lastNameValue,
            birthDate: birthDateValue,
            street: streetValue,
            streetNumber: streetNumberValue,
            postalcode: postalcodeValue,
            city: cityValue,
            country: countryValue,
            phonenumber: phonenumberValue,
            email: emailValue,
            comment: commentValue,
        }

        const formDataFields = {
            salutation: salutation,
            firstName: firstName,
            lastName: lastName,
            birthDate: birthDate,
            street: street,
            streetNumber: streetNumber,
            postalcode: postalcode,
            city: city,
            country: country,
            phonenumber: phonenumber,
            email: email,
        }

        let wrongFields = []

        // Validate all fields (defined in validationFields) for content
        const validate = (obj, fields) => {

            for (let field of fields) {
                if (!Array.isArray(field)) {
                    if (field === 'email' || field === 'mail') {
                        if (obj?.[field] === undefined || obj?.[field] === '' || !regexEmail.test(obj?.[field])) wrongFields.push(field); 
                    }
                    if (obj?.[field] === undefined || obj?.[field] === '') wrongFields.push(field);
                } else if (!obj?.[field[0]] || !checkField(obj[field[0]], field[1])) return false;
            }
            
            if (wrongFields.length != 0) {
                for (let field of wrongFields) {
                    $(formDataFields?.[field]).addClass('input-error')
                }
                return false;
            }

            invoiceData = formData
            
           dataFields.append('invoiceData', JSON.stringify(invoiceData))
            
            return true;

        };
        return validate(formData, validationFields)
        
    }

    const validateDeliveryDatas = () => {


        // Lieferdaten
        const delFirstNameValue = delFirstName.val()
        const delLastNameValue = delLastName.val()
        const postofficeDeliveryValue = $(postofficeDelivery).is(':checked')
        const delLockerIdValue = delLockerId.val()
        const delPostnumberValue = delPostnumber.val()
        const delStreetValue = delStreet.val()
        const delStreetNumberValue = delStreetNumber.val()
        const delPostalcodeValue = delPostalcode.val()
        const delCityValue = delCity.val()
        const delCountryValue = delCountry.val()
        const delCommentValue = delComment.val()

        var validationFields = [
            'delFirstName',
            'delLastName',
            'delStreet',
            'delStreetNumber',
            'delPostalcode',
            'delCity',
            'delCountry',
        ]

        var formData = {
           delFirstName: delFirstNameValue,
           delLastName: delLastNameValue,
            postofficeDelivery: postofficeDeliveryValue,
           delLockerId: delLockerIdValue,
           delPostnumber: delPostnumberValue,
           delStreet: delStreetValue,
           delStreetNumber: delStreetNumberValue,
           delPostalcode: delPostalcodeValue,
           delCity: delCityValue,
           delCountry: delCountryValue,
           delComment: delCommentValue,
        }

        var formDataFields = {
           delFirstName: delFirstName,
           delLastName: delLastName,
            postofficeDelivery: postofficeDelivery,
           delLockerId: delLockerId,
           delPostnumber: delPostnumber,
           delStreet: delStreet,
           delStreetNumber: delStreetNumber,
           delPostalcode: delPostalcode,
           delCity: delCity,
           delCountry: delCountry,
        }

        // If postofficeDelivery is checked, add postnumber to validationFields
        // Remove street and streetNumber from validationFields
        if (postofficeDeliveryValue) {
            validationFields.push('delLockerId')
            validationFields.push('delPostnumber')
            validationFields = validationFields.filter(item => item !== 'delStreet')
            validationFields = validationFields.filter(item => item !== 'delStreetNumber')
        }

        let wrongFields = []

        // Validate all fields (defined in validationFields) for content
        const validate = (obj, fields) => {

            for (let field of fields) {
                if (!Array.isArray(field)) {
                    if (obj?.[field] === undefined || obj?.[field] === '') wrongFields.push(field);
                } else if (!obj?.[field[0]] || !checkField(obj[field[0]], field[1])) return false;
            }
            
            if (wrongFields.length != 0) {
                for (let field of wrongFields) {
                    $(formDataFields?.[field]).addClass('input-error')
                }
                return false;
            }

           deliveryData = formData
            
           dataFields.append('deliveryData', JSON.stringify(deliveryData))
            
            return true;

        };
        return validate(formData, validationFields)
    }

    const validateProducts = () => {

        const productItems = $('#orderedProductList').children()

        if (productItems.length === 0) {
            return false
        }
        
        let wrongFields = []
        let productsData = []

        productItems.each(function() {

            const orderProductId = $(this).attr('product-id')
            const product = $('select[name=product]', this)
            const productAmount = $('input[name=productAmount]', this)
            const prepared = $('select[name=prepared]', this)
            
            const productValue = product.val()
            const productAmountValue = productAmount.val()

            productsData.push({
                orderProductId: orderProductId,
                product: productValue,
                amount: productAmountValue,
                prepared: (prepared.val() == 'false') ? false : true,
            })

            if (productValue === undefined || productValue === '') {
                wrongFields.push(product)
            }

            if (productAmountValue === undefined || productAmountValue === '' || productAmountValue === 0) {
                wrongFields.push(productAmount)
            }
        })

        if (wrongFields.length != 0) {
            for (let field of wrongFields) {
                field.addClass('input-error')
            }
            return false;
        }

       dataFields.append('productsData', JSON.stringify(productsData))
        return true

    }

    $(orderStatus).on('change', function() {

        $('#orderDetailsForm [name="statusAlert"]').addClass('hidden')

        const $newStatus = $(this).val()

        if ($newStatus === 'shipped') {

            // Check delivery label in backend
            $.ajax({
                type: 'POST',
                url: '{% url "request_order_functions" %}',
                traditional: true,
               data: {
                    'checkDeliveryLabel': 'checkDeliveryLabel',
                    'orderId': orderIdInput.val(),
                },
                success: (data) => {

                    // Show statusAlert if delivery label not exists
                    if (!data.deliveryLabelExists) {
                        $('#orderDetailsForm [name="statusAlert"]').removeClass('hidden')
                        orderStatus.val(data.status)
                    }
                    
                },
                error: () => {
                    toggleModal('alert-modal')
                }
            })

        }
        
    })

    const updateOrder = () => {

       dataFields = new FormData()

        $('#orderDetailsForm input').removeClass('input-error')

        if (validateInoviceDatas() && validateDeliveryDatas() && validateProducts()) {

            $('.loading-screen').removeClass('hidden')

           dataFields.append('updateOrder', 'updateOrder')
           dataFields.append('orderId', orderIdInput.val())
           dataFields.append('paymentStatus', paymentStatus.val())
           dataFields.append('recipeStatus', recipeStatus.val())
           dataFields.append('orderStatus', orderStatus.val())

            $.ajax({
                type: 'POST',
                url: '{% url "request_order_functions" %}',
                processData: false,  // Wichtig: Verhindert, dass jQuery die Daten verarbeitet
                contentType: false,
                traditional: true,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': getCookie('csrftoken')
                },
               data: dataFields,
                success: (data) => {

                    let orderDetails = data.orderDetails

                    // Orderdetails
                    $('[name=total]', '#order-' + orderDetails.id).html(orderDetails.total)
                    $('[name=orderAmount]', '#order-' + orderDetails.id).html(orderDetails.products.length)

                    // Customer
                    $('[name=street]', '#order-' + orderDetails.id).html(orderDetails.street)
                    $('[name=streetNumber]', '#order-' + orderDetails.id).html(orderDetails.street_number)
                    $('[name=postalcode]', '#order-' + orderDetails.id).html(orderDetails.postalcode)
                    $('[name=city]', '#order-' + orderDetails.id).html(orderDetails.city)
                    $('[name=customerName]', '#order-' + orderDetails.id).html(orderDetails.first_name + ' ' + orderDetails.last_name)
                    $('[name=customerName]', '#order-' + orderDetails.id).parent().attr('data-bs-original-title', orderDetails.first_name + ' ' + orderDetails.last_name)

                    // Paymentstatus
                    $('#payment_status' + orderDetails.id + ' > span').html(orderDetails.payment_status_display)
                    $('#payment_status' + orderDetails.id + ' .status-circle').attr('value', orderDetails.payment_status)

                    // Recipestatus
                    $('#recipe_status' + orderDetails.id + ' > span').html(orderDetails.recipe_status_display)
                    $('#recipe_status' + orderDetails.id + ' .status-circle').attr('value', orderDetails.recipe_status)

                    // Orderstatus
                    $('#status' + orderDetails.id + ' > span').html(orderDetails.status_display)
                    $('#status' + orderDetails.id + ' .status-circle').attr('value', orderDetails.status)
            
                    $('.loading-screen').addClass('hidden')
                    hideModal('orderModal')
                    showToast('orderUpdatedToast')

                },
                error: () => {
            
                    $('.loading-screen').addClass('hidden')
                    hideModal('orderModal')
                    toggleModal('alert-modal')
            
                }
            })

        } else {
            
            showToast('orderWrongToast')
        }

    }

    const cancelDeleteOrderProduct = () => {

        const orderId = $('#product-delete-modal [name="orderId"]').val()

        hideModal('product-delete-modal')
        getOrderDetails(orderId)
    }
    
    const deleteOrderProduct = (productId, productName, orderNumber) => {

        // Show delete confirmation
        $('#product-delete-modal [name="productName"]').html(productName)
        $('#product-delete-modal [name="orderNumber"]').html(orderNumber)
        $('#product-delete-modal [name="productId"]').val(productId)
        $('#product-delete-modal [name="orderId"]').val(orderIdInput.val())

        hideModal('orderModal')
        toggleModal('product-delete-modal', {'backdrop': 'static'})
    }
    
    const saveDeleteOrderProduct = () => {

        const productId = $('#product-delete-modal [name="productId"]').val()
        const orderId = $('#product-delete-modal [name="orderId"]').val()

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'deleteOrderProduct': 'deleteOrderProduct',
                'productId': productId,
            },
            success: (data) => {

                $('#orderProduct-' + productId).remove()

                // Update order amount
                orderAmount.html(data.orderDetails.orderAmount)
                showToast('successToast', 'Produkt wurde gel√∂scht.')
                hideModal('product-delete-modal')

                getOrderDetails(orderId)
        
            },
            error: () => {
        
                toggleModal('alert-modal')
        
            }
        })

    }

    const addProduct = (productId) => {

        var timer = setTimeout(function() {
            // Zeigen Sie den Ladebildschirm an, wenn die Ajax-Anfrage noch nicht fertig ist
            $('.loading-screen').addClass('hidden')
        }, 2000);
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_customer_functions" %}',
            traditional: true,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
           data: {
                'addProduct': 'addProduct',
                'orderId': orderIdInput.val(),
                'productId': productId,
            },
            success: (data) => {

                console.log(data)

                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')

                if (data.product.created) {

                    $('#orderedProductList').append(dashBoardProducts(data.product, data.orderNumber))

                    const productSelect = $('#orderProduct-' + data.product.id + ' select[name=product]')
                    const preparedSelect = $('#orderProduct-' + data.product.id + ' select[name=prepared]')

                    // Auswahl des Produktes
                    for (product_item of data.products) {

                        if (data.product.productId == product_item.id) {
                            productSelect.append('<option selected value="' + product_item.id + '">' + product_item.name + ' (' + product_item.genetic + ') ' + '[THC: ' + product_item.thc + ']</option>')
                        } else {
                            productSelect.append('<option value="' + product_item.id + '">' + product_item.name + ' (' + product_item.genetic + ') ' + '[THC: ' + product_item.thc + ']</option>')
                        }
                    }

                    // Auswahl der Form (Bl√ºt oder Extrakt)
                    for (preparedChoice of data.preparedChoices) {
                        if (data.product.prepared == preparedChoice.value) {
                            preparedSelect.append('<option selected value="' + preparedChoice.value + '">' + preparedChoice.name + '</option>')
                        } else {
                            preparedSelect.append('<option value="' + preparedChoice.value + '">' + preparedChoice.name + '</option>')
                        }
                    }
                    // Bei Extrakt disabled, da keine verarbeiteten Extrakte
                    if (preparedChoice.value === 'extract') {
                        preparedSelect.prop('disabled', true)
                    }
                } else {
                    $('#orderProduct-' + data.product.id + ' [name=productPrice]').html(data.product.total)
                    $('#orderProduct-' + data.product.id + ' input[name=productAmount]').val(data.product.amount)
                }

                $(orderAmount).html(data.total)
            },
            error: () => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
            }
        })
    }

    const updateOrderStatus = (orderId) => {
            
        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'updateOrderStatus': 'updateOrderStatus',
                'orderId': orderId,
            },
            success: (data) => {

                orderStatus.val(data.order.status)

                $('#status' + orderId + ' > span').html(data.order.statusDisplay)
                $('#status' + orderId + ' .status-circle').attr('value', data.order.status)
            },
            error: () => {
        
                toggleModal('alert-modal')
            }
        })
    }

    // Change delivery to postoffice
    $('#postoffice-delivery').on('click', function() {

        changeDeliveryToPostoffice()

    })

    const changeDeliveryToPostoffice = () => {

        if ($(postofficeDelivery).is(':checked')) {
            // Disable delStreet and delStreetNumber
           delStreet.prop('disabled', true)
           delStreetNumber.prop('disabled', true)

           delStreet.prev().addClass('disabled')
           delStreetNumber.prev().addClass('disabled')

            // Show postnumber field
           delLockerId.parent().removeClass('hidden')
           delPostnumber.parent().removeClass('hidden')
        } else {
            // Enable delStreet and delStreetNumber
           delStreet.prop('disabled', false)
           delStreetNumber.prop('disabled', false)

           delStreet.prev().removeClass('disabled')
           delStreetNumber.prev().removeClass('disabled')

            // Hide postnumber field
           delLockerId.parent().addClass('hidden')
           delPostnumber.parent().addClass('hidden')
        }

    }

</script>

<script>

    const showProducts = (orderId, element) => {
        
        if ($('#products-order-' + orderId).hasClass('hidden')) {
            $('.orders .show-products').removeClass('open')
            $('.order-products').addClass('hidden')
            $('#products-order-' + orderId).removeClass('hidden')
        } else {
            $('#products-order-' + orderId).addClass('hidden')
        }
    }

</script>

<!-- Order Comment -->
<script>

    const editInternComment = (orderId) => {

        $('#products-order-' + orderId + ' div[name="intern_comment"]').addClass('hidden')
        $('#products-order-' + orderId + ' button[name="intern_comment_button"]').addClass('hidden')
        $('#products-order-' + orderId + ' div[name="intern_comment_field"]').removeClass('hidden')
    }

    const cancelInternComment = (orderId) => {

        $('#products-order-' + orderId + ' div[name="intern_comment"]').removeClass('hidden')
        $('#products-order-' + orderId + ' button[name="intern_comment_button"]').removeClass('hidden')
        $('#products-order-' + orderId + ' div[name="intern_comment_field"]').addClass('hidden')
    }

    const saveInternComment = (orderId) => {

        const comment = $('#products-order-' + orderId + ' textarea[name=intern_comment]').val()

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'saveInternComment': 'saveInternComment',
                'orderId': orderId,
                'comment': comment,
            },
            success: (data) => {

                $('#order-' + orderId + ' div[name="intern_comment_icon"]').removeClass('hidden')
                $('#products-order-' + orderId + ' div[name="intern_comment"] span').html(data.comment)
                $('#products-order-' + orderId + ' div[name="intern_comment"]').removeClass('hidden')
                $('#products-order-' + orderId + ' button[name="intern_comment_button"]').removeClass('hidden')
                $('#products-order-' + orderId + ' div[name="intern_comment_field"]').addClass('hidden')

                showToast('orderCommentSavedToast')
            },
            error: () => {
                toggleModal('alert-modal')
            }
        })
    }

</script>

<!-- Change delivery type -->
<script>

    const changeDeliveryType = (orderId, deliveryType, element) => {

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'changeDeliveryType': 'changeDeliveryType',
                'orderId': orderId,
                'deliveryType': deliveryType,
            },
            success: (data) => {

                $('.loading-screen').addClass('hidden')
                
                let template = $(element).children().first().clone()

                $('#deliveryType-' + orderId).children().first().remove()
                $('#deliveryType-' + orderId).prepend(template)
            },
            error: () => {
            
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')  
            }
        })
    }

</script>

<!-- Change customer type -->
<script>

    const changeCustomerType = (orderId, customerType, element) => {

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'changeCustomerType': 'changeCustomerType',
                'orderId': orderId,
                'customerType': customerType,
            },
            success: (data) => {

                $('.loading-screen').addClass('hidden')
                
                let template = $(element).children().first().clone()

                $('#customerType-' + orderId).children().first().remove()
                $('#customerType-' + orderId).prepend(template)
            },
            error: () => {
            
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
            }
        })

    }

</script>

<!-- Invoice -->
<script>

    const createNewInvoice = () => {
        
        const orderId = orderIdInput.val()
        
        hideModal('orderModal')

        $('#create-new-invoice-modal input[name="orderId"]').val(orderId)
        toggleModal('create-new-invoice-modal')
    }

    const saveCreateNewInvoice = () => {

        const orderId = $('#create-new-invoice-modal input[name="orderId"]').val()

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'createNewInvoice': 'createNewInvoice',
                'orderId': orderId,
            },
            success: (data) => {
                
                $('.loading-screen').addClass('hidden')
                hideModal('create-new-invoice-modal')
                
                window.open(data.downloadLink, '_blank')
            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                hideModal('create-new-invoice-modal')
                toggleModal('alert-modal')
            }
        })
    }

    const downloadCustomerInvoice = () => {

        const orderId = orderIdInput.val()
       downloadInvoice('customer', orderId)
    }

    const donwloadInsuranceInvoice = () => {

        const orderId = orderIdInput.val()
       downloadInvoice('insurance', orderId)
    }

    const downloadInvoice = (invoiceType, orderId) => {

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
           data: {
                'downloadInvoice': 'downloadInvoice',
                'orderId': orderId,
                'invoiceType': invoiceType,
            },
            success: (data) => {
                
                window.open(data.downloadLink, '_blank')
        
            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

</script>

<!-- Deliveryy label -->
<script>

    const generateDeliveryLabel = () => {

        $('.loading-screen').removeClass('hidden')

        const orderId = orderIdInput.val()
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'generateDeliveryLabel': 'generateDeliveryLabel',
                'orderId': orderId,
            },
            success: (data) => {
                
                $('.loading-screen').addClass('hidden')

                if (data.response.success) {

                    pickUpButton.prop('disabled', false)
                    pickUpButton.next().addClass('hidden')

                    // Sendugnsnummer anzeigen
                    cancelDeliveryLabelButton.removeClass('hidden')
                    $('#orderDetailsForm [name="shipment_shipment_no"]').removeClass('hidden')
                    $('#orderDetailsForm [name="shipment_shipment_no"] span[name="labelType"]').html(data.shipmentLabelTypeDisplay)
                    $('#orderDetailsForm [name="shipment_shipment_no"] span[name="labelNumber"]').html(data.shipmentShipmentNo)

                   dhlButton.html('\
                       dHL Label herunterladen\
                        <svg class="ml- 2w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\
                            <path fill-rule="evenodd" d="M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z" clip-rule="evenodd"/>\
                            <path fill-rule="evenodd" d="M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z" clip-rule="evenodd"/>\
                        </svg>\
                    ')

                    goExpressButton.html('\
                        GO! Express herunterladen\
                        <svg class="ml- 2w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\
                            <path fill-rule="evenodd" d="M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z" clip-rule="evenodd"/>\
                            <path fill-rule="evenodd" d="M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z" clip-rule="evenodd"/>\
                        </svg>\
                    ')

                    // DHL Standard
                    if (data.shipmentLabelType === 'dhl_standard') {

                        // Enable Pickup Button
                        pickUpButton.prop('disabled', false)
                        pickUpButton.next().removeClass('hidden')
                        
                        pickUpButton.html('\
                            Abholung beauftragen\
                            <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">\
                                <path d="M12.013 6.175 7.006 9.369l5.007 3.194-5.007 3.193L2 12.545l5.006-3.193L2 6.175l5.006-3.194 5.007 3.194ZM6.981 17.806l5.006-3.193 5.006 3.193L11.987 21l-5.006-3.194Z"/>\
                                <path d="m12.013 12.545 5.006-3.194-5.006-3.176 4.98-3.194L22 6.175l-5.007 3.194L22 12.562l-5.007 3.194-4.98-3.211Z"/>\
                            </svg>\
                        ')
                            
                    }

                    updateOrderStatus(orderId)

                    window.open(data.downloadLink, '_blank')
                } else {
                    console.error(data.response)
                    hideModal('orderModal')
                    toggleModal('alert-modal')
                }
        
            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                hideModal('orderModal')
                toggleModal('alert-modal')
        
            }
        })


    }

    const updateDeliveryLabel = () => {

        $('.loading-screen').removeClass('hidden')

        const orderId = orderIdInput.val()
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'updateDeliveryLabel': 'updateDeliveryLabel',
                'orderId': orderId,
            },
            success: (data) => {
                
                $('.loading-screen').addClass('hidden')

                if (data.response.success) {

                    // Show toast
                    showToast('successToast', 'Versandlabel erfolgreich aktualisiert.')

                } else {
                    console.error(data.response)
                    hideModal('orderModal')
                    toggleModal('alert-modal')
                }
        
            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                hideModal('orderModal')
                toggleModal('alert-modal')
        
            }
        })


    }

    const updateGOExpressStatus = () => {

        $('.loading-screen').removeClass('hidden')

        const orderId = orderIdInput.val()
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'updateGOExpressStatus': 'updateGOExpressStatus',
                'orderId': orderId,
            },
            success: (data) => {
                
                $('.loading-screen').addClass('hidden')

                if (data.response.success) {

                    // Show toast
                    showToast('successToast', 'Versandlabel Status erfolgreich aktualisiert.')

                } else {
                    console.error(data.response)
                    hideModal('orderModal')
                    toggleModal('alert-modal')
                }
        
            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                hideModal('orderModal')
                toggleModal('alert-modal')
        
            }
        })


    }

    const cancelDeliveryLabel = () => {

        const orderId = orderIdInput.val()

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'cancelDeliveryLabel': 'cancelDeliveryLabel',
                'orderId': orderId,
            },
            success: (data) => {

                if (data.stateError) {
                    hideModal('orderModal')
                    toggleWarningModal(data.message)
                    return false
                }

                if (data.response.success) {

                    cancelDeliveryLabelButton.addClass('hidden')
                    $('#orderDetailsForm [name="shipment_shipment_no"]').addClass('hidden')

                   dhlButton.html('\
                       dHL Label generieren\
                        <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">\
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7 7V5"/>\
                        </svg>\
                    ')

                    goExpressButton.html('\
                        Go! Express generieren\
                        <svg class="ml-2 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">\
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7 7V5"/>\
                        </svg>\
                    ')
                            
                    // Disable Pickup Button
                    pickUpButton.prop('disabled', false)

                    // Show toast
                    showToast('deletedToast', 'Versandlabel wurde erfolgreich storniert.')

                    updateOrderStatus(orderId)

                } else {
                    hideModal('orderModal')
                    toggleModal('alert-modal')
                }
        
            },
            error: () => {

                hideModal('orderModal')
                toggleModal('alert-modal')
        
            }
        })

    }

    const orderPickUp = () => {
        
        $('.loading-screen').removeClass('hidden')

        const orderId = orderIdInput.val()
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
           data: {
                'orderPickUp': 'orderPickUp',
                'orderId': orderId,
            },
            success: (data) => {
                
                $('.loading-screen').addClass('hidden')

                if (data.response.success) {

                    pickUpButton.prop('disabled', true)
                    pickUpButton.html('Abholung: ' + data.response.pickUpDate)

                } else {

                    console.error(data.response)
                    hideModal('orderModal')
                    toggleModal('alert-modal')
                }
        
            },
            error: () => {

                $('.loading-screen').addClass('hidden')
                hideModal('orderModal')
                toggleModal('alert-modal')
        
            }
        })

    }

</script>

<!-- Filter Functions -->
<script data-baseUrl="{{ baseUrl }}">

    const searchCategories = {
        'search': 'Suche',
        'search_product': 'Produkt',
        'search_invoice': 'Rechnung',
    }

    const filterDatas = document.currentScript.dataset

    // Get Filters from URL
    const queryString = window.location.search
    var urlParams = new URLSearchParams(queryString)

    const customFilter = (filterCriterias, filterButton=null) => {

        // Show all
        if (!filterCriterias || filterCriterias == '') {
            window.location.href = filterDatas.baseurl + '?page=1'
        // Show by filter
        } else {

            if (filterButton) {
                window.location.href = filterDatas.baseurl + '?page=1&filterButton=' + $(filterButton).attr('id') + '&' + filterCriterias
            } else {
                window.location.href = filterDatas.baseurl + '?page=1&' + filterCriterias
            }
        }

    }

    // Select search category
    const selectSearchCategory = (element, category) => {
        
        $('#searchDropdownButton span').html($(element).html())
        $('#searchOrderInput').attr('placeholder', 'Suche nach ' + $(element).html())
        $('#searchOrderInput').attr('data-search-category', category)

    }

    // Search Order
    const searchOrder = () => {

        const searchValue = $('#searchOrderInput').val()
        const searchCategory = $('#searchOrderInput').attr('data-search-category')

        // Remove all search parameters in searchCategories
        for (const [key, value] of Object.entries(searchCategories)) {
            if (key !== searchCategory) {
                urlParams.delete(key)
            }
        }

        updateUrlParameters(searchCategory, searchValue)
    }

    $('#searchOrderInput').on('keyup', function (e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
            searchOrder()
        }
    })

    // Update url parameters by class_name and value
    const updateUrlParameters = (class_name, value) => {

        if (value) {

            if (urlParams.get(class_name) === undefined
            || urlParams.get(class_name) === ''
            || urlParams.get(class_name) === null
            || class_name=='search'
            || class_name=='search_product'
            || class_name=='search_invoice'
            || class_name=='search_total'
            || class_name=='amount_payable'
            ) {
                urlParams.set(class_name, value)
            } else {

                let temp_values = urlParams.get(class_name).split(',')

                if (temp_values.includes(value)) {
                    temp_values = temp_values.filter(item => item !== value)
                } else {
                    temp_values.push(value)
                }

                if (temp_values.length === 0 || temp_values === undefined) {
                    urlParams.delete(class_name)
                } else {
                    urlParams.set(class_name, temp_values.join(','))
                }

            }
        } else {
            urlParams.delete(class_name)
        }

        urlParams.set('page', 1)

        let newUrlParams = new URLSearchParams(urlParams).toString()

        window.location.href = (filterDatas.baseurl + '?' + newUrlParams.replace(/%2C/g, ','))

    }

    // Remove url parameters by class_name
    const removeUrlParameters = (class_name) => {

        urlParams.delete(class_name)
        urlParams.set('page', 1)

        let newUrlParams = new URLSearchParams(urlParams).toString()

        window.location.href = (filterDatas.baseurl + '?' + newUrlParams.replace(/%2C/g, ','))

    }

    // Remove all filters
    const resetFilter = () => {
        window.location.href = filterDatas.baseurl + '?page=1'
    }

</script>

<!-- New recipe file -->
<script>

    const newRecipeFileInput = $('input[name="newRecipeFile"]', '#uploadRecipeForm')
    const recipeOrderIdInput = $('input[name="orderId"]', '#uploadRecipeForm')
    const recipeERecipeCheckbox = $('input[name="eRecipe"]', '#uploadRecipeForm')
    const recipeNumberInput = $('input[name="recipeNumber"]', '#uploadRecipeForm')

    const recipeFileAlert = $('#uploadRecipeForm [name="recipeFileAlert"]')
    const recipeNumberAlert = $('#uploadRecipeForm [name="recipeNumberAlert"]')

    const uploadNewRecipeFile = () => {

        const orderId = orderIdInput.val()

        $('#upload-recipe-popup-modal input[name="orderId"]').val(orderId)
        $('#upload-recipe-popup-modal [name="order_number"]').html(orderNumber.html())

        // close order modal
        hideModal('orderModal')

        // open upload recipe file modal
        toggleModal('upload-recipe-popup-modal')

    }

    const changeRecipeType = (element) => {

        // show recipe number field if not checked
        if (!element.checked) {
            recipeNumberInput.removeClass('hidden')
        } else {
            recipeNumberInput.addClass('hidden')
        }

    }

    const saveUploadNewRecipe = () => {
            
        const orderId = recipeOrderIdInput.val()
        const eRecipe = recipeERecipeCheckbox.prop('checked')
        const recipeNumber = recipeNumberInput.val()

        const formData = new FormData()
        formData.append('uploadNewRecipe', 'uploadNewRecipe')
        formData.append('orderId', orderId)
        formData.append('eRecipe', JSON.stringify(eRecipe))
        formData.append('recipeNumber', recipeNumber)
        formData.append('recipeFile', newRecipeFileInput[0].files[0])

        // validate if recipe file input is empty
        if (!newRecipeFileInput[0].files[0]) {
            recipeFileAlert.removeClass('hidden')
            return
        } else {
            recipeFileAlert.addClass('hidden')
        }

        // Alert if eRecipe is not checked and recipe number is empty
        if (!eRecipe && recipeNumber === '') {
            recipeNumberAlert.removeClass('hidden')
            return
        } else {
            recipeNumberAlert.addClass('hidden')
        }

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            processData: false,  // Wichtig: Verhindert, dass jQuery die Daten verarbeitet
            contentType: false,
            traditional: true,
           data: formData,
            success: (data) => {

                $('.loading-screen').addClass('hidden')
                hideModal('upload-recipe-popup-modal')
                showToast('successToast', 'Rezept erfolgreich hochgeladen.')

                getOrderDetails(orderId)

            },
            error: () => {
        
                $('.loading-screen').addClass('hidden')
                hideModal('upload-recipe-popup-modal')
                toggleModal('alert-modal')
        
            }
        })
    }

</script>

<!-- General functions -->
<script>

    const updateDeliveryStatus = () => {

        const orderIds = $('.order-checkbox:checked').map(function() {
            return $(this).val()
        }).get()

        if (orderIds.length === 0) {
            showToast('warningToast', 'Bitte w√§hlen Sie mindestens eine Bestellung aus.')
            return false;
        }

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'updateDeliveryStatus': 'updateDeliveryStatus',
                'orderIds[]': JSON.stringify(orderIds),
            },
            success: (data) => {

                $('.loading-screen').addClass('hidden')
                location.reload()
        
            },
            error: () => {
            
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

    const updateAllDeliveryStatus = () => {

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'updateAllDeliveryStatus': 'updateAllDeliveryStatus',
            },
            success: (data) => {

                $('.loading-screen').addClass('hidden')
                location.reload()
        
            },
            error: () => {
            
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })
    }

    const sendOrderCreatedToCustomer = () => {
        
        const orderIds = $('.order-checkbox:checked').map(function() {
            return $(this).val()
        }).get()

        if (orderIds.length === 0) {
            showToast('warningToast', 'Bitte w√§hlen Sie mindestens eine Bestellung aus.')
            return false;
        }

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'sendOrderCreatedToCustomer': 'sendOrderCreatedToCustomer',
                'orderIds[]': orderIds,
            },
            success: (data) => {

                $('.loading-screen').addClass('hidden')
                showToast('successToast', 'Bestellbest√§tigung erfolgreich versendet.')

                // Remove all checked checkboxes
                $('.order-checkbox:checked').prop('checked', false)
        
            },
            error: () => {
            
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

    const confirmCreatedOrder = () => {

        const orderIds = $('.order-checkbox:checked').map(function() {
            return $(this).val()
        }).get()

        if (orderIds.length === 0) {
            showToast('warningToast', 'Bitte w√§hlen Sie mindestens eine Bestellung aus.')
            return false;
        }

        console.log(orderIds)

        $('.loading-screen').removeClass('hidden')

        $.ajax({
            type: 'POST',
            url: '{% url "request_order_functions" %}',
            traditional: true,
           data: {
                'confirmCreatedOrder': 'confirmCreatedOrder',
                'orderIds[]': JSON.stringify(orderIds),
            },
            success: (data) => {

                $('.loading-screen').addClass('hidden')
                location.reload()
        
            },
            error: () => {
            
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

</script>

{% endblock %}
