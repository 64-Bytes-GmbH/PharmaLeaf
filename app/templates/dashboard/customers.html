<!-- templates/index.html -->

{% extends "dashboard/base.html" %}
{% load static extra_tags %}

{% block content %}

<section class="antialiased">
    <div class="">
        <section class="flex h-screen bg-white">
            <div class="w-full mx-auto">
                <!-- Start coding here -->
                <div class="relative overflow-hidden">
                    <div class="flex flex-col px-4" style="height: calc(100vh);">
                        <div class="flex flex-col py-3 space-y-3 md:flex-row md:items-center md:justify-between md:space-y-0 md:space-x-4">
                            <h4 class="font-mono text-xl font-bold ">Kunden</h4>
                        </div>
                        <div class="flex flex-col py-3 space-y-3 md:flex-row md:items-center md:justify-between md:space-y-0 md:space-x-4">
                            <div class="flex items-center flex-1 space-x-4">
                                <h5>
                                    <span>{{ customers.paginator.count }} </span><span>{% if customers.paginator.count == 1 %}Kunde{% else %}Kunden{% endif %}</span>
                                </h5>
                            </div>
                            
                            <button type="button" onclick="createCustomer()" class="flex mr-2 items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-full bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 focus:outline-none">
                                <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path clip-rule="evenodd" fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                                </svg>
                                Neuen Kunden anlegen
                            </button>
                            <button type="button" id="addOrderButton" onclick="createOrderChecked()" disabled class="disabled flex mr-2 items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-full bg-gray-300 focus:ring-4 focus:ring-emerald-300 focus:outline-none">
                                <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path clip-rule="evenodd" fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                                </svg>
                                Bestellung anlegen
                            </button>
                        </div>
                        <div class="flex flex-col items-stretch justify-between py-4 space-y-3 md:flex-row md:items-center md:space-y-0">
                    
                            <div class="flex flex-row">
                                <div class="relative" style="min-width: 300px;">
                                    <div class="absolute inset-y-0 start-0 flex items-center ps-4 pointer-events-none">
                                        <svg class="h-3.5 w-3.5 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                                        </svg>
                                    </div>
                                    <input type="text" id="searchCustomer" class="bg-gray-50 border w-full border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block ps-10 p-2" placeholder="Vorname, Nachname, E-Mail" required>
                                </div>
                                <button type="button" onclick="searchCustomer()" class="flex mr-2 items-center justify-center px-4 py-2 ms-2 text-sm font-medium text-white rounded-full bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 focus:outline-none">
                                    <svg class="h-3.5 w-3.5 me-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                                    </svg>
                                    Suchen
                                </button>
                            </div>
        
                            <div class="flex flex-row">
                                <button type="button" onclick="resetFilter()" class="flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-full text-sm">
                                    <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                                        <path d="M3.9 22.9C10.5 8.9 24.5 0 40 0H472c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L396.4 195.6C316.2 212.1 256 283 256 368c0 27.4 6.3 53.4 17.5 76.5c-1.6-.8-3.2-1.8-4.7-2.9l-64-48c-8.1-6-12.8-15.5-12.8-25.6V288.9L9 65.3C-.7 53.4-2.8 36.8 3.9 22.9zM432 224a144 144 0 1 1 0 288 144 144 0 1 1 0-288zm59.3 107.3c6.2-6.2 6.2-16.4 0-22.6s-16.4-6.2-22.6 0L432 345.4l-36.7-36.7c-6.2-6.2-16.4-6.2-22.6 0s-6.2 16.4 0 22.6L409.4 368l-36.7 36.7c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0L432 390.6l36.7 36.7c6.2 6.2 16.4 6.2 22.6 0s6.2-16.4 0-22.6L454.6 368l36.7-36.7z"/>
                                    </svg>
                                    Filter l√∂schen
                                </button>
                            </div>
                        </div>
                        <div id="table-container" style="flex: 1" class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500 ">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="p-4">
                                            <div class="flex items-center">
                                                <input id="checkbox-all" type="checkbox" class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500   focus:ring-2 ">
                                                <label for="checkbox-all" class="sr-only">checkbox</label>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-4 py-3">Name</th>
                                        <th scope="col" class="px-4 py-3">E-Mail</th>
                                        <th scope="col" class="px-4 py-3">Adresse</th>
                                        <th scope="col" class="px-4 py-3">Telefon</th>
                                        <th scope="col" class="px-4 py-3">Patiententyp</th>
                                        <th scope="col" class="px-4 py-3 whitespace-nowrap text-right">Anz. Bestellungen</th>
                                        <th scope="col" class="px-4 py-3">Bezahlmethode</th>
                                        <th scope="col" class="px-4 py-3">Lieferart</th>
                                        <th scope="col" class="px-4 py-3 whitespace-nowrap text-center">Einw. zur Bestellung</th>
                                        <th scope="col" class="px-4 py-3 whitespace-nowrap text-center">Blockiert</th>
                                        <th scope="col" class="px-4 py-3 whitespace-nowrap">Letzter Login</th>
                                        <th scope="col" class="px-4 py-3"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for customer in customers %}
                                    <tr id="customer-{{ customer.id }}" class="border-b hover:bg-gray-100 ">
                                        <!-- Checkbox -->
                                        <td class="w-4 px-4 py-3">
                                            <div class="flex items-center">
                                                <input data-customer-id="{{ customer.id }}" type="checkbox" onclick="event.stopPropagation()" class="customer-checkbox w-4 h-4 bg-gray-100 border-gray-300 rounded text-emerald-600 focus:ring-emerald-500   focus:ring-2 ">
                                            </div>
                                        </td>
                                        <!-- Name -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap">
                                            {{ customer.user.get_full_name }}
                                        </td>
                                        <!-- E-Mail -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap">
                                            <a href="mailto:{{ customer.user.email }}">{{ customer.user.email }}</a>
                                        </td>
                                        <!-- Adresse -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap">
                                            {{ customer.get_street_address }}<br>
                                            {{ customer.postcode }} {{ customer.city }}
                                        </td>
                                        <!-- Telefon -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap">
                                            {{ customer.phone }}
                                        </td>
                                        <!-- Patiententtyp -->
                                        <td class="px-4 py-2">
                                            <span
                                            class="text-xs font-medium px-2 py-0.5 rounded-full
                                            {% if customer.customer_type == 'self_payer' %}
                                            bg-emerald-600 text-white
                                            {% elif customer.customer_type == 'insurance_patient' %}
                                            bg-purple-100 text-purple-800
                                            {% elif customer.customer_type == 'insurance_patient_with_supplement' %}
                                            bg-emerald-100 text-emerald-800
                                            {% endif %}
                                            "
                                            value="{{ customer.customer_type }}">
                                                {{ customer.get_customer_type_display }}
                                            </span>
                                        </td>
                                        <!-- Anz. Bestellungen -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap text-right">
                                            {{ customer|get_customers_orders_amount }}
                                        </td>
                                        <!-- Bezahltmethode -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap text-right">
                                            {% if customer.payment_type %}
                                            {{ customer.get_payment_type_display }}
                                            {% else %}
                                            --
                                            {% endif %}
                                        </td>
                                        <!-- Lieferart -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap text-right">
                                            {% if customer.delivery_type %}
                                            {{ customer.get_delivery_type_display }}
                                            {% else %}
                                            --
                                            {% endif %}
                                        </td>
                                        <!-- Einw. zur Bestellung -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap">
                                            <div class="flex justify-center" data-can-trigger-order="{{ customer.can_trigger_order }}" name="can_trigger_order">
                                                <svg class="w-4 h-4 text-red-600 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                                    <path fill-rule="evenodd" d="M2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm7.7-3.7a1 1 0 0 0-1.4 1.4l2.3 2.3-2.3 2.3a1 1 0 1 0 1.4 1.4l2.3-2.3 2.3 2.3a1 1 0 0 0 1.4-1.4L13.4 12l2.3-2.3a1 1 0 0 0-1.4-1.4L12 10.6 9.7 8.3Z" clip-rule="evenodd"/>
                                                </svg>
                                                <svg class="w-4 h-4 text-green-500 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                                    <path fill-rule="evenodd" d="M2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm13.7-1.3a1 1 0 0 0-1.4-1.4L11 12.6l-1.8-1.8a1 1 0 0 0-1.4 1.4l2.5 2.5c.4.4 1 .4 1.4 0l4-4Z" clip-rule="evenodd"/>
                                                </svg>
                                            </div>
                                        </td>
                                        <!-- Blockiert -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap">
                                            <div class="flex justify-center">
                                                {% if not customer.blocked %}
                                                --                                
                                                {% else %}
                                                <svg class="w-4 h-4 text-red-600 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                                    <path fill-rule="evenodd" d="M2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm7.7-3.7a1 1 0 0 0-1.4 1.4l2.3 2.3-2.3 2.3a1 1 0 1 0 1.4 1.4l2.3-2.3 2.3 2.3a1 1 0 0 0 1.4-1.4L13.4 12l2.3-2.3a1 1 0 0 0-1.4-1.4L12 10.6 9.7 8.3Z" clip-rule="evenodd"/>
                                                </svg>                                
                                                {% endif %}
                                            </div>
                                        </td>
                                        <!-- Letzter login -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap">
                                            {% if customer.user.last_login %}
                                            {{ customer.user.last_login|date:'d.m.Y - H:i' }} Uhr
                                            {% else %}
                                            --
                                            {% endif %}
                                        </td>
                                        <!-- Edit -->
                                        <td class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap">
                                            <button id="dropdown-menu-button-{{ customer.id }}" data-dropdown-toggle="dropdown-menu-{{ customer.id }}" class="inline-flex items-center p-0.5 text-sm font-medium text-center text-gray-500 hover:text-gray-800 rounded-lg focus:outline-none  " type="button">
                                                <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z" />
                                                </svg>
                                            </button>
                                            <div id="dropdown-menu-{{ customer.id }}" class="hidden z-10 w-52 bg-white rounded divide-y divide-gray-100 shadow ">
                                                <ul class="py-1 text-sm text-gray-700 " aria-labelledby="dropdown-menu-{{ customer.id }}-button">
                                                    {% if customer.can_trigger_order %}
                                                    <li>
                                                        <a href="javascript:void(0)" onclick="createOrder('{{ customer.id }}')" class="block py-2 px-4 hover:bg-gray-100">                                      
                                                            Bestellung anlegen
                                                        </a>
                                                    </li>
                                                    {% endif %}
                                                    {% if not customer.can_trigger_order %}
                                                    <li>
                                                        <a href="javascript:void(0)" onclick="activateForOrder('{{ customer.id }}', this)" class="block py-2 px-4 hover:bg-gray-100">F√ºr Bestellung freischalten</a>
                                                    </li>
                                                    {% endif %}
                                                    <li>
                                                        <a href="javascript:void(0)" onclick="editCustomer('{{ customer.id }}')" class="block py-2 px-4 hover:bg-gray-100">Bearbeiten</a>
                                                    </li>
                                                    <li>
                                                        <a href="javascript:void(0)" class="block py-2 px-4 hover:bg-gray-100">Blockieren</a>
                                                    </li>
                                                    <li>
                                                        <a href="javascript:void(0)" class="block py-2 px-4 hover:bg-gray-100">Freischalten</a>
                                                    </li>
                                                </ul>
                                                <div class="py-1">
                                                    <a href="javascript:void(0)" class="block py-2 px-4 text-sm text-gray-700 hover:bg-gray-100 ">L√∂schen</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <nav class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-3 md:space-y-0 p-4 border-gray-600 border-t" aria-label="Table navigation">
                            <ul class="inline-flex items-stretch -space-x-px">
                                {% with customers.paginator.page_range|first as first_page %}
                                {% with 'page:'|concat_string:first_page as page_string %}
                                {% with updated_params=request.GET|add_get_parameter:page_string %}
                                <li>
                                    <a href="?{{ updated_params }}" class="flex items-center justify-center h-full py-1.5 px-3 ml-0 text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700  ">
                                        <span class="sr-only">Erste Seite</span>
                                        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" viewBox="0 0 12 10">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 1 1 5l4 4m6-8L7 5l4 4"/>
                                        </svg>
                                    </a>
                                </li>
                                {% endwith %}
                                {% endwith %}
                                {% endwith %}
                                {% for page_num in customers.paginator.page_range|get_page_range:customers.number %}
                                {% if customers.number == page_num %}
                                <li>
                                    <a href="?{{ updated_params }}" aria-current="page" class="flex items-center justify-center text-sm z-10 py-2 px-3 leading-tight text-emerald-600 bg-emerald-50 border border-emerald-300 hover:bg-emerald-100 hover:text-emerald-700  ">{{ page_num }}</a>
                                </li>
                                {% else %}
                                {% with 'page:'|concat_string:page_num as page_string %}
                                {% with updated_params=request.GET|add_get_parameter:page_string %}
                                <li>
                                    <a href="?{{ updated_params }}" class="flex items-center justify-center text-sm py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700  ">{{ page_num }}</a>
                                </li>
                                {% endwith %}
                                {% endwith %}
                                {% endif %}
                                {% endfor %}
                                {% with customers.paginator.page_range|last as last_page %}
                                {% with 'page:'|concat_string:last_page as page_string %}
                                {% with updated_params=request.GET|add_get_parameter:page_string %}
                                <li>
                                    <a href="?{{ updated_params }}" class="flex items-center justify-center h-full py-1.5 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700  ">
                                        <span class="sr-only">Letzte Seite</span>
                                        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" viewBox="0 0 12 10">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="m7 9 4-4-4-4M1 9l4-4-4-4"/>
                                        </svg>
                                    </a>
                                </li>
                                {% endwith %}
                                {% endwith %}
                                {% endwith %}
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>
    </div>
</section>

<!-- Order Modal -->
<div id="orderModal" tabindex="-1" data-modal-backdrop="static" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] md:h-full">
    <div class="relative w-full h-full md:h-auto" style="max-width: 75vw;max-height: 80vh;overflow-y: auto;">
        <!-- Modal content -->
        <div class="relative p-4 bg-white rounded-lg shadow sm:p-5">
            <!-- Modal header -->
            <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 ">
                <h3 class="text-lg font-semibold text-gray-900">Bestellung anlegen</h3>
                <button type="button" onclick="hideModal('orderModal')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5 ml-auto inline-flex items-center">
                    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            
            <form class="pt-5" id="orderDetailsForm">
                <div>
                    <!-- <h5 class="mb-4 text-lg font-semibold tracking-tight text-gray-900">
                        Bestelldaten
                    </h5> -->
                    <div class="grid gap-4 mb-5 sm:grid-cols-5">
                        <!-- Patientenart -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Patientenart
                            </p>
                            <select name="customerType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                <option value="">Bitte w√§hlen</option>
                                {% get_choices "CustomerTypeChoices" as CustomerTypeChoices %}
                                {% for item in CustomerTypeChoices %}
                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Zahlungsmethode -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Zahlungsmethode
                            </p>
                            <select name="paymentType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                <option value="">Bitte w√§hlen</option>
                                {% get_choices "PaymentTypeChoices" as PaymentTypeChoices %}
                                {% for item in PaymentTypeChoices %}
                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Liefermethode -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Liefermethode
                            </p>
                            <select name="deliveryType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                <option value="">Bitte w√§hlen</option>
                                {% get_choices "DeliveryTypeChoices" as DeliveryTypeChoices %}
                                {% for item in DeliveryTypeChoices %}
                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Rezeptstatus -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Rezeptstatus
                            </p>
                            <select name="recipeStatus" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                <option value="">Bitte w√§hlen</option>
                                {% get_choices "RecipeStatusChoices" as RecipeStatusChoices %}
                                {% for item in RecipeStatusChoices %}
                                {% if item.0 != 'incorrect' %}
                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Bestellsumme -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Bestellsumme
                            </p>
                            <span id="orderAmount" name="orderAmount" class="mb-4 text-sm font-medium text-gray-900 ">0,00 ‚Ç¨</span>
                        </div>
                    </div>
                </div>
                <input type="text" name="orderId" hidden>
                <div id="accordion-collapse" data-accordion="collapse">
                    <!-- Bestelldaten -->
                    <h2 id="update-product-accordion-collapse-heading-1" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" id="invoiceDataButton" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 border-t border-gray-200 sm:px-5 bg-gray-50 hover:bg-gray-100" data-accordion-target="#update-product-accordion-collapse-body-1" aria-expanded="true" aria-controls="update-product-accordion-collapse-body-2">
                            <span>Bestelldaten</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 rotate-180 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-1" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-2">
                        <div class="py-4 border-gray-200 sm:py-5 ">
                            <!-- Inputs -->
                                <!-- Column -->
                                <div class="">
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <!-- Salutation -->
                                        <div>
                                            <label for="salutation" class="block mb-2 text-sm font-medium text-gray-900">Anrede</label>
                                            <select id="salutation" name="salutation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                                {% get_choices "SalutationChoices" as SalutationChoices %}
                                                {% for item in SalutationChoices %}
                                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <!-- Vorname -->
                                        <div>
                                            <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900">Vorname</label>
                                            <input type="text" name="firstName" id="first_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Vorname" required="">
                                        </div>
                                        <!-- Nachname -->
                                        <div>
                                            <label for="last_name" class="block mb-2 text-sm font-medium text-gray-900">Nachname</label>
                                            <input type="text" name="lastName" id="last_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Nachname" required="">
                                        </div>
                                        <!-- Geburtsdatum -->
                                        <div class="relative max-w-sm">
                                            <label for="birth_date" class="block mb-2 text-sm font-medium text-gray-900">Geburtsdatum</label>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none">
                                                    <svg class="w-4 h-4 text-gray-500 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                                    </svg>
                                                </div>
                                                <input datepicker datepicker-format="dd.mm.yyyy" type="text" id="birth_date" name="birthDate" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full ps-10 p-2.5   " placeholder="Geburtsdatum">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <!-- Stra√üe -->
                                        <div>
                                            <label for="street" class="block mb-2 text-sm font-medium text-gray-900">Stra√üe</label>
                                            <input type="text" name="street" id="street" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Stra√üe" required="">
                                        </div>
                                        <!-- Hausnummer -->
                                        <div>
                                            <label for="street_number" class="block mb-2 text-sm font-medium text-gray-900">Hausnummer</label>
                                            <input type="text" name="streetNumber" id="street_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Hausnummer" required="">
                                        </div>
                                        <!-- PLZ -->
                                        <div>
                                            <label for="postalcode" class="block mb-2 text-sm font-medium text-gray-900">Postleitzahl</label>
                                            <input type="text" name="postalcode" id="postalcode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Postleitzahl" required="">
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-2">
                                        <!-- Stadt -->
                                        <div>
                                            <label for="city" class="block mb-2 text-sm font-medium text-gray-900">Stadt</label>
                                            <input type="text" name="city" id="city" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Stadt" required="">
                                        </div>
                                        <!-- Land -->
                                        <div>
                                            <label for="country" class="block mb-2 text-sm font-medium text-gray-900">Land</label>
                                            <select id="country" name="country" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                                {% get_choices "CountryChoices" as countries %}
                                                {% for item in countries %}
                                                <option value="{{item.0}}" {% if order.country == item.0 %}selected{% endif %}>{{ item.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <!-- Telefonnummer -->
                                        <div>
                                            <label for="phone_number" class="block mb-2 text-sm font-medium text-gray-900">Telefonnummer</label>
                                            <input type="text" name="phonenumber" id="phone_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Telefonnummer" required="">
                                        </div>
                                        <!-- E-Mail -->
                                        <div>
                                            <label for="email_address" class="block mb-2 text-sm font-medium text-gray-900">E-Mail Adresse</label>
                                            <input type="email" name="email" id="email_address" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="E-Mail Adresse" required="">
                                        </div>
                                        <!-- Kommentar -->
                                        <div class="sm:col-span-2">
                                            <label for="comment" class="block mb-2 text-sm font-medium text-gray-900">Kommentar</label>
                                            <textarea id="comment" name="comment" rows="4" class="block p-2.5 w-full text-sm rounded-lg text-gray-900 bg-gray-50 border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Kommentar"></textarea>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                    <!-- Lieferdaten -->
                    <h2 id="update-product-accordion-collapse-heading-2" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" id="deliverDataButton" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 border-t border-gray-200 sm:px-5 bg-gray-50 hover:bg-gray-100" data-accordion-target="#update-product-accordion-collapse-body-2" aria-expanded="true" aria-controls="update-product-accordion-collapse-body-3">
                            <span>Lieferdaten</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 rotate-180 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-2" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-2">
                        <div class="py-4 border-gray-200 sm:py-5 ">
                            <!-- Inputs -->
                                <!-- Column -->
                                <div class="">
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <div>
                                            <label for="del_first_name" class="block mb-2 text-sm font-medium text-gray-900">Vorname</label>
                                            <input type="text" name="delFirstName" id="del_first_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Vorname" required="">
                                        </div>
                                        <div>
                                            <label for="del_last_name" class="block mb-2 text-sm font-medium text-gray-900">Nachname</label>
                                            <input type="text" name="delLastName" id="del_last_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Nachname" required="">
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <div>
                                            <label for="del_street" class="block mb-2 text-sm font-medium text-gray-900">Stra√üe</label>
                                            <input type="text" name="delStreet" id="del_street" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Stra√üe" required="">
                                        </div>
                                        <div>
                                            <label for="del_street_number" class="block mb-2 text-sm font-medium text-gray-900">Hausnummer</label>
                                            <input type="text" name="delStreetNumber" id="del_street_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Hausnummer" required="">
                                        </div>
                                        <div>
                                            <label for="del_postalcode" class="block mb-2 text-sm font-medium text-gray-900">Postleitzahl</label>
                                            <input type="text" name="delPostalcode" id="del_postalcode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Postleitzahl" required="">
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-2">
                                        <div>
                                            <label for="del_city" class="block mb-2 text-sm font-medium text-gray-900">Stadt</label>
                                            <input type="text" name="delCity" id="del_city" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Stadt" required="">
                                        </div>
                                        <div>
                                            <label for="del_country" class="block mb-2 text-sm font-medium text-gray-900">Land</label>
                                            <select id="del_country" name="delCountry" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                                {% get_choices "CountryChoices" as countries %}
                                                {% for item in countries %}
                                                <option value="{{item.0}}" {% if order.country == item.0 %}selected{% endif %}>{{ item.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="sm:col-span-2">
                                            <label for="del_comment" class="block mb-2 text-sm font-medium text-gray-900">Kommentar</label>
                                            <textarea id="del_comment" name="delComment" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Kommentar"></textarea>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                    <!-- Rezepte -->
                    <h2 id="update-product-accordion-collapse-heading-3" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" id="recipeButton" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 border-t border-gray-200 sm:px-5 bg-gray-50 hover:bg-gray-100" data-accordion-target="#update-product-accordion-collapse-body-3" aria-expanded="false" aria-controls="update-product-accordion-collapse-body-4">
                            <span>Rezepte</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-3" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-3">
                        <div class="border-gray-200 ">
                            <!-- Hochladen -->
                            <div class="mt-4 grid gap-4 mb-5 sm:grid-cols-2">
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-900" for="recipeFile">Rezept hochladen</label>
                                    <input class="block w-full text-sm text-gray-900 border border-gray-300 rounded-full cursor-pointer bg-gray-50  focus:outline-none " aria-describedby="file_input_help" id="recipeFile" name="recipeFile" type="file">
                                    <p class="mt-1 text-sm text-gray-500 ">PDF, PNG oder JPG.</p>
                                </div>
                                <div class="pt-7 flex flex-row">
                                    <input type="text" name="recipeNumber" class="hidden mr-4 flex-grow mb-auto bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block p-2.5   " placeholder="Rezeptnummer*">
                                    <div class="flex items-center ms-auto me-4 mb-auto py-2.5">
                                        <input checked id="eRecipe" name="eRecipe" onchange="changeRecipeType(this)" type="checkbox" class="cursor-pointer w-4 h-4 text-emerald-600 bg-gray-100 border-gray-300 rounded focus:ring-emerald-500   focus:ring-2 ">
                                        <label for="eRecipe" class="cursor-pointer ms-2 text-sm font-medium text-gray-900 ">E-Rezept</label>
                                    </div>
                                    <button type="button" onclick="uploadRecipe()" class="mb-auto ml-auto text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-full text-sm px-5 py-2.5  ">Hochladen</button>
                                </div>
                            </div>
                            <!-- Rezepte -->
                            <div id="recipeList" class="py-4 flex flex-col gap-4">
                                <!-- <div id="recipeFile-" class="flex flex-row mb-4 pl-2.5 bg-gray-50 border border-gray-300 rounded-full">
                                    <a href="#" class="mr-4 my-auto flex-grow text-md font-medium text-green-500 hover:text-green-700">
                                        Rezept.pdf
                                    </a>
                                    <button type="button" onclick="deleteRecipe()" class="ml-auto text-red-700 hover:text-white border border-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-full text-sm px-5 py-2.5 text-center     ">
                                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                            <path fill-rule="evenodd" d="M8.6 2.6A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4c0-.5.2-1 .6-1.4ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z" clip-rule="evenodd"/>
                                        </svg>                                        
                                    </button>
                                </div> -->
                            </div>
                            <div id="orderRecipeAlert" class="hidden flex items-center p-4 mb-4 text-sm text-red-800 border border-red-300 rounded-full bg-red-50 " role="alert">
                                <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                                </svg>
                                <div>
                                    <span class="font-medium">Fehler!</span> Bitte lade mindestens ein Rezept hoch.
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Produkte -->
                    <h2 id="update-product-accordion-collapse-heading-4" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" id="productsButton" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 border-t border-gray-200 sm:px-5 bg-gray-50 hover:bg-gray-100" data-accordion-target="#update-product-accordion-collapse-body-4" aria-expanded="false" aria-controls="update-product-accordion-collapse-body-4">
                            <span>Produkte</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-4" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-3">
                        <div class="border-gray-200 ">
                            <!-- Suche -->
                            <div class="grid gap-4 mb-4 sm:grid-cols-2">
                                <div class="relative mt-5 searchProductContainer">
                                    <!-- <div class="relative"> -->
                                    <div class="absolute inset-y-0 start-0 flex items-center ps-4 pointer-events-none">
                                        <svg class="h-3.5 w-3.5 text-gray-500 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                                        </svg>
                                    </div>
                                    <input type="text" id="searchProduct" dropdown-max-height="300" data-search-type="add-product-search" class="searchProductInput bg-gray-50 border w-full border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block ps-10 p-2   " placeholder="Produktsuche" required>
                                </div>
                            </div>
                            <!-- Produktliste -->
                            <div id="productList" class="pt-5 flex flex-col gap-4">
                            </div>
                            <!-- Alert -->
                            <div id="orderProductsAlert" class="hidden flex items-center p-4 mb-4 text-sm text-red-800 border border-red-300 rounded-full bg-red-50 " role="alert">
                                <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                  <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                                </svg>
                                <div>
                                  <span class="font-medium">Fehler!</span> Bitte f√ºge mindestens ein Produkt hinzu.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-between pt-4 sm:flex sm:space-y-0 sm:space-x-4">
                    <div class="mb-4 sm:mb-0 items-center d-flex space-y-4 sm:flex sm:space-y-0 sm:space-x-4">
                        <button id="updateOrderBtn" type="button" onclick="saveOrder(this)" data-toast-name="orderUpdatedToast" type="submit" class="w-full sm:w-auto justify-center text-white inline-flex bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center">
                            Bestellung √ºbernehmen
                        </button>
                        <button onclick="hideModal('orderModal')" type="button" class="w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10">
                            <svg class="mr-1 -ml-1 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            Abbrechen
                        </button>
                    </div>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Customer Modal -->
<div id="customerModal" tabindex="-1" data-modal-backdrop="static" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] md:h-full">
    <div class="relative w-full h-full md:h-auto" style="max-width: 75vw;max-height: 80vh;overflow-y: auto;">
        <!-- Modal content -->
        <div class="relative p-4 bg-white rounded-lg shadow sm:p-5">
            <!-- Modal header -->
            <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b sm:mb-5 ">
                <h3 class="text-lg font-semibold text-gray-900" id="customerModalHeader">Kunden anlegen</h3>
                <button type="button" onclick="hideModal('customerModal')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-full text-sm p-1.5 ml-auto inline-flex items-center">
                    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            
            <form class="pt-5" id="customerDetailsForm">
                <div>
                    <!-- <h5 class="mb-4 text-lg font-semibold tracking-tight text-gray-900">
                        Bestelldaten
                    </h5> -->
                    <div class="grid gap-4 mb-5 sm:grid-cols-4">
                        <!-- Patientenart -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Patientenart
                            </p>
                            <select name="customerType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                {% get_choices "CustomerTypeChoices" as CustomerTypeChoices %}
                                {% for item in CustomerTypeChoices %}
                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Zahlungsmethode -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Zahlungsmethode
                            </p>
                            <select name="paymentType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                {% get_choices "PaymentTypeChoices" as PaymentTypeChoices %}
                                {% for item in PaymentTypeChoices %}
                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Liefermethode -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Liefermethode
                            </p>
                            <select name="deliveryType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                {% get_choices "DeliveryTypeChoices" as DeliveryTypeChoices %}
                                {% for item in DeliveryTypeChoices %}
                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Bestellsumme -->
                        <div class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">
                            <p class="mb-2 text-sm font-medium text-gray-900">
                                Bestellsumme
                            </p>
                            <span id="orderAmount" name="orderAmount" class="mb-4 text-sm font-medium text-gray-900 ">0,00 ‚Ç¨</span>
                        </div>
                    </div>
                </div>
                <input type="text" name="customerId" hidden>
                <div id="accordion-collapse-customer" data-accordion="collapse">
                    <!-- Bestelldaten -->
                    <h2 id="update-product-accordion-collapse-heading-1-customer" style="margin: 0 -1.25rem; width: calc(100% + 2.5rem);">
                        <button type="button" id="invoiceDataButtonCustomer" class="modal-accordion-button flex items-center justify-between w-full px-4 py-4 font-medium leading-none text-left text-gray-900 border-t border-gray-200 sm:px-5 bg-gray-50 hover:bg-gray-100" data-accordion-target="#update-product-accordion-collapse-body-1-customer" aria-expanded="true" aria-controls="update-product-accordion-collapse-body-1-customer">
                            <span>Bestelldaten</span>
                            <svg aria-hidden="true" data-accordion-icon="" class="w-6 h-6 rotate-180 shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </h2>
                    <div id="update-product-accordion-collapse-body-1-customer" class="hidden" aria-labelledby="update-product-accordion-collapse-heading-2">
                        <div class="py-4 border-gray-200 sm:py-5 ">
                            <!-- Inputs -->
                                <!-- Column -->
                                <div class="">
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <!-- Salutation -->
                                        <div>
                                            <label for="salutation" class="block mb-2 text-sm font-medium text-gray-900">Anrede</label>
                                            <select id="salutation" name="salutation" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                                {% get_choices "SalutationChoices" as SalutationChoices %}
                                                {% for item in SalutationChoices %}
                                                <option value="{{ item.0 }}">{{ item.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <!-- Vorname -->
                                        <div>
                                            <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900">Vorname</label>
                                            <input type="text" name="firstName" id="first_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Vorname" required="">
                                        </div>
                                        <!-- Nachname -->
                                        <div>
                                            <label for="last_name" class="block mb-2 text-sm font-medium text-gray-900">Nachname</label>
                                            <input type="text" name="lastName" id="last_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Nachname" required="">
                                        </div>
                                        <!-- Geburtsdatum -->
                                        <div class="relative max-w-sm">
                                            <label for="birth_date" class="block mb-2 text-sm font-medium text-gray-900">Geburtsdatum</label>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none">
                                                    <svg class="w-4 h-4 text-gray-500 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                                    </svg>
                                                </div>
                                                <input datepicker datepicker-format="dd.mm.yyyy" type="text" id="birth_date" name="birthDate" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full ps-10 p-2.5   " placeholder="Geburtsdatum">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-3">
                                        <!-- Stra√üe -->
                                        <div>
                                            <label for="street" class="block mb-2 text-sm font-medium text-gray-900">Stra√üe</label>
                                            <input type="text" name="street" id="street" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Stra√üe" required="">
                                        </div>
                                        <!-- Hausnummer -->
                                        <div>
                                            <label for="street_number" class="block mb-2 text-sm font-medium text-gray-900">Hausnummer</label>
                                            <input type="text" name="streetNumber" id="street_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Hausnummer" required="">
                                        </div>
                                        <!-- PLZ -->
                                        <div>
                                            <label for="postalcode" class="block mb-2 text-sm font-medium text-gray-900">Postleitzahl</label>
                                            <input type="text" name="postalcode" id="postalcode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Postleitzahl" required="">
                                        </div>
                                    </div>
                                    <div class="grid gap-4 mb-4 sm:grid-cols-2">
                                        <!-- Stadt -->
                                        <div>
                                            <label for="city" class="block mb-2 text-sm font-medium text-gray-900">Stadt</label>
                                            <input type="text" name="city" id="city" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Stadt" required="">
                                        </div>
                                        <!-- Land -->
                                        <div>
                                            <label for="country" class="block mb-2 text-sm font-medium text-gray-900">Land</label>
                                            <select id="country" name="country" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">
                                                {% get_choices "CountryChoices" as countries %}
                                                {% for item in countries %}
                                                <option value="{{item.0}}" {% if order.country == item.0 %}selected{% endif %}>{{ item.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <!-- Telefonnummer -->
                                        <div>
                                            <label for="phone_number" class="block mb-2 text-sm font-medium text-gray-900">Telefonnummer</label>
                                            <input type="text" name="phonenumber" id="phone_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="Telefonnummer" required="">
                                        </div>
                                        <!-- E-Mail -->
                                        <div>
                                            <label for="email_address" class="block mb-2 text-sm font-medium text-gray-900">E-Mail Adresse</label>
                                            <input type="email" name="email" id="email_address" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="E-Mail Adresse" required="">
                                        </div>
                                        <!-- Kommentar -->
                                        <div class="sm:col-span-2">
                                            <label for="comment" class="block mb-2 text-sm font-medium text-gray-900">Kommentar</label>
                                            <textarea id="comment" name="comment" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Kommentar"></textarea>
                                        </div>
                                    </div>
                                </div>
                        </div>
                </div>
                <div class="d-flex justify-between pt-4 sm:flex sm:space-y-0 sm:space-x-4">
                    <div class="mb-4 sm:mb-0 items-center d-flex space-y-4 sm:flex sm:space-y-0 sm:space-x-4">
                        <button type="button" onclick="saveCustomer(this)" data-toast-name="orderUpdatedToast" type="submit" class="w-full sm:w-auto justify-center text-white inline-flex bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-full text-sm px-5 py-2.5 text-center">
                            Speichern
                        </button>
                        <button onclick="hideModal('customerModal')" type="button" class="w-full justify-center sm:w-auto text-gray-500 inline-flex items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-emerald-300 rounded-full border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10">
                            <svg class="mr-1 -ml-1 w-5 h-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            Abbrechen
                        </button>
                    </div>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Alert Modal -->
<div id="no-premission-modal" aria-hidden="true" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full bg-gray-900 bg-opacity-60">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow ">
            <div class="p-6 text-center">
                <svg class="mx-auto mb-4 text-red-500 w-12 h-12 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                <h3 class="mb-5 text-lg font-normal text-gray-500 ">
                    Der Kunde hat nicht zugestimmt, dass Sie eine Bestellung anlegen k√∂nnen.
                </h3>
                <button onclick="hideModal('no-premission-modal')" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10">
                    Verstanden
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="order-success-modal" aria-hidden="true" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full bg-gray-900 bg-opacity-60">
    <div class="relative w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow ">
            <div class="p-6 text-center">
                <svg class="mx-auto mb-4 w-12 h-12 text-green-500 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 4h3c.6 0 1 .4 1 1v15c0 .6-.4 1-1 1H6a1 1 0 0 1-1-1V5c0-.6.4-1 1-1h3m0 3h6m-6 7 2 2 4-4m-5-9v4h4V3h-4Z"/>
                </svg>
                <h3 class="mb-5 text-lg font-normal text-gray-500 ">
                    Die Bestellung wurde erfolgreich angelegt und der Kunde hat eine E-Mail zur Best√§tigung der Bestellung erhalten.
                </h3>
                <a href="{% url 'dashboard_customers' %}" type="button" class="focus:outline-none text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2">
                    Verstanden
                </a>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Filter and Search -->
<script data-baseUrl="{{ baseUrl }}">
    
    const filterDatas = document.currentScript.dataset

    $('#searchCustomer').on('keydown', function(event) {
        if (event.which === 13) { // 13 ist der KeyCode f√ºr 'Enter'
            event.preventDefault(); // Verhindert das Standardverhalten
            
            searchCustomer();
        }
    });

    const searchCustomer = () => {

        let search_word = $('#searchCustomer').val()

        if (search_word && search_word != '') {
            
            customFilter('search=' + search_word)

        }
        
    }

    const customFilter = (filterCriterias) => {

        // Show all
        if (!filterCriterias || filterCriterias == '') {
            window.location.href = filterDatas.baseurl + '?page=1'
        // Show by filter
        } else {
            window.location.href = filterDatas.baseurl + '?page=1&' + filterCriterias
        }

    }

    const resetFilter = () => {
        window.location.href = (filterDatas.baseurl + '?page=1')
    }
</script>

<!-- Add/edit customer -->
<script>

    const customerModalHeader = $('#customerModalHeader')
    const customerId = $('input[name=customerId]', '#customerDetailsForm');
    const customerSalutation = $('select[name=salutation]', '#customerDetailsForm');
    const customerFirstName = $('input[name=firstName]', '#customerDetailsForm');
    const customerLastName = $('input[name=lastName]', '#customerDetailsForm');
    const customerBirthDate = $('input[name=birthDate]', '#customerDetailsForm');
    const customerStreet = $('input[name=street]', '#customerDetailsForm');
    const customerStreetNumber = $('input[name=streetNumber]', '#customerDetailsForm');
    const customerPostalcode = $('input[name=postalcode]', '#customerDetailsForm');
    const customerCity = $('input[name=city]', '#customerDetailsForm');
    const customerCountry = $('select[name=country]', '#customerDetailsForm');
    const customerPhonenumber = $('input[name=phonenumber]', '#customerDetailsForm');
    const customerEmail = $('input[name=email]', '#customerDetailsForm');
    const customerComment = $('textarea[name=comment]', '#customerDetailsForm');

    // const deliveryAddressAsInvoice = $('input[name=deliveryAddressAsInvoice]', '#customerDetailsForm');
    // const customerDelLastName = $('input[name=delLastName]', '#customerDetailsForm');
    // const customerDelFirstName = $('input[name=delFirstName]', '#customerDetailsForm');
    // const customerDelStreet = $('input[name=delStreet]', '#customerDetailsForm');
    // const customerDelStreetNumber = $('input[name=delStreetNumber]', '#customerDetailsForm');
    // const customerDelPostalcode = $('input[name=delPostalcode]', '#customerDetailsForm');
    // const customerDelCity = $('input[name=delCity]', '#customerDetailsForm');
    // const customerDelCountry = $('select[name=delCountry]', '#customerDetailsForm');
    // const customerDelComment = $('textarea[name=delComment]', '#customerDetailsForm');

    const customerCustomerType = $('select[name=customerType]', '#customerDetailsForm');
    const customerDeliveryType = $('select[name=deliveryType]', '#customerDetailsForm');
    const customerPaymentTypeChoices = $('select[name=paymentType]', '#customerDetailsForm');

    const clearCustomerModal = () => {

        $('#customerDetailsForm input').removeClass('input-error')
        $('#customerDetailsForm select').removeClass('input-error')
        $('#invoiceData').removeClass('button-error')

        $('#customerDetailsForm input').val('')
        $('#customerDetailsForm select').val('')
        $('#customerDetailsForm textarea').val('')
        $('#deliveryDetails').addClass('hidden')
        $('#customerDetailsForm input[name=deliveryAddressAsInvoice]').prop('checked', true)

        $('#customerDetailsForm select[name=customerType]').val('self_payer')
        $('#customerDetailsForm select[name=paymentType]').val('paypal')
        $('#customerDetailsForm select[name=deliveryType]').val('dhl_standard')

    }

    const createCustomer = () => {

        clearCustomerModal();
        customerModalHeader.innerHTML = 'Kunden hinzuf√ºgen'
        toggleModal('customerModal', {'backdrop': 'static'})

        customerId.val('')

    }

    const editCustomer = (id) => {
            
            clearCustomerModal();
            customerModalHeader.innerHTML = 'Kunden bearbeiten'
    
            $.ajax({
                type: 'POST',
                url: '{% url "request_customer_functions" %}',
                traditional: true,
                data: {
                    'getCustomerDetails': 'getCustomerDetails',
                    'customerId': id,
                },
                success: (data) => {

                    const customer = data.customer

                    customerId.val(customer.id)
                    customerSalutation.val(customer.salutation)
                    customerFirstName.val(customer.firstName)
                    customerLastName.val(customer.lastName)
                    customerBirthDate.val(customer.birthDate)
                    customerStreet.val(customer.street)
                    customerStreetNumber.val(customer.streetNumber)
                    customerPostalcode.val(customer.postalcode)
                    customerCity.val(customer.city)
                    customerCountry.val(customer.country)
                    customerPhonenumber.val(customer.phonenumber)
                    customerEmail.val(customer.email)
                    customerComment.val(customer.comment)
                    customerCustomerType.val(customer.customerType)
                    customerDeliveryType.val(customer.deliveryType)
                    customerPaymentTypeChoices.val(customer.paymentType)

                    toggleModal('customerModal', {'backdrop': 'static'})

                },
                error: (data) => {
                    toggleModal('alertModal')
                }
            })

    }

    // Rechnungsadresse = Lieferadresse
    $('#customerDetailsForm input[name=deliveryAddressAsInvoice]').on('change', function() {
        if ($(this).is(':checked')) {
            $('#deliveryDetails').addClass('hidden')
        } else {
            $('#deliveryDetails').removeClass('hidden')
        }
    })

    var customerDataFields = new FormData();

    const validateCustomerOrderSettings = () => {

        const customerTypeValue = customerCustomerType.val()
        const deliveryTypeValue = customerDeliveryType.val()
        const paymentTypeValue = customerPaymentTypeChoices.val()

        const validationFieldsOrderSettings = [
            'customerType',
            'deliveryType',
            'paymentType',
        ]

        const formDataOrderSettings = {
            customerType: customerTypeValue,
            deliveryType: deliveryTypeValue,
            paymentType: paymentTypeValue,
        }

        const formDataFieldsOrderSettings = {
            customerType: customerCustomerType,
            deliveryType: customerDeliveryType,
            paymentType: customerPaymentTypeChoices,
        }

        let wrongFields = []

        // Validate all fields (defined in validationFieldsOrderSettings) for content
        const validateOrderSettings = (obj, fields) => {

            for (let field of fields) {

                if (!Array.isArray(field)) {
                    if (field === 'email' || field === 'mail') {
                        if (obj?.[field] === undefined || obj?.[field] === '' || !regexEmail.test(obj?.[field])) wrongFields.push(field); 
                    }
                    if (obj?.[field] === undefined || obj?.[field] === '' || obj?.[field] === null) wrongFields.push(field);
                } else if (!obj?.[field[0]] || !checkField(obj[field[0]], field[1])) return false;
            }
            
            if (wrongFields.length != 0) {
                for (let field of wrongFields) {
                    $(formDataFieldsOrderSettings?.[field]).addClass('input-error')
                }
                return false;
            }
            
            customerDataFields.append('orderSettings', JSON.stringify(formDataOrderSettings))
            
            return true;

        };
        return validateOrderSettings(formDataOrderSettings, validationFieldsOrderSettings)

    }

    const validateCustomerDetails = () => {

        const salutationValue = customerSalutation.val()
        const firstNameValue = customerFirstName.val()
        const lastNameValue = customerLastName.val()
        const birthDateValue = customerBirthDate.val()
        const streetValue = customerStreet.val()
        const streetNumberValue = customerStreetNumber.val()
        const postalcodeValue = customerPostalcode.val()
        const cityValue = customerCity.val()
        const countryValue = customerCountry.val()
        const phonenumberValue = customerPhonenumber.val()
        const emailValue = customerEmail.val()
        const commentValue = customerComment.val()

        const validationFields = [
            'salutation',
            'firstName',
            'lastName',
            'birthDate',
            'street',
            'streetNumber',
            'postalcode',
            'city',
            'country',
            'phonenumber',
            'email',
        ]

        const formData = {
            'salutation': salutationValue,
            'firstName': firstNameValue,
            'lastName': lastNameValue,
            'birthDate': birthDateValue,
            'street': streetValue,
            'streetNumber': streetNumberValue,
            'postalcode': postalcodeValue,
            'city': cityValue,
            'country': countryValue,
            'phonenumber': phonenumberValue,
            'email': emailValue,
            'comment': commentValue,
        }

        const formDataFields = {
            salutation: customerSalutation,
            firstName: customerFirstName,
            lastName: customerLastName,
            birthDate: customerBirthDate,
            street: customerStreet,
            streetNumber: customerStreetNumber,
            postalcode: customerPostalcode,
            city: customerCity,
            country: customerCountry,
            phonenumber: customerPhonenumber,
            email: customerEmail,
        }

        let wrongFields = []

        // Validate all fields (defined in validationFields) for content
        const validate = (obj, fields) => {

            for (let field of fields) {
                if (!Array.isArray(field)) {
                    if (field === 'email' || field === 'mail') {
                        if (obj?.[field] === undefined || obj?.[field] === '' || !regexEmail.test(obj?.[field])) wrongFields.push(field); 
                    }
                    if (obj?.[field] === undefined || obj?.[field] === '' || obj?.[field] === null) wrongFields.push(field);
                } else if (!obj?.[field[0]] || !checkField(obj[field[0]], field[1])) return false;
            }
            
            if (wrongFields.length != 0) {
                for (let field of wrongFields) {
                    $(formDataFields?.[field]).addClass('input-error')
                }
                $('#invoiceDataButtonCustomer').addClass('button-error')
                return false;
            }
            
            customerDataFields.append('invoiceData', JSON.stringify(formData))
            
            return true;

        };
        return validate(formData, validationFields)

    }

    const validateCustomerDelDetails = () => {

        const deliveryAddressAsInvoiceValue = deliveryAddressAsInvoice.is(':checked')
        const delFirstNameValue = customerDelFirstName.val()
        const delLastNameValue = customerDelLastName.val()
        const delStreetValue = customerDelStreet.val()
        const delStreetNumberValue = customerDelStreetNumber.val()
        const delPostalcodeValue = customerDelPostalcode.val()
        const delCityValue = customerDelCity.val()
        const delCountryValue = customerDelCountry.val()
        const customerDelCommentValue = customerDelComment.val()

        const validationFieldsDel = [
            'delFirstName',
            'delLastName',
            'delStreet',
            'delStreetNumber',
            'delPostalcode',
            'delCity',
            'delCountry',
        ]

        const formDataDel = {
            deliveryAddressAsInvoice: deliveryAddressAsInvoiceValue,
            delFirstName: delFirstNameValue,
            delLastName: delLastNameValue,
            delStreet: delStreetValue,
            delStreetNumber: delStreetNumberValue,
            delPostalcode: delPostalcodeValue,
            delCity: delCityValue,
            delCountry: delCountryValue,
            delComment: customerDelCommentValue,
        }

        const formDataFieldsDel = {
            delFirstName: customerDelFirstName,
            delLastName: customerDelLastName,
            delStreet: customerDelStreet,
            delStreetNumber: customerDelStreetNumber,
            delPostalcode: customerDelPostalcode,
            delCity: customerDelCity,
            delCountry: customerDelCountry,
        }

        let wrongFieldsDel = []

        // Validate all fields (defined in validationFieldsDel) for content
        const validateDel = (obj, fields) => {


            if (!deliveryAddressAsInvoiceValue) {

                for (let field of fields) {
                    if (!Array.isArray(field)) {
                        if (field === 'email' || field === 'mail') {
                            if (obj?.[field] === undefined || obj?.[field] === '' || !regexEmail.test(obj?.[field])) wrongFieldsDel.push(field); 
                        }
                        if (obj?.[field] === undefined || obj?.[field] === '' || obj?.[field] === null) wrongFieldsDel.push(field);
                    } else if (!obj?.[field[0]] || !checkField(obj[field[0]], field[1])) return false;
                }
                
                if (wrongFieldsDel.length != 0) {
                    for (let field of wrongFieldsDel) {
                        $(formDataFieldsDel?.[field]).addClass('input-error')
                    }
                    $('#deliverDataButtonCustomer').addClass('button-error')
                    return false;
                }
            }
            
            customerDataFields.append('deliveryData', JSON.stringify(formDataDel))
            
            return true;

        };
        return validateDel(formDataDel, validationFieldsDel)

    }

    const saveCustomer = (element) => {

        customerDataFields = new FormData();

        $('#customerDetailsForm input').removeClass('input-error')
        $('#customerDetailsForm select').removeClass('input-error')
        
        $('#invoiceDataButtonCustomer').removeClass('button-error')
        $('#deliverDataButtonCustomer').removeClass('button-error')

        if (validateCustomerOrderSettings() && validateCustomerDetails()) {
            
            customerDataFields.append('saveCustomer', 'saveCustomer')
            customerDataFields.append('customerId', customerId.val())

            var timer = setTimeout(function() {
                // Zeigen Sie den Ladebildschirm an, wenn die Ajax-Anfrage noch nicht fertig ist
                $('.loading-screen').addClass('hidden')
            }, 2000);
            
            $.ajax({
                type: 'POST',
                url: '{% url "request_customer_functions" %}',
                traditional: true,
                data: customerDataFields,
                processData: false,
                contentType: false,
                success: (data) => {
            
                    clearTimeout(timer);

                    $('.loading-screen').addClass('hidden')
                    
                    location.reload()
            
                },
                error: () => {
            
                    clearTimeout(timer);
                    $('.loading-screen').addClass('hidden')
                    toggleModal('alert-modal')
            
                }
            })

        }
    }

</script>

<!-- Activate for order -->
<script>
    const activateForOrder = (customerId, element) => {

        var timer = setTimeout(function() {
            // Zeigen Sie den Ladebildschirm an, wenn die Ajax-Anfrage noch nicht fertig ist
            $('.loading-screen').addClass('hidden')
        }, 2000);
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_customer_functions" %}',
            traditional: true,
            data: {
                'activateForOrder': 'activateForOrder',
                'customerId': customerId,
            },
            success: (data) => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')

                $('#customer-' + customerId + ' [name="can_trigger_order"]').attr('data-can-trigger-order', 'True')

                $(element).parent().before(
                    '<li>\
                        <a href="javascript:void(0)" onclick="createOrder(' + customerId + ')" class="block py-2 px-4 hover:bg-gray-100">\
                            Bestellung anlegen\
                        </a>\
                    </li>'
                )

                $(element).parent().remove()
        
            },
            error: () => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }
</script>

<!-- Add order -->
<script>
    const orderId = $('input[name=orderId]', '#orderDetailsForm');
    const deliveryType = $('select[name=deliveryType]', '#orderDetailsForm');
    const paymentType = $('select[name=paymentType]', '#orderDetailsForm');
    const customerType = $('select[name=customerType]', '#orderDetailsForm');
    const recipeStatus = $('select[name=recipeStatus]', '#orderDetailsForm');

    // Bestelldetails
    const salutation = $('select[name=salutation]', '#orderDetailsForm');
    const firstName = $('input[name=firstName]', '#orderDetailsForm');
    const lastName = $('input[name=lastName]', '#orderDetailsForm');
    const birthDate = $('input[name=birthDate]', '#orderDetailsForm');
    const street = $('input[name=street]', '#orderDetailsForm');
    const streetNumber = $('input[name=streetNumber]', '#orderDetailsForm');
    const postalcode = $('input[name=postalcode]', '#orderDetailsForm');
    const city = $('input[name=city]', '#orderDetailsForm');
    const country = $('select[name=country]', '#orderDetailsForm');
    const phonenumber = $('input[name=phonenumber]', '#orderDetailsForm');
    const email = $('input[name=email]', '#orderDetailsForm');
    const comment = $('textarea[name=comment]', '#orderDetailsForm');

    // Lieferdaten
    const delFirstName = $('input[name=delFirstName]', '#orderDetailsForm');
    const delLastName = $('input[name=delLastName]', '#orderDetailsForm');
    const delStreet = $('input[name=delStreet]', '#orderDetailsForm');
    const delStreetNumber = $('input[name=delStreetNumber]', '#orderDetailsForm');
    const delPostalcode = $('input[name=delPostalcode]', '#orderDetailsForm');
    const delCity = $('input[name=delCity]', '#orderDetailsForm');
    const delCountry = $('select[name=delCountry]', '#orderDetailsForm');
    const delComment = $('textarea[name=delComment]', '#orderDetailsForm');

    // Rezept
    const recipeFile = $('input[name=recipeFile]', '#orderDetailsForm')
    const recipeNumber = $('input[name=recipeNumber]', '#orderDetailsForm')
    const eRecipe = $('input[name=eRecipe]', '#orderDetailsForm')

    const regexEmail = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/

    $('.customer-checkbox').on('change', function() {
        if ($('.customer-checkbox:checked').length != 1) {
            $('#addOrderButton').prop('disabled', true)
        } else {
            $('#addOrderButton').prop('disabled', false)
        }
    })

    const createOrderChecked = () => {
        createOrder($('.customer-checkbox:checked').data('customer-id'))
    }

    const createOrder = (customerId) => {

        // $('#productList').empty();
        $('#recipeList').empty();

        $('#orderDetailsForm input').removeClass('input-error')
        $('#orderDetailsForm select').removeClass('input-error')
        $('#invoiceData').removeClass('button-error')

        var timer = setTimeout(function() {
            // Zeigen Sie den Ladebildschirm an, wenn die Ajax-Anfrage noch nicht fertig ist
            $('.loading-screen').addClass('hidden')
        }, 2000);
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_customer_functions" %}',
            traditional: true,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
            data: {
                'createOrder': 'createOrder',
                'customerId': customerId,
            },
            success: (data) => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')

                if (data.premission) {

                    let customer = data.customer

                    orderId.val(data.orderId)

                    salutation.val(customer.salutation)
                    firstName.val(customer.firstName)
                    lastName.val(customer.lastName)
                    birthDate.val(customer.birthDate)
                    email.val(customer.email)
                    phonenumber.val(customer.phone)
                    street.val(customer.street)
                    streetNumber.val(customer.streetNumber)
                    city.val(customer.city)
                    postalcode.val(customer.postcode)
                    country.val(customer.country)
                    customerType.val(customer.customerType)
                    deliveryType.val(customer.deliveryType)
                    paymentType.val(customer.paymentType)
                    
                    delFirstName.val(customer.firstName)
                    delLastName.val(customer.lastName)
                    delStreet.val(customer.street)
                    delStreetNumber.val(customer.streetNumber)
                    delCity.val(customer.city)
                    delPostalcode.val(customer.postcode)
                    delCountry.val(customer.country)

                    $('#productList').empty();
                    $('#orderAmount').html('0,00 ‚Ç¨')

                    toggleModal('orderModal', {'backdrop': 'static'})
                } else {
                    toggleModal('no-premission-modal')
                }
            },
            error: () => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

    const addProduct = (productId) => {

        var timer = setTimeout(function() {
            // Zeigen Sie den Ladebildschirm an, wenn die Ajax-Anfrage noch nicht fertig ist
            $('.loading-screen').addClass('hidden')
        }, 2000);
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_customer_functions" %}',
            traditional: true,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': getCookie('csrftoken')
            },
            data: {
                'addProduct': 'addProduct',
                'orderId': orderId.val(),
                'productId': productId,
            },
            success: (data) => {

                $('#orderProductsAlert').addClass('hidden')
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')

                let recipe_options = ''

                for (recipe of data.recipeFiles) {
                    recipe_options += '<option value=' + recipe.id + '>' + recipe.number + '</option>'
                }

                let template = '<div id="productItem-' + data.product.id + '" class="product-item bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   ">\
                                    <div class="grid gap-4 sm:col-span-2 md:gap-6 sm:grid-cols-2 mb-3">\
                                        <div>\
                                            <label for="product" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900">\
                                                Produkt\
                                            </label>\
                                            <input type="text" name="product" id="product" value="' + data.product.name + '" disabled class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="">\
                                        </div>\
                                        <div class="ml-auto flex flex-row gap-4">\
                                            <p class="pr-1.5 ml-auto text-lg font-medium text-gray-900">\
                                                Preis: <span class="text-gray-900 " name="productPrice">' + data.product.total + '</span>\
                                            </p>\
                                            <button type="button" onclick="deleteOrderProduct(' + data.product.id + ')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto mb-auto inline-flex" data-modal-toggle="orderModal">\
                                                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\
                                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>\
                                                </svg>\
                                                <span class="sr-only">Produkt l√∂schen</span>\
                                            </button>\
                                        </div>\
                                    </div>\
                                    <div class="grid gap-4 sm:col-span-2 md:gap-6 sm:grid-cols-4">\
                                        <div>\
                                            <label for="prepared" class="inline-flex items-center mb-2 text-sm font-medium text-gray-900">\
                                                Abgabeform\
                                            </label>\
                                            <select id="prepared" name="prepared" onchange="changeProductDetails(' + data.product.id + ')" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5   ">\
                                                <option value="0">Unverarbeitet</option>\
                                                <option value="1">Zerkleinert</option>\
                                            </select>\
                                        </div>\
                                        <div>\
                                            <label for="productAmount" class="block mb-2 text-sm font-medium text-gray-900" name="productAmountLabel">Menge (<span id="availableAmountLabel-' + data.product.id +'">' + data.available_amount + '</span> verf√ºgbar)</label>\
                                            <input type="number" name="productAmount" onchange="changeProductDetails(' + data.product.id + ')" id="productAmount" value="1" min="1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="">\
                                        </div>\
                                        <div>\
                                            <label for="form" class="block mb-2 text-sm font-medium text-gray-900">Form</label>\
                                            <input type="text" name="form" id="form" value="' + data.product.form + '" disabled class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="">\
                                        </div>\
                                        <div>\
                                            <label for="manufacturer" class="block mb-2 text-sm font-medium text-gray-900">H√§ndler</label>\
                                            <input type="text" name="manufacturer" id="manufacturer" value="' + data.product.supplier + '" disabled class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-emerald-600 focus:border-emerald-600 block w-full p-2.5   " placeholder="">\
                                        </div>\
                                    </div>\
                                </div>'

                $('#productList').append(template);

                $('#orderAmount').html(data.total)
        
            },
            error: () => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

    const changeProductDetails = (orderProductId) => {

        var timer = setTimeout(function() {
            // Zeigen Sie den Ladebildschirm an, wenn die Ajax-Anfrage noch nicht fertig ist
            $('.loading-screen').addClass('hidden')
        }, 2000);

        const amountInput = $('#productItem-' + orderProductId + ' input[name=productAmount]') 
        const amount = amountInput.val()
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_customer_functions" %}',
            traditional: true,
            data: {
                'changeProductDetails': 'changeProductDetails',
                'orderProductId': orderProductId,
                'amount': amount,
                'prepared': $('#productItem-' + orderProductId + ' select[name=prepared]').val(),
                // 'recipeId': $('#productItem-' + orderProductId + ' select[name=recipe]').val(),
            },
            success: (data) => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')

                $('#productItem-' + orderProductId + ' [name=productPrice]').html(data.product_total)
                $('#orderAmount').html(data.total)
                                
                if (data.available_amount >= amount) {
                    amountInput.removeClass('border-red-500')
                    amountInput.removeClass('dark:border-red-500')
                    amountInput.addClass('border-gray-300')
                    amountInput.addClass('dark:border-gray-600')
                } else {
                    amountInput.removeClass('border-gray-300')
                    amountInput.removeClass('dark:border-gray-600')
                    amountInput.addClass('border-red-500')
                    amountInput.addClass('dark:border-red-500')
                }
            },
            error: () => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

    const deleteOrderProduct = (orderProductId) => {
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_customer_functions" %}',
            traditional: true,
            data: {
                'deleteOrderProduct': 'deleteOrderProduct',
                'orderProductId': orderProductId,
            },
            success: (data) => {

                $('#productItem-' + orderProductId).remove()
                $('#orderAmount').html(data.total)
        
            },
            error: () => {
        
                toggleModal('alert-modal')
        
            }
        })

    }

    // Upload recipe files
    const uploadRecipe = () => {

        var recipeData = new FormData();

        if (recipeFile[0].files.length == 0) {
            recipeFile.addClass('input-error')
            return false;
        }

        if (!eRecipe.prop('checked') && recipeNumber.val() == '') {
            recipeNumber.addClass('input-error')
            return false;
        }

        recipeData.append('recipeFile', recipeFile[0].files[0])
        recipeData.append('recipeNumber', recipeNumber.val())
        recipeData.append('eRecipe', JSON.stringify(eRecipe.prop('checked')))
        recipeData.append('orderId', orderId.val())
        recipeData.append('uploadRecipeFile', 'uploadRecipeFile')

        var timer = setTimeout(function() {
            // Zeigen Sie den Ladebildschirm an, wenn die Ajax-Anfrage noch nicht fertig ist
            $('.loading-screen').addClass('hidden')
        }, 2000);
        
        $.ajax({
            type: 'POST',
            url: '{% url "request_customer_functions" %}',
            processData: false,  // Wichtig: Verhindert, dass jQuery die Daten verarbeitet
            contentType: false,
            traditional: true,
            data: recipeData,
            success: (data) => {

                $('#orderRecipeAlert').addClass('hidden')
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')

                let template = '<div id="recipeFile-' + data.recipeId + '" class="flex flex-row pl-2.5 bg-gray-50 border border-gray-300 rounded-lg">\
                                    <a href="' + data.recipeUrl + '" class="mr-4 my-auto flex-grow text-md font-medium text-green-500 hover:text-green-700">\
                                        ' + data.recipeName + ' (' + data.recipeNumber + ')\
                                    </a>\
                                    <button type="button" onclick="deleteRecipe(' + data.recipeId + ')" class="ml-auto text-red-700 hover:text-white border border-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center     ">\
                                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">\
                                            <path fill-rule="evenodd" d="M8.6 2.6A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4c0-.5.2-1 .6-1.4ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z" clip-rule="evenodd"/>\
                                        </svg>\
                                    </button>\
                                </div>'

                $('#recipeList').append(template)

                // $('select[name="recipe"]').append('<option value=' + data.recipeId + '>' + data.recipeNumber + '</option>')
                
        
            },
            error: () => {
        
                clearTimeout(timer);
                $('.loading-screen').addClass('hidden')
                toggleModal('alert-modal')
        
            }
        })

    }

    // Save order
    var dataFields = new FormData()

    const validateInoviceDatas = () => {
        
        $('#invoiceDataButton').removeClass('button-error')

        // Bestelldaten
        const salutationValue = salutation.val()
        const firstNameValue = firstName.val()
        const lastNameValue = lastName.val()
        const birthDateValue = birthDate.val()
        const streetValue = street.val()
        const streetNumberValue = streetNumber.val()
        const postalcodeValue = postalcode.val()
        const cityValue = city.val()
        const countryValue = country.val()
        const phonenumberValue = phonenumber.val()
        const emailValue = email.val()
        const commentValue = comment.val()

        const validationFields = [
            'salutation',
            'firstName',
            'lastName',
            'birthDate',
            'street',
            'streetNumber',
            'postalcode',
            'city',
            'country',
            'phonenumber',
            'email',
        ]

        const formData = {
            salutation: salutationValue,
            firstName: firstNameValue,
            lastName: lastNameValue,
            birthDate: birthDateValue,
            street: streetValue,
            streetNumber: streetNumberValue,
            postalcode: postalcodeValue,
            city: cityValue,
            country: countryValue,
            phonenumber: phonenumberValue,
            email: emailValue,
            comment: commentValue,
        }

        const formDataFields = {
            salutation: salutation,
            firstName: firstName,
            lastName: lastName,
            birthDate: birthDate,
            street: street,
            streetNumber: streetNumber,
            postalcode: postalcode,
            city: city,
            country: country,
            phonenumber: phonenumber,
            email: email,
        }

        let wrongFields = []

        // Validate all fields (defined in validationFields) for content
        const validate = (obj, fields) => {

            for (let field of fields) {
                if (!Array.isArray(field)) {
                    if (field === 'email' || field === 'mail') {
                        if (obj?.[field] === undefined || obj?.[field] === '' || !regexEmail.test(obj?.[field])) wrongFields.push(field); 
                    }
                    if (obj?.[field] === undefined || obj?.[field] === '') wrongFields.push(field);
                } else if (!obj?.[field[0]] || !checkField(obj[field[0]], field[1])) return false;
            }
            
            if (wrongFields.length != 0) {
                for (let field of wrongFields) {
                    $(formDataFields?.[field]).addClass('input-error')
                }
                $('#invoiceDataButton').addClass('button-error')
                return false;
            }
            
            dataFields.append('invoiceData', JSON.stringify(formData))
            
            return true;

        };
        return validate(formData, validationFields)

    }

    const validateDeliverDatas = () => {
        
        $('#deliverDataButton').removeClass('button-error')

        // Bestelldaten
        const firstNameValue = delFirstName.val()
        const lastNameValue = delLastName.val()
        const streetValue = delStreet.val()
        const streetNumberValue = delStreetNumber.val()
        const postalcodeValue = delPostalcode.val()
        const cityValue = delCity.val()
        const countryValue = delCountry.val()
        const commentValue = delComment.val()

        const validationFields = [
            'firstName',
            'lastName',
            'street',
            'streetNumber',
            'postalcode',
            'city',
            'country',
        ]

        const formData = {
            firstName: firstNameValue,
            lastName: lastNameValue,
            street: streetValue,
            streetNumber: streetNumberValue,
            postalcode: postalcodeValue,
            city: cityValue,
            country: countryValue,
            comment: commentValue,
        }

        const formDataFields = {
            firstName: delFirstName,
            lastName: delLastName,
            street: delStreet,
            streetNumber: delStreetNumber,
            postalcode: delPostalcode,
            city: delCity,
            country: delCountry,
        }

        let wrongFields = []

        // Validate all fields (defined in validationFields) for content
        const validate = (obj, fields) => {

            for (let field of fields) {
                if (!Array.isArray(field)) {
                    if (field === 'email' || field === 'mail') {
                        if (obj?.[field] === undefined || obj?.[field] === '' || !regexEmail.test(obj?.[field])) wrongFields.push(field); 
                    }
                    if (obj?.[field] === undefined || obj?.[field] === '') wrongFields.push(field);
                } else if (!obj?.[field[0]] || !checkField(obj[field[0]], field[1])) return false;
            }
            
            if (wrongFields.length != 0) {
                for (let field of wrongFields) {
                    $(formDataFields?.[field]).addClass('input-error')
                }
                $('#deliverDataButton').addClass('button-error')
                return false;
            }
            
            dataFields.append('deliverData', JSON.stringify(formData))
            
            return true;

        };
        return validate(formData, validationFields)

    }

    const validateRecipes = () => {

        $('#recipeButton').removeClass('button-error')
        $('#orderRecipeAlert').addClass('hidden')

        if ($('#recipeList').children().length == 0) {
            $('#recipeButton').addClass('button-error')
            $('#orderRecipeAlert').removeClass('hidden')
            return false
        }

        return true
    }

    const validateProducts = () => {

        $('#productsButton').removeClass('button-error')
        $('#orderProductsAlert').addClass('hidden')

        if ($('#productList').children().length == 0) {
            $('#productsButton').addClass('button-error')
            $('#orderProductsAlert').removeClass('hidden')
            return false
        }

        // for (let product of $('#productList').children()) {

        //     if ($(product).find('select[name=recipe]').val() == '') {
        //         $('#productsButton').addClass('button-error')
        //         $(product).find('select[name=recipe]').addClass('input-error')
        //         return false
        //     }

        // }

        return true

    }

    const validateOrderSettings = () => {

        const validationFieldsOrderSettings = [
            'paymentType',
            'deliveryType',
            'customerType',
            'recipeStatus',
        ]

        const formDataOrderSettings = {
            'paymentType': paymentType.val(),
            'deliveryType': deliveryType.val(),
            'customerType': customerType.val(),
            'recipeStatus': recipeStatus.val(),
        }

        const formDataFieldsOrderSettings = {
            'paymentType': paymentType,
            'deliveryType': deliveryType,
            'customerType': customerType,
            'recipeStatus': recipeStatus,
        }

        let wrongFields = []

        // Validate all fields (defined in validationFields) for content
        const validateOrderSettings = (obj, fields) => {

            for (let field of fields) {
                if (!Array.isArray(field)) {
                    if (field === 'email' || field === 'mail') {
                        if (obj?.[field] === undefined || obj?.[field] === '' || !regexEmail.test(obj?.[field])) wrongFields.push(field); 
                    }
                    if (obj?.[field] === undefined || obj?.[field] === '' || obj?.[field] === null) wrongFields.push(field);
                } else if (!obj?.[field[0]] || !checkField(obj[field[0]], field[1])) return false;
            }
            
            if (wrongFields.length != 0) {
                for (let field of wrongFields) {
                    $(formDataFieldsOrderSettings?.[field]).addClass('input-error')
                }
                $(formDataFieldsOrderSettings?.[wrongFields[0]])?.focus()
                return false;
            }
            
            dataFields.append('orderSettings', JSON.stringify(formDataOrderSettings))
            
            return true;

        };
        return validateOrderSettings(formDataOrderSettings, validationFieldsOrderSettings)

    }

    const saveOrder = () => {

        $('#orderDetailsForm input').removeClass('input-error')
        $('#orderDetailsForm select').removeClass('input-error')
        
        $('#invoiceDataButton').removeClass('button-error')
        $('#deliverDataButton').removeClass('button-error')
        $('#productsButton').removeClass('button-error')
        $('#recipeButton').removeClass('button-error')

        dataFields = new FormData();

        if (validateOrderSettings() && validateInoviceDatas() && validateDeliverDatas() && validateRecipes() && validateProducts()) {

            dataFields.append('saveOrder', 'saveOrder')
            dataFields.append('orderId', orderId.val())

            var timer = setTimeout(function() {
                // Zeigen Sie den Ladebildschirm an, wenn die Ajax-Anfrage noch nicht fertig ist
                $('.loading-screen').addClass('hidden')
            }, 2000);

            $.ajax({
                type: 'POST',
                url: '{% url "request_customer_functions" %}',
                processData: false,  // Wichtig: Verhindert, dass jQuery die Daten verarbeitet
                contentType: false,
                traditional: true,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                data: dataFields,
                success: (data) => {

                    clearTimeout(timer);
                    $('.loading-screen').addClass('hidden')

                    toggleModal('order-success-modal')

                },
                error: () => {

                    clearTimeout(timer);
                    $('.loading-screen').addClass('hidden')
                    toggleModal('alert-modal')

                }
            })

        }
    }


</script>

<!-- Search product -->
<script src="{% static '/js/productSearch.js' %}?version=1.1" data-product-url="{% url 'request_product_datas' %}" data-pharmacy-id="{{ selected_pharmacy_id }}"></script>

{% endblock %}
